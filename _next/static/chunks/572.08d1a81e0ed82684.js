(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{3276:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eZ});var s=a(5155),n=a(2115),r=a(2587),l=a(1733),i=a(6497),o=a(2390),c=a(6711),d=a(2593),u=a(2649),m=a(639),h=a(3169),p=a(4206),x=a(6204),g=a(3173);let f=[{id:1,title:"Chat Directly with Your Documents",description:"No more endless scrolling or searching — just ask. document-chat.com understands your uploaded files, emails, and notes, and answers instantly with verified sources.",icon:(0,s.jsx)(o.A,{className:"w-16 h-16 text-white"}),gradient:"from-blue-500 to-cyan-600",features:["Upload PDFs, Word files, or emails","Ask AI questions about your content","Get exact answers — with source links"]},{id:2,title:"Your Living Company Knowledge Base",description:"Turn all company knowledge — from Confluence, SharePoint, or inboxes — into an intelligent chat assistant that your whole team can use anywhere.",icon:(0,s.jsx)(c.A,{className:"w-16 h-16 text-white"}),gradient:"from-green-500 to-emerald-600",features:["Search and chat across all company data","Collaborate with your team securely","Private, GDPR-compliant hosting in Germany"]},{id:3,title:"Work Smarter. Decide Faster.",description:"document-chat.com cuts search time, reduces misinformation, and keeps everyone aligned. Your team stays focused — your decisions stay informed.",icon:(0,s.jsx)(d.A,{className:"w-16 h-16 text-white"}),gradient:"from-orange-500 to-red-600",features:["Save up to 18h per week per employee","5-second summaries for any document","34% less misinformation across teams"]},{id:4,title:"Enterprise-Ready. German Data Security.",description:"Built for industries with the highest data protection needs — finance, healthcare, and automotive. Hosted on German servers and compliant with BaFin & Klinik-InfoSec laws.",icon:(0,s.jsx)(u.A,{className:"w-16 h-16 text-white"}),gradient:"from-purple-500 to-indigo-600",features:["24/7 AI assistant for your company knowledge","Complies with GDPR, BaFin, and hospital IT law","No access by non-EU cloud providers"]},{id:5,title:"Trusted by Industry Leaders",description:"Created by DataFortress.cloud, the data experts behind solutions for VW, BMW, Porsche, HPE, and Atruvia. Now available as a simple, powerful SaaS for your company.",icon:(0,s.jsx)(m.A,{className:"w-16 h-16 text-white"}),gradient:"from-pink-500 to-rose-600",features:["Proven enterprise-grade infrastructure","Custom integrations for Teams, Slack & more","Start boosting your team’s efficiency today"]}],w=e=>{let{onComplete:t}=e,[a,o]=(0,n.useState)(0),[w,b]=(0,n.useState)(0),[v,y]=(0,n.useState)(!1),j=f[a],N="web"!==r.Capacitor.getPlatform(),k=e=>{b(e>a?1:-1),o(e)},C=()=>{y(!0)};return(0,s.jsxs)(l.P.div,{className:"fixed inset-0 bg-gradient-to-br from-orange-500 via-red-500 to-pink-600 flex flex-col z-30 overflow-hidden",style:{paddingTop:"calc(env(safe-area-inset-top, 1.5rem))"},initial:{opacity:1},animate:{opacity:+!v},transition:{duration:.5},onAnimationComplete:()=>{v&&t()},children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-6",children:[(0,s.jsx)("div",{className:"flex space-x-2",children:f.map((e,t)=>(0,s.jsx)("button",{onClick:()=>!v&&k(t),disabled:v,className:"w-8 h-2 rounded-full transition-all duration-300 ".concat(t===a?"bg-white scale-110":t<a?"bg-white/60":"bg-white/30"," disabled:opacity-50"),"aria-label":"Go to slide ".concat(t+1)},t))}),a<f.length-1&&(0,s.jsx)("button",{onClick:()=>{C()},disabled:v,className:"text-white/80 hover:text-white transition-colors text-sm font-medium disabled:opacity-50",children:"Skip"})]}),(0,s.jsx)("div",{className:"flex-1 relative overflow-hidden",children:(0,s.jsx)(i.N,{initial:!1,custom:w,mode:"wait",children:(0,s.jsxs)(l.P.div,{custom:w,variants:{enter:e=>({x:e>0?300:-300,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?300:-300,opacity:0})},initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:"x",dragConstraints:{left:0,right:0},dragElastic:.3,onDragEnd:(e,t)=>{if(v)return;let s=t.offset.x,n=t.velocity.x;s<-50||n<-500?a<f.length-1&&k(a+1):(s>50||n>500)&&a>0&&k(a-1)},className:"absolute inset-0 flex flex-col items-center justify-center text-center px-8",children:[(0,s.jsx)(l.P.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:N?.2:.35,duration:N?.6:.8,ease:"easeOut"},className:"w-32 h-32 rounded-full bg-gradient-to-r ".concat(j.gradient," flex items-center justify-center mb-8 shadow-2xl"),children:j.icon}),(0,s.jsx)(l.P.h2,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.3:.45,duration:N?.6:.8},className:"text-3xl font-bold text-white mb-4",children:j.title}),(0,s.jsx)(l.P.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.4:.55,duration:N?.6:.8},className:"text-lg text-white/90 mb-8 max-w-sm leading-relaxed",children:j.description}),(0,s.jsx)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.5:.65,duration:N?.6:.8},className:"space-y-3 mb-8",children:j.features.map((e,t)=>(0,s.jsxs)(l.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:(N?.6:.8)+.12*t,duration:N?.4:.55},className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r ".concat(j.gradient," flex items-center justify-center shadow-md"),children:(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})}),(0,s.jsx)("span",{className:"text-white/90 font-medium",children:e})]},e))}),(()=>{switch(a){case 0:return(0,s.jsxs)(l.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:N?.8:1,duration:N?.4:.6},className:"flex items-center space-x-4 mb-6",children:[(0,s.jsx)("div",{className:"flex -space-x-2",children:["\uD83D\uDCDD","⏱️","✅"].map((e,t)=>(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r ".concat(0===t?"from-blue-400 to-blue-600":1===t?"from-indigo-400 to-indigo-600":"from-green-400 to-green-600"," border-2 border-white flex items-center justify-center shadow-lg"),children:(0,s.jsx)("span",{className:"text-xl",children:e})},t))}),(0,s.jsx)("span",{className:"text-sm text-white/80",children:"1000+ users"})]});case 1:return(0,s.jsxs)(l.P.div,{initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{delay:N?.8:1.05,duration:N?.5:.7},className:"relative mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center",children:(0,s.jsx)(d.A,{className:"w-8 h-8 text-white"})}),(0,s.jsx)(l.P.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},className:"absolute -inset-2 border-2 border-white/30 rounded-full"}),(0,s.jsx)(l.P.div,{animate:{rotate:[0,360]},transition:{duration:4,repeat:1/0,ease:"linear"},className:"absolute top-1 right-1 w-3 h-3 bg-white rounded-full"})]});case 2:return(0,s.jsxs)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.8:1,duration:N?.4:.6},className:"flex items-center space-x-2 mb-6",children:[(0,s.jsx)(h.A,{className:"w-6 h-6 text-white"}),(0,s.jsx)("div",{className:"flex space-x-1",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(l.P.div,{className:"w-3 h-2 bg-white/80 rounded-sm",animate:{scaleY:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,delay:.2*t}},t))}),(0,s.jsx)("span",{className:"text-xs text-white/70",children:"Secure Payment"})]});case 3:return(0,s.jsx)(l.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:N?.8:1,duration:N?.4:.6},className:"grid grid-cols-2 gap-3 mb-6",children:[u.A,m.A,c.A,p.A].map((e,t)=>(0,s.jsx)(l.P.div,{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",whileHover:{scale:1.1},animate:{y:[0,-5,0]},transition:{y:{duration:2,repeat:1/0,delay:.2*t}},children:(0,s.jsx)(e,{className:"w-6 h-6 text-white"})},t))});default:return null}})()]},a)})}),(0,s.jsxs)("div",{className:"p-6 flex justify-between items-center",children:[(0,s.jsxs)("button",{onClick:()=>{a>0&&k(a-1)},disabled:0===a||v,className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all ".concat(0===a||v?"text-white/40 cursor-not-allowed":"text-white/80 hover:text-white hover:bg-white/10"),children:[(0,s.jsx)(x.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Back"})]}),(0,s.jsxs)(l.P.button,{onClick:()=>{a<f.length-1?k(a+1):C()},disabled:v,className:"flex items-center space-x-2 px-6 py-3 rounded-lg font-medium transition-all shadow-lg ".concat(a===f.length-1?"bg-orange-600 hover:bg-orange-700 text-white":"bg-white text-orange-600 hover:bg-orange-50"," disabled:opacity-50"),whileTap:{scale:.95},children:[(0,s.jsx)("span",{children:a===f.length-1?"Start increasing my productivity by 64%":"Next"}),(0,s.jsx)(g.A,{className:"w-5 h-5"})]})]})]})},b=e=>{let{children:t}=e,[a,r]=(0,n.useState)(!1),[l,i]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("onboardingCompleted");r("true"===e)}catch(e){console.error("Error during app initialization:",e),r(!1)}finally{i(!0)}})()},[]);let o=async()=>{try{localStorage.setItem("onboardingCompleted","true"),r(!0)}catch(e){console.error("Failed to save onboarding status:",e)}};return l?a?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)(w,{onComplete:o}):null};var v=a(3589),y=a(2544);function j(){return(0,y.Z)()}var N=a(2521),k=a(1004);let C=(0,n.createContext)(null),S=()=>{try{return r.Capacitor.getPlatform()}catch(e){return console.debug("[RevenueCat] Failed to resolve platform",e),"web"}},A=async e=>{if(!e)throw Error("User ID is required");let t=(()=>{let e=S();return"ios"===e?N.A.revenuecat.apiKey:"android"===e?N.A.revenuecat.apiKeyGoogle:null})();return t?(await k.P.setLogLevel({level:k.E$.DEBUG}),await k.P.configure({apiKey:t,appUserID:e}),!0):(console.info("[RevenueCat] Skipping configuration: missing API key for platform"),!1)},E=async()=>{let{customerInfo:e}=await k.P.restorePurchases();return e},P=async e=>{let t="",a=S();if("ios"===a?t=(e=>{switch(e){case"weekly":return N.A.revenuecat.weeklyProductId||"";case"monthly":return N.A.revenuecat.monthlyProductId||"";case"annually":return N.A.revenuecat.annuallyProductId||"";case"lifetime":return N.A.revenuecat.lifetimeProductId||"";default:throw Error("Unsupported product type: ".concat(e))}})(e):"android"===a&&(t=N.A.revenuecat.googleGroupId||""),!t)throw Error("Product identifier is not configured");let{products:s}=await k.P.getProducts({productIdentifiers:[t]});if(!s.length)throw Error("No product found for ".concat(e));if("android"===a){let t="";switch(e){case"weekly":t=N.A.revenuecat.googleWeeklyProductId||"";break;case"annually":t=N.A.revenuecat.googleAnnuallyProductId||"";break;case"monthly":t=N.A.revenuecat.googleMonthlyProductId||"";break;case"lifetime":t=N.A.revenuecat.googleLifetimeProductId||"";break;default:throw Error("Unsupported product type: ".concat(e))}if(!t)throw Error("Product ID for ".concat(e," is not configured for Android"));let a=s.find(e=>e.identifier===t);if(!a)throw Error("No product found for ".concat(e," in Android"));return a}return s[0]},D=async e=>{let t=await P(e),a=await k.P.purchaseStoreProduct({product:t});return{success:a.customerInfo.allPurchasedProductIdentifiers.length>0,customerInfo:a.customerInfo}},I=e=>{let{userId:t,children:a}=e,[r,l]=(0,n.useState)(!1),[i,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[h,p]=(0,n.useState)(!1),[x,g]=(0,n.useState)([]),[f,w]=(0,n.useState)(null),[b,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&!r&&(async()=>{try{if(o(!0),!await A(t)){v(!1),m(null),g([]),w(null),d(null),p(!1);return}v(!0),m(null);let{customerInfo:e}=await k.P.getCustomerInfo();d(e),p(e.activeSubscriptions.length>0);let a=N.A.revenuecat.weeklyProductId,s=N.A.revenuecat.annuallyProductId,n=N.A.revenuecat.googleGroupId,r=[""];if("ios"===S()){if(!a||!s)throw Error("RevenueCat product IDs are not configured for iOS");r=[a,s]}else if("android"===S()){if(!n)throw Error("RevenueCat Google group ID is not configured for Android");r=[n]}let{products:l}=await k.P.getProducts({productIdentifiers:r});g(l);let i=l.find(e=>e.identifier===a),c=l.find(e=>e.identifier===s);i&&c&&w({weekly:{price:i.price.toString(),priceString:i.priceString},annually:{price:c.price.toString(),priceString:c.priceString}})}catch(e){m(e instanceof Error?e:Error("Unknown init error"))}finally{o(!1),l(!0)}})()},[t,r]);let y=async e=>{try{if(o(!0),m(null),!b){let e=Error("In-app purchases are not configured for this platform.");throw m(e),e}let t=await D(e);return d(t.customerInfo),p(t.customerInfo.activeSubscriptions.length>0),t}catch(e){throw m(e instanceof Error?e:Error("Unknown purchase error")),e}finally{o(!1)}},j=async()=>{try{if(o(!0),m(null),!b){let e=Error("In-app purchases are not configured for this platform.");throw m(e),e}let e=await E();return d(e),p(e.activeSubscriptions.length>0),e}catch(e){throw m(e instanceof Error?e:Error("Unknown restore error")),e}finally{o(!1)}};return(0,s.jsx)(C.Provider,{value:{isInitialized:r,isLoading:i,customerInfo:c,error:u,isPro:h,purchase:y,restore:j,products:x,pricing:f},children:a})};var L=a(4375),M=a(9184),T=a(6582),R=a(6888),z=a(5239);let _={src:"/_next/static/media/logo.edf7a71c.png",height:512,width:512,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAVFBMVEVMaXEcYYlifYxaS0sjhbFeb3IyX3i8ubV4lJl1lJ5KepOfsLMwao0mYohwk6CwsLelp5hHgJNvj56luL9oipd4pLCWsLgrpsavv8dptsBxmqlMjajS1i7tAAAAF3RSTlMA90Mi/vz6DDN8hWXj2WRL+PyMtP2SiaS1QfEAAAAJcEhZcwAACxMAAAsTAQCanBgAAABASURBVHicHYtJDoAgEMCKAgOKC7ig8v9/mqGHHpoUFOna4vHMwP3m81uBq+7OBKA0530AidXapEUmswz9ZdT7B0pRAdc6vmhwAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8};function U(){let[e,t]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=setInterval(()=>{t(t=>t>=100?(clearInterval(e),100):t+15*Math.random()+5)},200);return()=>clearInterval(e)},[]);let a="web"!==r.Capacitor.getPlatform();return(0,s.jsxs)(l.P.div,{initial:{opacity:1},animate:{opacity:0},transition:{duration:a?.5:.8,delay:a?1.5:1.8},className:"fixed inset-0 pointer-events-none overflow-hidden bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 flex flex-col items-center justify-center z-50",children:[(0,s.jsxs)("div",{className:"absolute inset-0 opacity-10",children:[(0,s.jsx)("div",{className:"absolute top-1/4 left-1/4 w-32 h-32 bg-white rounded-full blur-3xl"}),(0,s.jsx)("div",{className:"absolute bottom-1/4 right-1/4 w-24 h-24 bg-white rounded-full blur-2xl"}),(0,s.jsx)("div",{className:"absolute top-3/4 left-1/3 w-16 h-16 bg-white rounded-full blur-xl"})]}),(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center",children:[(0,s.jsx)(l.P.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"mb-8",children:(0,s.jsx)("div",{className:"bg-white p-6 rounded-3xl shadow-2xl flex items-center justify-center",children:(0,s.jsx)(z.default,{src:_,alt:"DocumentChat logo",width:56,height:56})})}),(0,s.jsxs)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.6},className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"DocumentChatApp"}),(0,s.jsx)("p",{className:"text-blue-100 text-lg",children:"Chat with your documents"})]}),(0,s.jsxs)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6,duration:.6},className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-64 h-1 bg-blue-400/30 rounded-full mb-4 overflow-hidden",children:(0,s.jsx)(l.P.div,{className:"h-full bg-white rounded-full",initial:{width:0},animate:{width:"".concat(e,"%")},transition:{duration:.3}})}),(0,s.jsx)(l.P.p,{className:"text-blue-100 text-sm",animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},children:"Loading amazing features..."})]}),(0,s.jsx)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:1,duration:.6},className:"flex flex-wrap justify-center gap-2 mt-8 max-w-xs",children:["Cross-Platform","Fast","Native","Modern"].map((e,t)=>(0,s.jsx)(l.P.span,{initial:{scale:0},animate:{scale:1},transition:{delay:1.2+.1*t},className:"px-3 py-1 bg-white/20 rounded-full text-white text-xs font-medium",children:e},e))})]}),(0,s.jsx)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((e,t)=>(0,s.jsx)(l.P.div,{className:"absolute w-2 h-2 bg-white/20 rounded-full",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")},animate:{y:[-20,20,-20],opacity:[.2,.8,.2]},transition:{duration:3+2*Math.random(),repeat:1/0,delay:2*Math.random()}},t))})]})}var B=a(6628),O=a(8023);function W(){return(0,s.jsxs)("svg",{fill:"currentColor",height:"20px",width:"20px",viewBox:"0 0 22.773 22.773",children:[(0,s.jsx)("path",{d:"M15.769,0c0.053,0,0.106,0,0.162,0c0.13,1.606-0.483,2.806-1.228,3.675c-0.731,0.863-1.732,1.7-3.351,1.573 c-0.108-1.583,0.506-2.694,1.25-3.561C13.292,0.879,14.557,0.16,15.769,0z"}),(0,s.jsx)("path",{d:"M20.67,16.716c0,0.016,0,0.03,0,0.045c-0.455,1.378-1.104,2.559-1.896,3.655c-0.723,0.995-1.609,2.334-3.191,2.334 c-1.367,0-2.275-0.879-3.676-0.903c-1.482-0.024-2.297,0.735-3.652,0.926c-0.155,0-0.31,0-0.462,0 c-0.995-0.144-1.798-0.932-2.383-1.642c-1.725-2.098-3.058-4.808-3.306-8.276c0-0.34,0-0.679,0-1.019 c0.105-2.482,1.311-4.5,2.914-5.478c0.846-0.52,2.009-0.963,3.304-0.765c0.555,0.086,1.122,0.276,1.619,0.464 c0.471,0.181,1.06,0.502,1.618,0.485c0.378-0.011,0.754-0.208,1.135-0.347c1.116-0.403,2.21-0.865,3.652-0.648 c1.733,0.262,2.963,1.032,3.723,2.22c-1.466,0.933-2.625,2.339-2.427,4.74C17.818,14.688,19.086,15.964,20.67,16.716z"})]})}function F(e){let{provider:t="google",setLoading:a}=e,{show:n}=(0,B.d)(),r=async()=>{null==a||a(!0);try{let{user:e}="google"===t?await O.uo.signInWithGoogle():await O.uo.signInWithApple();e&&n("Signed in successfully","success")}catch(e){n("Sign-in failed","error")}finally{null==a||a(!1)}};return(0,s.jsxs)("button",{onClick:r,className:"flex items-center justify-center gap-3 rounded-xl ".concat({google:"bg-base-100 text-base-content hover:bg-base-200",apple:"bg-black text-white hover:bg-gray-900"}[t]," w-full py-3.5 font-medium shadow-lg transition duration-300 transform hover:translate-y-[-2px]"),children:["google"===t?(0,s.jsx)("img",{className:"h-5 w-5",src:"/google.png",alt:"Google Icon"}):(0,s.jsx)(W,{}),"google"===t?"Continue with Google":"Continue with Apple"]})}var H=a(7328);function q(){let[e,t]=(0,n.useState)("signin"),[a,r]=(0,n.useState)(""),[l,i]=(0,n.useState)(""),[o,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(""),[m,h]=(0,n.useState)(null),p=(0,M.jq)(),{signInWithEmail:x,registerWithEmail:g,requestPasswordReset:f}=j(),{show:w}=(0,B.d)(),b=async t=>{if(null==t||t.preventDefault(),!a.trim()||!l.trim()){u("Please provide both email and password"),w("Please provide both email and password","error");return}c(!0);try{let t=a.trim();"signin"===e?(await (null==x?void 0:x(t,l)),w("Signed in","success")):(await (null==g?void 0:g(t,l)),w("Account created","success")),u(""),p.push("/app","root","replace")}catch(t){console.error("Email auth error",t);let e=(null==t?void 0:t.message)||String(t);u(e),w(e,"error");try{let e=await (0,H.Wm)(a.trim());(null==e?void 0:e.includes("google.com"))&&!e.includes("password")?h("google"):(null==e?void 0:e.includes("apple.com"))&&!e.includes("password")?h("apple"):h(null)}catch(e){}}finally{c(!1)}},v=async()=>{if(!a.trim())return void w("Please enter your email to reset password","info");c(!0);try{await (null==f?void 0:f(a.trim())),w("Password reset email sent","success")}catch(e){console.error("Reset password error",e),w((null==e?void 0:e.message)||String(e),"error")}finally{c(!1)}},y=async()=>{if(m){c(!0);try{"google"===m&&(await (0,H.G6)(),w("Signed in with Google","success"),p.push("/app","root","replace"))}catch(e){console.error("SSO sign-in failed",e),w((null==e?void 0:e.message)||"SSO sign-in failed","error")}finally{c(!1)}}};return(0,s.jsxs)("form",{onSubmit:b,className:"bg-base-200/50 p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("div",{className:"text-sm text-white",children:"signin"===e?"Sign in with email":"Register with email"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["signin"===e&&(0,s.jsx)("button",{type:"button",onClick:v,className:"text-xs text-blue-200",children:"Forgot password?"}),(0,s.jsx)("button",{type:"button",onClick:()=>t("signin"===e?"register":"signin"),className:"text-xs text-blue-200",children:"signin"===e?"Create account":"Have an account?"})]})]}),d?(0,s.jsx)("div",{className:"alert alert-error shadow-sm my-3",children:(0,s.jsx)("span",{className:"text-white text-sm truncate",children:d})}):null,m?(0,s.jsx)("div",{className:"alert bg-base-100 text-base-content border border-base-300 shadow-sm my-3",children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between gap-3",children:[(0,s.jsxs)("span",{className:"text-sm",children:["It looks like this email was registered with","google"===m?" Google":" Apple",". Please continue with ",m,"."]}),(0,s.jsx)("button",{type:"button",onClick:y,className:"btn btn-sm btn-primary",disabled:o,children:"Continue"})]})}):null,(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("input",{value:a,onChange:e=>r(e.target.value),placeholder:"Email",type:"email",className:"input input-bordered w-full bg-base-100 text-base-content placeholder:text-base-content/60"}),(0,s.jsx)("input",{value:l,onChange:e=>i(e.target.value),placeholder:"Password",type:"password",className:"input input-bordered w-full bg-base-100 text-base-content placeholder:text-base-content/60"}),(0,s.jsx)("button",{disabled:o,type:"submit",className:"btn btn-primary btn-block",children:o?"Working...":"signin"===e?"Sign in":"Register"})]})]})}var G=a(2090),V=a.n(G);let J=function(){return(0,s.jsx)(M.AO,{children:(0,s.jsx)(M.W9,{className:"bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 ".concat(V().className),children:(0,s.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-full grid place-items-center p-6",children:(0,s.jsx)("div",{className:"w-full max-w-md",children:(0,s.jsxs)(l.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},className:"flex flex-col items-center justify-center bg-white/10 backdrop-blur-md rounded-3xl p-6 sm:p-10 shadow-2xl space-y-6",children:[(0,s.jsx)(l.P.img,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},src:"/logo.png",className:"h-20 w-20 sm:h-24 sm:w-24 drop-shadow-lg",alt:"App Logo"}),(0,s.jsxs)("div",{className:"space-y-2 text-center",children:[(0,s.jsx)(l.P.h1,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.5},className:"text-white text-3xl font-bold",children:"Welcome Back"}),(0,s.jsx)(l.P.p,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.5},className:"text-white/90 font-medium",children:"Sign in to continue your journey"})]}),(0,s.jsxs)(l.P.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5},className:"w-full space-y-3",children:[(0,s.jsx)(K,{}),(0,s.jsx)(q,{})]}),(0,s.jsxs)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.5},className:"text-white/80 text-center text-xs",children:["By signing in, you agree to our"," ",(0,s.jsx)("a",{href:"https://document-chat.com/terms-conditions/",className:"link link-hover text-blue-200 underline",target:"_blank",rel:"noopener noreferrer",children:"Terms"})," ","and"," ",(0,s.jsx)("a",{href:"https://document-chat.com/privacy-policy/",className:"link link-hover text-blue-200 underline",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]})})})})})};function K(){let[e,t]=(0,n.useState)(!1);return e?(0,s.jsx)("div",{className:"flex justify-center py-4",children:(0,s.jsx)(l.P.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full"})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(F,{setLoading:t,provider:"google"})})}var Y=a(8623),X=a(3063);function Q(e){let{children:t,pageRef:a,header:n,collapse:i,toolbarClassName:o=""}=e,c="web"!==r.Capacitor.getPlatform();return(0,s.jsxs)(M.AO,{ref:a,className:"bg-base-100 text-base-content",children:[n&&(0,s.jsx)(M.eU,{collapse:"ios"===r.Capacitor.getPlatform()?i:void 0,children:(0,s.jsx)(M.ai,{className:o,children:n})}),(0,s.jsx)(M.W9,{className:"ion-padding bg-base-100 text-base-content",children:(0,s.jsx)(l.P.div,{initial:{opacity:.995,scale:.98},animate:{opacity:1,scale:1},transition:{duration:c?.25:.45},children:t})})]})}var Z=a(838);let $=a(5704).env.NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE||"",ee=$?/^https?:\/\//i.test($)?$:"https://".concat($):"";function et(){if(!ee)throw Error("DocumentChat API base is not configured. Set NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE to your backend URL (for example http://localhost:8000)")}async function ea(e){if((e.headers.get("content-type")||"").includes("text/html")){let t=await e.text();throw Error("Server returned HTML instead of JSON. This usually means NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE is missing or incorrect. Response snippet: ".concat(t.slice(0,200)))}return e.json()}let es=null;function en(e){return e?{Authorization:"Bearer ".concat(e)}:{}}async function er(e){if(e)return e;if(es)try{return await es()}catch(e){console.warn("tokenProvider failed",e)}return null}function el(e){if(!e)throw Error("Authentication required. Please sign in.");return e}function ei(e){if(401===e.status||403===e.status)throw Error("Authentication failed. Please sign in again.");throw Error("API request failed: ".concat(e.status))}async function eo(e,t){et();let a=el(await er(t)),s="".concat(ee,"/fullapi/").concat(encodeURIComponent(e)),n=await fetch(s,{method:"POST",headers:{...en(a),"Content-Type":"application/json"},body:JSON.stringify({name:e})});return n.ok||ei(n),ea(n)}let ec={createProject:eo,uploadDocuments:async function(e,t,a,s){et();let n=el(await er(s)),r="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/upload"),l=new FormData;t.forEach(e=>l.append("files",e)),void 0!==a&&l.append("highresmode",a.toString());let i=await fetch(r,{method:"POST",headers:{...en(n)},body:l});return i.ok||ei(i),ea(i)},listDocuments:async function(e,t){et();let a=el(await er(t)),s="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/documents"),n=await fetch(s,{headers:{...en(a)}});return n.ok||ei(n),ea(n)},deleteDocument:async function(e,t,a){et();let s=el(await er(a)),n="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/documents/").concat(encodeURIComponent(String(t)));try{console.debug("[documentChatApi] DELETE",n,{projectName:e,documentId:t})}catch(e){}let r=await fetch(n,{method:"DELETE",headers:{...en(s)}});return r.ok||ei(r),ea(r)},deleteChat:async function(e,t,a){et();let s=el(await er(a)),n="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)));try{console.debug("[documentChatApi] DELETE CHAT",n,{projectName:e,chatId:t})}catch(e){}let r=await fetch(n,{method:"DELETE",headers:{...en(s)}});return r.ok||ei(r),ea(r)},deleteProjectApi:async function(e,t){et();let a=el(await er(t)),s="".concat(ee,"/fullapi/").concat(encodeURIComponent(e));try{console.debug("[documentChatApi] DELETE PROJECT",s,{projectName:e})}catch(e){}let n=await fetch(s,{method:"DELETE",headers:{...en(a)}});return n.ok||ei(n),ea(n)},createChatByName:async function(e,t,a){et();let s=el(await er(a)),n="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(t));try{console.debug("[documentChatApi] CREATE CHAT BY NAME",n,{projectName:e,chatName:t})}catch(e){}let r=await fetch(n,{method:"POST",headers:{...en(s),"Content-Type":"application/json"},body:""});return r.ok||ei(r),ea(r)},getChatByProject:async function(e,t,a){et();let s=el(await er(a)),n="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t))),r=await fetch(n,{headers:{...en(s)}});return r.ok||ei(r),ea(r)},addMessage:async function(e,t,a,s){et();let n=el(await er(s)),r="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)),"/message"),l=await fetch(r,{method:"PUT",headers:{...en(n),"Content-Type":"application/json"},body:JSON.stringify({message:a,persona:"user"})});return l.ok||ei(l),ea(l)},listProjects:async function(e){et();let t=el(await er(e)),a=await fetch("".concat(ee,"/fullapi"),{headers:{...en(t)}});return a.ok||ei(a),ea(a)},listChats:async function(e,t){et();let a=el(await er(t)),s="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/chats"),n=await fetch(s,{headers:{...en(a)}});return n.ok||ei(n),ea(n)},renameChat:async function(e,t,a,s){et();let n=el(await er(s)),r="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)),"/rename"),l=new URLSearchParams({new_name:a}).toString(),i=await fetch(r,{method:"PUT",headers:{...en(n),Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:l});return i.ok||ei(i),ea(i)},setTokenProvider:function(e){es=e},clearTokenProvider:function(){es=null},quicksearchDocuments:async function(e,t,a){et();let s=el(await er(a)),n="".concat(ee,"/fullapi/").concat(encodeURIComponent(e),"/quicksearch/").concat(encodeURIComponent(t)),r=await fetch(n,{headers:{...en(s)}});return r.ok||ei(r),ea(r)}};var ed=a(9045),eu=a(3630);function em(e){let{chat:t,isSelected:a,isEditing:n,onClick:r,onDelete:i}=e;return(0,s.jsxs)(l.P.div,{className:"list-row flex items-center py-3 transition-all cursor-pointer ".concat(a?"bg-base-300":""),onClick:()=>r&&r(),whileTap:{scale:.98},children:[(0,s.jsxs)("div",{className:"flex gap-3 flex-1 items-center",children:[n&&(0,s.jsx)("div",{className:"flex items-center ml-1 mr-1",children:(0,s.jsx)("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center ".concat(a?"border-blue-500 bg-blue-500":"border-gray-500"),children:a&&(0,s.jsx)("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12L10 17L19 8",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})}),(0,s.jsx)("div",{className:"avatar w-14 h-14 flex-shrink-0",children:(0,s.jsx)("div",{className:"w-14 h-14 rounded-full overflow-hidden ring-1 ring-base-300",children:t.image?(0,s.jsx)("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-medium text-lg",children:(t.name||"").substring(0,2).toUpperCase()})})})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col justify-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h3",{className:"font-medium",children:t.name}),"PENDING"===t.processingState&&(0,s.jsxs)(l.P.div,{className:"relative w-4 h-4 flex items-center justify-center",title:"Processing","aria-label":"Processing",initial:{opacity:0},animate:{opacity:1},children:[(0,s.jsx)(l.P.span,{className:"absolute inline-block rounded-full bg-yellow-300/40","aria-hidden":!0,initial:{scale:.6,opacity:.8},animate:{scale:1.6,opacity:0},transition:{repeat:1/0,duration:1.2,ease:"easeOut"},style:{width:18,height:18}}),(0,s.jsx)("span",{className:"relative inline-block w-2.5 h-2.5 rounded-full bg-yellow-400 shadow-sm"})]})]}),(0,s.jsx)("div",{className:"text-gray-400 text-sm",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:String(t.message||"")}})})]})]}),!n&&(0,s.jsxs)("div",{className:"flex flex-col items-end justify-center gap-1",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:t.time}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[t.unreadCount?(0,s.jsx)("div",{className:"badge badge-primary badge-outline",children:t.unreadCount}):t.isRead?(0,s.jsx)(ed.A,{size:18,className:"text-blue-500"}):null,(0,s.jsx)("button",{className:"btn btn-ghost btn-sm text-error",onClick:e=>{e.stopPropagation(),i&&i(t.id,t.name)},title:"Delete chat",children:(0,s.jsx)(eu.A,{size:16})})]})]})]})}var eh=a(7041);function ep(e){let{title:t,modalRef:a,presentingElement:n,children:r,left:l,right:i}=e;return(0,s.jsx)(M.Sb,{ref:a,presentingElement:n||void 0,children:(0,s.jsxs)("div",{className:"h-full",children:[(l||i||t)&&(0,s.jsxs)(M.eU,{children:[(l||i)&&(0,s.jsxs)(M.ai,{children:[l&&(0,s.jsx)(M.QW,{slot:"start",children:l}),i&&(0,s.jsx)(M.QW,{slot:"end",children:i})]}),t&&(0,s.jsx)(M.ai,{children:(0,s.jsx)(M.BC,{className:"w-full text-center",children:t})})]}),(0,s.jsx)(M.W9,{children:(0,s.jsx)("div",{className:"mt-4",children:r})})]})})}function ex(){let e=(0,n.useRef)(null),[t,a]=(0,n.useState)(!1);return{modalRef:e,isOpen:t,open:function(){try{var t,s;null==(s=e.current)||null==(t=s.present)||t.call(s)}catch(e){}a(!0)},close:function(){try{var t,s;null==(s=e.current)||null==(t=s.dismiss)||t.call(s)}catch(e){}a(!1)}}}let eg=function(e){let{doc:t,presentingElement:a,onClose:r,onDelete:i}=e,{modalRef:o,open:c,close:d}=ex();n.useEffect(()=>{t?c():d()},[t]);let u=t?t.filename||t.name||String(t.id||""):"",m=t?t.zoomed_in_url||t.cover_url||t.previewUrl||t.url:null,h=t&&(t.url||t.download_url||m)||"",p=t?String(t.content||t.summary||t.excerpt||u):"";return(0,s.jsx)(ep,{title:u?u.length>32?u.slice(0,32)+"…":u:"Preview",modalRef:o,presentingElement:a,left:(0,s.jsx)("button",{onClick:r,children:"Close"}),right:(0,s.jsxs)("div",{className:"flex gap-2",children:[t&&(t.url||t.download_url)?(0,s.jsx)("a",{href:t.url||t.download_url,download:!0,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-sm",title:"Download document",children:"Download"}):null,t?(0,s.jsx)("button",{className:"btn btn-ghost text-error btn-sm",onClick:()=>i&&t&&i(t),title:"Delete document",children:"Delete"}):null]}),children:t?(0,s.jsxs)("div",{className:"p-4",children:[m?(0,s.jsx)("a",{href:h,download:!0,target:"_blank",rel:"noopener noreferrer",title:"Download document","aria-label":"Open ".concat(u," in new tab"),className:"block",children:(0,s.jsxs)("div",{className:"relative w-full h-96",children:[(0,s.jsx)(l.P.img,{src:m,alt:u,className:"w-full h-full object-contain cursor-pointer",initial:{scale:.98,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.98,opacity:0},transition:{duration:.22}}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-end",children:(0,s.jsx)("div",{className:"w-full p-3",children:(0,s.jsxs)("div",{className:"bg-black bg-opacity-60 text-white rounded-md p-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold truncate",children:u}),(0,s.jsx)("div",{className:"mt-1 text-xs leading-tight",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:p})]})})})]})}):(0,s.jsx)("div",{className:"w-full h-96 bg-base-300 flex items-center justify-center text-base-content",children:(0,s.jsx)("div",{className:"p-3 w-full",children:(0,s.jsxs)("div",{className:"bg-black bg-opacity-60 text-white rounded-md p-2 mx-auto max-w-full",children:[(0,s.jsx)("div",{className:"text-sm font-semibold truncate",children:u}),(0,s.jsx)("div",{className:"mt-1 text-xs leading-tight",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:p})]})})}),(0,s.jsx)("div",{className:"mt-3 text-sm text-gray-300",children:(0,s.jsx)(eh.oz,{children:p})})]}):null})};var ef=a(3263);function ew(e){let{item:t,className:a}=e;return(0,s.jsxs)("div",{className:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}("flex text-primary text-lg font-medium justify-between active:brightness-90 transition-all duration-300 items-center gap-2 px-4 py-3.5",a),onClick:t.onClick,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[t.icon," ",t.label]}),t.suffix?t.suffix:t.withArrow?(0,s.jsx)(ef.A,{className:"text-gray-500",size:22}):null]})}var eb=a(109);function ev(){let{value:e,onChange:t,placeholder:a="Search",id:r="search-input"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[l,i]=(0,n.useState)(!1),[o,c]=(0,n.useState)(e||"");return(0,n.useEffect)(()=>{void 0!==e&&c(e)},[e]),(0,n.useEffect)(()=>{let e=e=>{l&&e.target&&"closest"in e.target&&!e.target.closest("#".concat(r))&&i(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[l,r]),(0,s.jsxs)("label",{id:r,className:"flex rounded-lg bg-base-200 dark:bg-base-300 py-2 px-4 items-center gap-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)(eb.A,{size:18,className:"text-base-content/60"})}),(0,s.jsx)("input",{value:o,onChange:e=>{let a=e.target.value;c(a),t&&t(a)},onClick:()=>i(!0),className:"appearance-none placeholder:text-gray-400 text-lg bg-transparent outline-none",placeholder:a})]})}var ey=a(6140),ej=a(6615);function eN(e){let{name:t,progress:a,subtitle:n,onCancel:r,onRetry:l,failed:i}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-3 bg-base-200 p-3 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:t}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[a,"%"]})]}),n?(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:n}):null,(0,s.jsx)("div",{className:"w-full bg-base-300 rounded-full h-2 mt-2 overflow-hidden",children:(0,s.jsx)("div",{className:"h-2 bg-blue-500",style:{width:"".concat(a,"%")}})})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:i?(0,s.jsx)("button",{onClick:l,className:"btn btn-ghost btn-xs",children:(0,s.jsx)(ey.A,{size:16})}):(0,s.jsx)("button",{onClick:r,className:"btn btn-ghost btn-xs",children:(0,s.jsx)(ej.A,{size:16})})})]})}function ek(e,t){var a,s,n,r,l,i,o,c,d,u,m,h,p,x,g,f,w,b,v,y,j,N;if(!e||"object"!=typeof e)return{id:String(Date.now()),projectId:t,name:void 0};let k=null!=(r=null!=(n=null!=(s=null!=(a=e.id)?a:e._id)?s:e.documentId)?n:e.name)?r:Date.now(),C=null!=(i=null!=(l=e.projectId)?l:e.project)?i:t,S=null!=(c=null!=(o=e.name)?o:e.filename)?c:e.title,A=null!=(u=null!=(d=e.mimeType)?d:e.content_type)?u:e.type,E=null!=(x=null!=(p=null!=(h=null!=(m=e.url)?m:e.fileUrl)?h:e.download_url)?p:e.s3_url)?x:e.signed_url,P=null!=(v=null!=(b=null!=(w=null!=(f=null!=(g=e.preview)?g:e.previewUrl)?f:e.thumbnail)?w:e.zoomed_in_url)?b:e.cover_url)?v:e.cover,D="number"==typeof e.size?e.size:"number"==typeof e.length?e.length:void 0,I=null!=(N=null!=(j=null!=(y=e.uploadedAt)?y:e.createdAt)?j:e.updatedAt)?N:void 0;return{id:String(k),projectId:"string"==typeof C?C:t,name:"string"==typeof S?S:void 0,mimeType:"string"==typeof A?A:void 0,url:"string"==typeof E?E:void 0,previewUrl:"string"==typeof P?P:void 0,size:"number"==typeof D?D:void 0,uploadedAt:"string"==typeof I||"number"==typeof I?I:void 0}}var eC=a(2614),eS=a(1165),eA=a(4979),eE=a(8527),eP=a(2036),eD=a(5704);let eI=e=>[{id:"welcome",text:"Hey, I know everything about the documents you uploaded in this project - feel free to ask me any questions about them :).",sender:"other",time:new Date().toISOString(),status:"read"}],eL="Hey, I know everything about the documents you uploaded in this project - feel free to ask me any questions about them :).";function eM(e){let{chatId:t}=e;(0,M.jq)();let[a,r]=(0,n.useState)(""),[l,i]=(0,n.useState)([]),[o,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[m,h]=(0,n.useState)(!1),[p,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),{token:w}=j(),b=(0,n.useRef)(null),v=(0,n.useRef)(null),y=(0,n.useRef)(null),N=(0,n.useRef)(null);(0,n.useRef)(null),(0,n.useEffect)(()=>{if(!w)return void ec.clearTokenProvider();try{ec.setTokenProvider(async()=>(0,H.p9)())}catch(e){console.warn("Failed to register token provider",e)}return()=>{try{ec.clearTokenProvider()}catch(e){console.warn("Failed to clear token provider",e)}}},[w]);let[k,C]=(0,n.useState)("IDLE"),[S,A]=(0,n.useState)(void 0);(0,n.useEffect)(()=>{f("PENDING"===k)},[k]);let E=(0,B.d)(),[P,D]=(0,n.useState)(null),[I,L]=(0,n.useState)(null),{modalRef:T,open:R,close:z}=ex(),[_,U]=(0,n.useState)(""),[O,W]=(0,n.useState)(null),[F,q]=(0,n.useState)(""),[G,V]=(0,n.useState)(1),[J,K]=(0,n.useState)(!0),[Y,X]=(0,n.useState)(!0),[$,ee]=(0,n.useState)(!1),[et,ea]=(0,n.useState)(0),{modalRef:es,open:en,close:er}=ex(),[el,ei]=(0,n.useState)(null),{modalRef:eo,open:ed,close:em}=ex(),[ef,ew]=(0,n.useState)(null),[eb,ev]=(0,n.useState)(!1),ey=/here is (the )?answer( (from|based on) )? ?your documents/i,eN=(0,n.useRef)([]),[eE,eP]=(0,n.useState)(0),[eM,ez]=(0,n.useState)(!1),e_=(0,n.useCallback)((e,t)=>{try{let a=(()=>{if(void 0===t)return"";if("string"==typeof t)return t;try{return JSON.stringify(t,(e,t)=>"function"==typeof t?"[function]":t,2)}catch(e){try{return String(t)}catch(e){return"[unserializable]"}}})(),s="".concat(new Date().toISOString()," [").concat(e,"] ").concat(a);eN.current.push(s),eN.current.length>200&&eN.current.shift(),eP(e=>e+1),console.log("[DBG]",e,t)}catch(t){console.log("[DBG] failed to record",e,t)}},[]),eU=e=>{if(e&&"object"==typeof e&&e.sourceDocuments&&Array.isArray(e.sourceDocuments))return e.sourceDocuments},eB=(e,t)=>{var a;return ek(e,null!=(a=null!=t?t:S)?a:"default")},eO=(0,n.useCallback)((e,t)=>{try{console.debug("[mergeMessages] local:",e,"incoming:",t)}catch(e){}let a=new Map;for(let t of e)a.set(t.id,{...t,time:t.time||new Date().toISOString()});for(let e of t){let t={...e,time:e.time||new Date().toISOString(),status:e.status||"read"},s=(t.text||"").trim(),n=ey.test(s);if(n){let e=new Set((eU(t)||[]).map(e=>String(e.id)));if(Array.from(a.values()).some(t=>{let a=(t.text||"").trim();if(a.length>Math.max(32,s.length+20))return!0;let n=new Set((eU(t)||[]).map(e=>String(e.id)));if(n.size>0&&e.size>0){let t=0;for(let a of e)n.has(a)&&t++;if(t>0&&a.length>=s.length)return!0;let r=!0;for(let t of e)if(!n.has(t)){r=!1;break}if(r&&a.length>=s.length)return!0}return!1})){e_("mergeMessages.skipPlaceholder",{incomingId:t.id,reason:"found richer/overlapping existing message"});continue}}if(n){e_("mergeMessages.skipPermanentPlaceholder",{incomingId:t.id,text:s});continue}if("me"===t.sender){for(let[e,n]of a.entries())if("me"===n.sender&&["sending","sent","delivered"].includes(n.status||"")&&(n.text||"").trim()===s){e_("mergeMessages.replaceOptimistic",{tempId:e,serverId:t.id}),a.delete(e);break}}a.set(t.id,t)}let s=Array.from(a.values()).map((e,t)=>{let a=e.time,s=t;if(a){let e=Date.parse(a);if(Number.isNaN(e)){let e=a.match(/^(\d{1,2}):(\d{2})$/);if(e){let a=new Date;a.setHours(Number(e[1])),a.setMinutes(Number(e[2])),a.setSeconds(0),a.setMilliseconds(t),s=a.getTime()}}else s=e}return{message:e,sortKey:s}});return s.sort((e,t)=>e.sortKey-t.sortKey),s.map(e=>e.message)},[]),eW=(0,n.useCallback)(()=>{setTimeout(()=>{y.current&&y.current.scrollIntoView({behavior:"smooth"})},350)},[y]),eF=async()=>{if(ef){ev(!0);try{if("chats"===ef.type){let e=ef.id?[ef.id]:[t];try{for(let t of e)await ec.deleteChat(String(S||"default"),t)}catch(e){console.error("Error deleting chats on server:",e),null==E||E.show("Could not delete chat(s). Please try again.","error");return}try{await Z.Ay.clear(),null==E||E.show("Chat deleted and storage cleared","success")}catch(t){console.error("Error clearing storage:",t);try{let t=(await Z.Ay.loadChats()||[]).filter(t=>!e.includes(t.id));await Z.Ay.saveChats(t);let a=e.map(e=>Z.Ay.deleteChatMessages(e));await Promise.all(a),null==E||E.show("Chat deleted","success")}catch(e){console.error("Error cleaning up local chat storage:",e),null==E||E.show("Chat deleted on server but local cleanup failed","info")}}try{window.dispatchEvent(new CustomEvent("chat-deleted",{detail:{chatId:t}})),window&&window.history&&window.history.length>1?window.history.back():window.location.href="/app/chats"}catch(e){}return}if("document"===ef.type){let e;if(ef.extra&&"object"==typeof ef.extra){let t=ef.extra;"string"==typeof t.id&&(e=t)}if(!e)return;try{let t=String(S||"default");await ec.deleteDocument(t,e.id)}catch(e){console.warn("deleteDocument API failed",e)}try{await Z.Ay.clear(),null==E||E.show("Document deleted and storage cleared","success")}catch(t){console.error("Error clearing storage:",t);try{let t=(await Z.Ay.loadDocuments()||[]).filter(t=>t.id!==e.id);await Z.Ay.saveDocuments(t);try{window.dispatchEvent(new CustomEvent("documents-updated",{detail:{projectId:S||"default",documents:t}}))}catch(e){}null==E||E.show("Document deleted","success")}catch(e){console.error("Error removing document from storage",e),null==E||E.show("Document deleted on server but local cleanup failed","info")}}i(t=>t.map(t=>{let a=eU(t);return a&&Array.isArray(a)?{...t,sourceDocuments:a.filter(t=>String(t.id)!==e.id)}:t})),c(t=>t.map(t=>{let a=eU(t);return a&&Array.isArray(a)?{...t,sourceDocuments:a.filter(t=>String(t.id)!==e.id)}:t}));try{er()}catch(e){}ei(null),null==E||E.show("Document deleted","success");try{let e=String(S||"default"),t=await ec.listDocuments(e);if(Array.isArray(t)){let e=(t||[]).map(e=>eB(e,String(S||"default")));try{await Z.Ay.saveDocuments(e);try{window.dispatchEvent(new CustomEvent("documents-updated",{detail:{projectId:S||"default",documents:e}}))}catch(e){}}catch(e){console.warn("Could not save refreshed documents locally",e)}}}catch(e){}}}finally{ev(!1),ew(null);try{em()}catch(e){}}}};(0,n.useEffect)(()=>{let e=()=>{let e=v.current;e&&ee(e.scrollHeight-e.scrollTop-e.clientHeight>500)},t=v.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[]),(0,n.useEffect)(()=>{D(b.current)},[]),(0,n.useEffect)(()=>{!async function(){try{u(!0);let e=(await Z.Ay.loadChats()).find(e=>e.id===t);e&&(L({name:e.name}),e.projectId&&A(e.projectId));let a=await Z.Ay.getMessageCount(t);if(ea(a),0===a){let e=eI(t);await Z.Ay.saveChatMessages(t,e),i(e),c(e),K(!1)}else{let s=(await Z.Ay.loadChatMessagesPaginated(t,1,20)).map(e=>({...e,time:e.time||new Date().toISOString()}));c(s),K(a>20);let n=(await Z.Ay.loadChatMessages(t)).map(e=>({...e,time:e.time||new Date().toISOString()}));i(n);try{let a=null,s=(null==e?void 0:e.projectId)||"default";try{a=await ec.getChatByProject(s,t),console.debug("[loadChatData] chatFromApi:",a),e_("loadChatData.chatFromApi",a)}catch(e){throw console.warn("getChatByProject failed for",s,e),e}if(a&&(a.processing_state||a.messages)){let e=a.processing_state||"IDLE";if(C(e),"PENDING"===k&&"DONE"===e?null==E||E.show("Processing finished","success"):"PENDING"===k&&"ERROR"===e&&(null==E||E.show("Processing failed","error")),Array.isArray(a.messages)&&a.messages.length>0){let e=a.messages.map(e=>{let t=e||{},a={id:t.id&&String(t.id)||String(Date.now()),text:String(t.message||t.text||""),sender:"assistant"===t.persona||"bot"===t.persona?"other":"me",time:t.created_at&&String(t.created_at)||new Date().toISOString(),status:"read"};return Array.isArray(t.documents)&&t.documents.length>0&&(a.sourceDocuments=t.documents.map(e=>eB(e))),a});console.debug("[loadChatData] mapped messages from API:",e),e_("loadChatData.mapped",e),i(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eL);return eO(a,e)}),c(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eL);return eO(a,e).slice(-20)})}}}catch(e){console.warn("Could not fetch chat from API",e)}}}catch(a){console.error("Error loading chat data:",a);let e=eI(t);i(e),c(e),K(!1)}finally{u(!1),X(!1)}}()},[t]),(0,n.useEffect)(()=>{if(!Y&&!m&&o.length>0){var e;let t=o[o.length-1];t&&("me"===t.sender||(null==(e=l[l.length-1])?void 0:e.id)===t.id)&&eW()}},[o,Y,m,l,eW]),(0,n.useEffect)(()=>{!d&&l.length>0&&Z.Ay.saveChatMessages(t,l).catch(e=>{console.error("Error saving messages:",e)})},[l,d,t]);let eH=(0,n.useCallback)(async()=>{if(m||!J)return Promise.resolve(!1);try{h(!0);let e=G+1,a=v.current,s=(null==a?void 0:a.scrollHeight)||0,n=(null==a?void 0:a.scrollTop)||0,r=await Z.Ay.loadChatMessagesPaginated(t,e,20);if(!(r.length>0))return K(!1),Promise.resolve(!1);{c(e=>[...r,...e]),V(e);let t=20*e;return K(et>t),new Promise(e=>{setTimeout(()=>{if(a){let e=a.scrollHeight;a.scrollTop=n+(e-s)}e(!0)},10)})}}catch(e){return console.error("Error loading more messages:",e),Promise.resolve(!1)}finally{h(!1)}},[t,G,J,m,et]);(0,n.useEffect)(()=>{let e=null,t=()=>{let t=v.current;t&&t.scrollTop<50&&J&&!m&&(e&&clearTimeout(e),e=setTimeout(()=>{eH().catch(e=>{console.error("Error in auto-load more:",e)})},200))},a=v.current;if(a)return a.addEventListener("scroll",t),()=>{a.removeEventListener("scroll",t),e&&clearTimeout(e)}},[J,m,eH]),(0,n.useEffect)(()=>{let e=null,a=async()=>{e=setInterval(async()=>{try{let e=await (0,H.p9)();if(!e)return;let a=null,s=S||"default";try{a=await ec.getChatByProject(s,t,e),console.debug("[poll] chatFromApi:",a),e_("poll.chatFromApi",a)}catch(e){console.warn("Polling getChatByProject failed for",s,e);return}if(!a)return;let n=a&&a.processing_state||"IDLE";if(C(String(n)),Array.isArray(a.messages)&&a.messages.length>0){let e=a.messages.map(e=>({id:e.id||String(Date.now()),text:e.message||e.text||"",sender:"assistant"===e.persona||"bot"===e.persona?"other":"me",time:e.created_at||new Date().toISOString(),status:"read",...Array.isArray(e.documents)&&e.documents.length>0?{sourceDocuments:e.documents}:{}}));console.debug("[poll] mapped messages:",e),e_("poll.mapped",e),i(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eL);return eO(a,e)}),c(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eL);return eO(a,e).slice(-20)}),ea(t=>Math.max(t,e.length))}}catch(e){console.warn("Polling error",e)}},2e3)};return"PENDING"===k&&a().catch(e=>console.warn(e)),()=>{e&&clearInterval(e)}},[t,k,w]),(0,n.useCallback)(e=>{console.log("Creating automatic response message");let a={id:Date.now().toString(),text:e,sender:"other",time:new Date().toISOString(),status:"read"};console.log("Adding automatic response to messages:",a),i(e=>{let s=[...e,a];return c(e=>[...e,a]),ea(e=>e+1),Z.Ay.saveChatMessages(t,s).then(()=>console.log("Automatic response saved to storage")).catch(e=>console.error("Error saving automatic response:",e)),s}),eV(e).then(()=>console.log("Chat list updated with automatic response")).catch(e=>console.error("Error updating chat list:",e))},[t]);let eq=async()=>{let e=(_||"").trim();if(e)try{let a=String(S||"default");try{await ec.renameChat(a,t,e)}catch(s){try{let s=eD.env.NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE||"",n="".concat(s,"/fullapi/").concat(encodeURIComponent(a),"/chats/").concat(encodeURIComponent(String(t)),"/rename"),r=await (0,H.p9)();await fetch(n,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded",...r?{Authorization:"Bearer ".concat(r)}:{}},body:new URLSearchParams({new_name:e}).toString()})}catch(e){console.warn("Rename fallback failed",e)}}try{let a=(await Z.Ay.loadChats()||[]).map(a=>a.id===t?{...a,name:e}:a);await Z.Ay.saveChats(a)}catch(e){console.warn("Could not persist renamed chat locally",e)}L(t=>t?{...t,name:e}:{name:e});try{z()}catch(e){}null==E||E.show("Chat renamed","success")}catch(e){console.error("Rename chat failed",e),null==E||E.show("Could not rename chat","error")}},eG=async()=>{if(a.trim()&&!p){x(!0);let n={id:Date.now().toString(),text:a.trim(),sender:"me",time:new Date().toISOString(),status:"sending"};r(""),console.debug("[sendMessage] optimistic newMessage:",n),e_("sendMessage.optimistic",n),i(e=>eO(e,[n])),c(e=>eO(e,[n]).slice(-20));try{var e,s;let n=(null==(s=await Z.Ay.loadChats())||null==(e=s.find(e=>e.id===t))?void 0:e.projectId)||"default";try{await ec.addMessage(n,t,a.trim())}catch(e){console.warn("api.addMessage failed, falling back to manual PUT",e);try{let e=eD.env.NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE||"",s="".concat(e,"/fullapi/").concat(encodeURIComponent(n),"/chats/").concat(encodeURIComponent(String(t)),"/message"),r=await (0,H.p9)();await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{}},body:JSON.stringify({message:a.trim(),persona:"user"})})}catch(e){console.warn("Fallback add message failed",e)}}C("PENDING");try{let e=(await Z.Ay.loadChats()||[]).map(e=>e.id===t?{...e,processingState:"PENDING"}:e);await Z.Ay.saveChats(e)}catch(e){console.warn("Could not persist processing state",e)}await eV(a.trim())}catch(e){console.error("Send message failed",e),i(e=>e.map(e=>e.id===n.id?{...e,status:"failed"}:e)),c(e=>e.map(e=>e.id===n.id?{...e,status:"failed"}:e))}finally{x(!1)}}},eV=async e=>{try{let a=(await Z.Ay.loadChats()||[]).map(a=>a.id===t?{...a,message:e,time:"Just now",isRead:!0}:a);await Z.Ay.saveChats(a)}catch(e){console.error("Error updating chat last message:",e)}},eJ=()=>{W(null),q("")},eK=async()=>{if(!O||!F.trim())return;i(e=>e.map(e=>e.id===O?{...e,text:F.trim(),isEdited:!0}:e)),c(e=>e.map(e=>e.id===O?{...e,text:F.trim(),isEdited:!0}:e));let e=l[l.length-1];e&&e.id===O&&await eV(F.trim()+" (edited)"),W(null),q("")},eY=async e=>{i(t=>{let a=t.map(t=>t.id===e?{...t,isDeleted:!0,text:"This message was deleted"}:t),s=t[t.length-1];if(s&&s.id===e){let e=a.filter(e=>!e.isDeleted).pop();e?eV(e.text):eV("No messages")}return a}),c(t=>t.map(t=>t.id===e?{...t,isDeleted:!0,text:"This message was deleted"}:t))},eX="PENDING"===k;return(0,s.jsx)(Q,{pageRef:b,header:(0,s.jsx)("div",{className:"navbar bg-base-200 text-base-content shadow-lg",children:(0,s.jsxs)("div",{className:"w-full grid grid-cols-[min-content_1fr_min-content] items-center gap-2 px-2",children:[(0,s.jsx)("div",{className:"col-start-1 col-end-2",children:(0,s.jsx)(M.QW,{children:(0,s.jsx)(M.el,{defaultHref:"/app/chats",text:"",className:"btn btn-ghost btn-circle btn-sm"})})}),(0,s.jsxs)("div",{className:"col-start-2 col-end-3 overflow-hidden text-center",children:[(0,s.jsx)("h1",{className:"text-lg font-semibold truncate w-full whitespace-nowrap text-base-content",children:(0,s.jsx)("button",{onClick:()=>{U((null==I?void 0:I.name)||""),R()},className:"text-inherit text-left w-full truncate","aria-label":"Rename chat",children:(null==I?void 0:I.name)||"Loading..."})}),g&&(0,s.jsxs)("div",{className:"text-xs text-primary flex items-center gap-1 justify-center mt-0",children:[(0,s.jsx)("span",{className:"loading loading-dots loading-xs"}),"typing..."]})]}),(0,s.jsx)("div",{className:"col-start-3 col-end-4 justify-self-end",children:(0,s.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm hover:text-error",onClick:()=>{ew({type:"chats",id:t,name:null==I?void 0:I.name}),ed()},title:"Delete chat",children:(0,s.jsx)(eu.A,{size:18})})})]})}),children:(0,s.jsxs)("div",{className:"w-full flex flex-col flex-1 min-h-0 bg-transparent text-base-content chat-content",children:[(0,s.jsx)("div",{ref:v,className:"flex-1 overflow-y-auto px-4 py-6 mb-auto relative min-h-0 pb-32 bg-transparent",children:d?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-base-content/60 text-sm",children:"Loading messages..."})]}):0===o.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[(0,s.jsx)("div",{className:"text-5xl opacity-20",children:"\uD83D\uDCAC"}),(0,s.jsxs)("p",{className:"text-base-content/60 text-center",children:["No messages yet.",(0,s.jsx)("br",{}),"Start a conversation!"]})]}):(0,s.jsxs)(s.Fragment,{children:[J&&(0,s.jsx)("div",{className:"flex justify-center mb-6",children:m?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-primary",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-sm"}),(0,s.jsx)("span",{className:"text-sm",children:"Loading older messages..."})]}):(0,s.jsxs)("button",{onClick:()=>{eH().catch(e=>{console.error("Error loading more messages:",e)})},className:"btn btn-sm btn-ghost gap-2","aria-label":"Load earlier messages",children:[(0,s.jsx)(eC.A,{size:16}),"Load earlier messages"]})}),o.map(e=>{let a="other"===e.sender&&!!(e.sourceDocuments&&Array.isArray(e.sourceDocuments)&&e.sourceDocuments.length>0);return(0,s.jsxs)("div",{children:[(0,s.jsx)(eT,{message:e,chatId:t,onRetry:"failed"===e.status?()=>{var t;return t=e.id,void(i(e=>e.map(e=>e.id===t?{...e,status:"sending"}:e)),c(e=>e.map(e=>e.id===t?{...e,status:"sending"}:e)),setTimeout(()=>{i(e=>e.map(e=>e.id===t?{...e,status:"sent"}:e)),c(e=>e.map(e=>e.id===t?{...e,status:"sent"}:e)),setTimeout(()=>{i(e=>e.map(e=>e.id===t?{...e,status:"delivered"}:e)),c(e=>e.map(e=>e.id===t?{...e,status:"delivered"}:e))},1e3)},1500))}:void 0,onEdit:"me"===e.sender&&!e.isDeleted&&["sent","delivered","read"].includes(e.status||"")?()=>{var t,a;return t=e.id,a=e.text,void(W(t),q(a),setTimeout(()=>{N.current&&N.current.focus()},50))}:void 0,onDelete:"me"!==e.sender||e.isDeleted?void 0:()=>eY(e.id)},e.id),a&&(0,s.jsxs)("div",{className:"mb-4 ml-12",children:[(0,s.jsx)("div",{className:"divider divider-start text-xs opacity-60",children:"Source documents"}),(0,s.jsx)("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin",children:e.sourceDocuments.map(e=>{let t=e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,a=e.filename||e.name,n=e.content||e.summary||e.excerpt||e.previewText||"No preview available";return(0,s.jsx)("div",{className:"w-36 flex-shrink-0 group",role:"button",tabIndex:0,"aria-label":"Open document ".concat(String(a)),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),ei(e),en())},onClick:()=>{ei(e),en()},children:(0,s.jsxs)("div",{className:"card card-compact bg-base-200 shadow-md hover:shadow-lg transition-shadow overflow-hidden cursor-pointer border border-base-300",children:[(0,s.jsxs)("figure",{className:"relative h-24 bg-base-300",children:[t?(0,s.jsx)("img",{src:t,alt:String(a),className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-base-content/50 text-xs p-2 text-center",children:"\uD83D\uDCC4"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,s.jsx)("div",{className:"flex items-center justify-center rounded-full w-8 h-8 bg-primary text-white shadow-lg",children:(0,s.jsx)("span",{className:"text-sm",children:"\uD83D\uDD0D"})})})]}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("h3",{className:"card-title text-xs truncate",children:String(a)}),(0,s.jsx)("div",{className:"line-clamp-2 text-[11px] text-base-content/70",children:(0,s.jsx)(eh.oz,{children:String(n)})})]})]})},e.id)})})]})]},e.id)}),eX&&(0,s.jsx)(eR,{}),$&&(0,s.jsx)("button",{onClick:()=>{eW()},className:"btn btn-circle btn-primary shadow-xl fixed bottom-28 right-4 z-10","aria-label":"Scroll to bottom",children:(0,s.jsx)(eS.A,{size:20})}),(0,s.jsx)("div",{ref:y})]})}),eM&&(0,s.jsxs)("div",{className:"mockup-code fixed bottom-32 right-4 z-50 max-w-xs max-h-80 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2 px-4 pt-2",children:[(0,s.jsx)("div",{className:"font-medium",children:"Debug Events"}),(0,s.jsxs)("div",{className:"text-xs opacity-60",children:[eN.current.length," items"]})]}),(0,s.jsx)("div",{className:"space-y-1 px-4 pb-2",children:eN.current.slice().reverse().map((e,t)=>(0,s.jsx)("div",{className:"whitespace-pre-wrap break-words",children:e},t))})]}),(0,s.jsx)(eg,{doc:el,presentingElement:P,onClose:()=>{try{er()}catch(e){}ei(null)},onDelete:e=>{ew({type:"document",extra:e}),ed()}}),(0,s.jsx)(ep,{title:"Rename Chat",modalRef:T,presentingElement:P,left:(0,s.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{U("");try{z()}catch(e){}},children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"label",children:[(0,s.jsx)("span",{className:"label-text font-medium",children:"Chat Name"}),(0,s.jsx)("span",{className:"label-text-alt text-base-content/50",children:"Required"})]}),(0,s.jsx)("input",{value:_,onChange:e=>U(e.target.value),placeholder:"Chat name",className:"input input-bordered input-lg w-full",onKeyDown:e=>{"Enter"===e.key&&eq()},autoFocus:!0})]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{U("");try{z()}catch(e){}},children:"Cancel"}),(0,s.jsx)("button",{className:"btn btn-primary gap-2",onClick:()=>eq(),disabled:!_.trim(),children:"Rename"})]})]})}),(0,s.jsx)(ep,{title:"Confirm Delete",modalRef:eo,presentingElement:P,left:(0,s.jsx)("button",{onClick:()=>{ew(null),em()},className:"btn btn-ghost btn-sm",children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"alert alert-warning mb-6",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold",children:"Warning!"}),(0,s.jsx)("div",{className:"text-sm",children:"This action cannot be undone."})]})]}),(0,s.jsxs)("p",{className:"text-base mb-6",children:["Are you sure you want to delete"," ",(0,s.jsx)("strong",{className:"text-error",children:(null==ef?void 0:ef.name)||"this item"}),"?"]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{ew(null),em()},disabled:eb,children:"Cancel"}),(0,s.jsx)("button",{className:"btn btn-error gap-2",onClick:()=>eF(),disabled:eb,children:eb?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-sm"}),"Deleting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eu.A,{size:16}),"Confirm Delete"]})})]})]})}),(0,s.jsx)("div",{className:"fixed left-0 right-0 bottom-0 bg-base-200 text-base-content border-t border-base-300 shadow-2xl z-40",children:(0,s.jsx)("div",{className:"p-3 max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"join w-full items-center bg-base-100 rounded-box shadow-md border border-base-300",children:[O&&(0,s.jsx)("button",{onClick:eJ,className:"btn btn-ghost btn-circle btn-sm join-item ml-2","aria-label":"Cancel edit",children:(0,s.jsx)(ej.A,{size:18})}),(0,s.jsx)("label",{className:"input input-ghost flex-1 join-item border-0",children:(0,s.jsx)("input",{ref:N,type:"text",value:O?F:a,onChange:e=>O?q(e.target.value):r(e.target.value),placeholder:O?"Edit message...":"Type a question...",className:"grow",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&O&&eJ():(e.preventDefault(),O?eK():!p&&a.trim()&&eG())},disabled:p&&!O})}),(0,s.jsx)("div",{className:"join-item pr-2",children:O?F.trim()?(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:eK,className:"btn btn-primary btn-circle btn-sm","aria-label":"Save edit",children:(0,s.jsx)(eA.A,{size:18})})}):(0,s.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm",disabled:!0,children:(0,s.jsx)(eA.A,{size:18})}):!p&&a.trim()?(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:eG,className:"btn btn-primary btn-circle btn-sm","aria-label":"Send message",children:(0,s.jsx)(eA.A,{size:18})})}):(0,s.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm",disabled:!0,children:(0,s.jsx)(eA.A,{size:18})})})]})})})]})})}function eT(e){let{message:t,chatId:a,onRetry:r,onEdit:l,onDelete:i}=e,o="me"===t.sender,[c,d]=(0,n.useState)(!1);return(0,s.jsx)("div",{className:"flex ".concat(o?"justify-end":"justify-start"," mb-4 relative group px-2 bg-transparent"),children:(0,s.jsx)("div",{className:"chat ".concat(o?"chat-end":"chat-start"," w-[80vw] max-w-[80vw] bg-transparent"),children:(0,s.jsxs)("div",{className:"chat-bubble ".concat(o?"chat-bubble-primary":"bg-base-200 text-base-content"," ").concat(t.isDeleted?"opacity-60 italic":""),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onTouchStart:()=>d(!0),onTouchEnd:()=>setTimeout(()=>d(!1),3e3),children:[t.isDeleted?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("span",{className:"opacity-50",children:"\uD83D\uDDD1️"}),t.text]}):(0,s.jsx)("div",{className:"prose prose-sm prose-invert max-w-none",children:(0,s.jsx)(eh.oz,{children:t.text||""})}),(0,s.jsxs)("div",{className:"text-xs opacity-60 mt-2 flex items-center gap-1.5 ".concat(o?"justify-end":"justify-start"),children:[(0,s.jsx)("span",{children:(e=>{if(/^\d{1,2}:\d{2}$/.test(e))return e;try{let t=new Date(e);if(!isNaN(t.getTime()))return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){}return e||"00:00"})(t.time)}),o&&!t.isDeleted&&(0,s.jsxs)(s.Fragment,{children:["sending"===t.status&&(0,s.jsx)("span",{className:"loading loading-spinner loading-xs"}),"sent"===t.status&&(0,s.jsx)(eE.A,{size:12,className:"opacity-50"}),"delivered"===t.status&&(0,s.jsxs)("div",{className:"flex -space-x-1",children:[(0,s.jsx)(eE.A,{size:12,className:"text-info"}),(0,s.jsx)(eE.A,{size:12,className:"text-info"})]}),"read"===t.status&&(0,s.jsxs)("div",{className:"flex -space-x-1",children:[(0,s.jsx)(eE.A,{size:12,className:"text-success"}),(0,s.jsx)(eE.A,{size:12,className:"text-success"})]}),"failed"===t.status&&(0,s.jsx)("button",{onClick:r,className:"badge badge-error badge-xs gap-1",children:"Failed • Retry"})]}),t.isEdited&&!t.isDeleted&&(0,s.jsx)("span",{className:"badge badge-ghost badge-xs",children:"edited"})]}),o&&c&&!t.isDeleted&&(0,s.jsxs)("div",{className:"absolute -top-2 right-0 join join-horizontal shadow-lg",children:[l&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),l()},className:"btn btn-xs join-item tooltip tooltip-top","data-tip":"Edit",children:(0,s.jsx)(eP.A,{size:12})}),i&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"btn btn-xs join-item btn-error tooltip tooltip-top","data-tip":"Delete",children:(0,s.jsx)(eu.A,{size:12})})]}),!o&&!t.isDeleted&&(0,s.jsx)("div",{className:"mt-2 text-left",children:(0,s.jsx)("a",{className:"link link-primary link-hover text-xs opacity-70",href:"mailto:info@document-chat.com?subject=".concat(encodeURIComponent("Report AI generated content"),"&body=").concat(encodeURIComponent("I want to report an AI-generated message in chat ".concat(a||"",".\n\nMessage ID: ").concat(t.id,"\n\nMessage text:\n").concat(t.text,"\n\nPlease investigate."))),onClick:e=>{},children:"Report AI generated content"})})]})})})}function eR(){return(0,s.jsx)("div",{className:"flex justify-start mb-4 px-2 bg-transparent",children:(0,s.jsx)("div",{className:"chat chat-start w-[80vw] max-w-[80vw] bg-transparent",children:(0,s.jsx)("div",{className:"chat-bubble bg-base-200 text-base-content shadow-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"loading loading-dots loading-sm"}),(0,s.jsx)("span",{className:"text-xs opacity-60",children:"Assistant is typing"})]})})})})}var ez=a(3381);function e_(){var e;let t=(0,n.useRef)(null),[a,r]=(0,n.useState)(null),{modalRef:o,open:c,close:d}=ex(),{modalRef:u,open:m,close:h}=ex(),{modalRef:p,open:x,close:g}=ex();(0,n.useRef)(void 0);let[f,w]=(0,n.useState)(null),[b,v]=(0,n.useState)(!1),[y,N]=(0,n.useState)(null),[k,C]=(0,n.useState)(""),S=(0,M.jq)(),[A,E]=(0,n.useState)([]),[P,D]=(0,n.useState)([]),[I,L]=(0,n.useState)(null),[T,R]=(0,n.useState)([]),{token:z}=j(),[_,U]=(0,n.useState)({}),[O,W]=(0,n.useState)({}),[F,q]=(0,n.useState)({}),[G,V]=(0,n.useState)({}),[J,K]=(0,n.useState)([]),Y=(0,B.d)(),[X,$]=(0,n.useState)(!0),[ee,et]=(0,n.useState)(!1),[ea,es]=(0,n.useState)(!1),[en,er]=(0,n.useState)(new Set),[el,ei]=(0,n.useState)(""),eo=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var t,a;e&&(await Z.Ay.clear(),null==Y||Y.show("Storage cleared. Loading fresh data from backend.","info"));let s=null;try{let e=await ec.listProjects();if(Array.isArray(e)&&e.length>0){let t=e.map(e=>"string"==typeof e?{id:e,name:e,createdAt:new Date().toISOString()}:{id:e.id||e.name||String(e.name),name:e.name||e.id||String(e.name),createdAt:e.created_at||new Date().toISOString()});s=t,D(t)}}catch(e){console.warn("Could not load projects from backend",e)}let n=await Z.Ay.loadChats(),r=await Z.Ay.loadProjects(),l=await Z.Ay.loadDocuments(),i=s||(r&&r.length>0?r:[{id:"default",name:"default",createdAt:new Date().toISOString()}]);s||D(i);let o=i&&i.find(e=>"default"===e.id)||i&&i[0]||{id:"default",name:"default",createdAt:new Date().toISOString()};L(o);try{let e=String(null!=(t=o.name)?t:o.id),a=await ec.listDocuments(e);if(a&&a.length>0){let e=(a||[]).map(e=>ek(e,o.id));R(e)}else R(l||[])}catch(e){console.warn("listDocuments failed",e),null==Y||Y.show("Could not load documents from backend. Using cached documents. (".concat(String((null==e?void 0:e.message)||e),")"),"error"),R(l||[])}try{let e=String(null!=(a=o.name)?a:o.id),t=await ec.listChats(e);if(Array.isArray(t)){let a=(t||[]).map(e=>{var t,a;return{id:String(e.id||e.chat_id||Date.now()),name:e.name||"Chat ".concat(e.id||""),message:(null==(t=e.last_message)?void 0:t.message)||e.lastMessage||"No messages yet",time:(null==(a=e.last_message)?void 0:a.created_at)||e.time||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime}});if(0===t.length){console.log("API returned empty chats array, clearing local storage for project:",e);let t=(n||[]).filter(e=>(e.projectId||"default")!==o.id);await Z.Ay.saveChats(t),E([])}else E(a)}else console.log("API did not return array, falling back to local storage. Saved chats:",(null==n?void 0:n.length)||0),E((n||[]).map(e=>({id:e.id,name:e.name||"Chat",message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime})))}catch(e){console.warn("Could not load chats from backend",e),console.log("Falling back to local storage due to API error. Saved chats:",(null==n?void 0:n.length)||0),E((n||[]).map(e=>({id:e.id,name:e.name||"Chat",message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime})))}}catch(e){console.error("Error loading data:",e),null==Y||Y.show("Error loading data from backend","error")}},ed=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];et(!0);try{await eo(e),null==Y||Y.show("Data refreshed successfully","success")}catch(e){console.error("Refresh failed:",e),null==Y||Y.show("Failed to refresh data","error")}finally{et(!1)}};(0,n.useEffect)(()=>{!async function(){$(!0),await eo(),$(!1)}()},[]),(0,n.useEffect)(()=>{if(!I)return;let e=!0;return(async()=>{try{var t,a;let s=await ec.listDocuments(String(null!=(t=null==I?void 0:I.name)?t:null==I?void 0:I.id));if(e&&Array.isArray(s)&&s.length>0){let e=(s||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:I.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));R(e.concat(T.filter(e=>e.projectId!==I.id)))}let n=await ec.listChats(String(null!=(a=null==I?void 0:I.name)?a:null==I?void 0:I.id));if(e&&Array.isArray(n)){let e=(n||[]).map(e=>{var t,a;return{id:String(e.id||e.chat_id||Date.now()),name:e.name||"Chat ".concat(e.id||""),message:(null==(t=e.last_message)?void 0:t.message)||e.lastMessage||"No messages yet",time:(null==(a=e.last_message)?void 0:a.created_at)||e.time||"Just now"}});if(0===n.length){console.log("API returned empty chats array in useEffect, clearing local storage for project:",I.id);let e=(await Z.Ay.loadChats()||[]).filter(e=>(e.projectId||"default")!==I.id);await Z.Ay.saveChats(e),E([])}else E(e)}}catch(e){console.warn("Error refreshing project data",e)}})(),()=>{e=!1}},[I]),(0,n.useEffect)(()=>{if(!z)return void ec.clearTokenProvider();try{ec.setTokenProvider(async()=>(0,H.p9)())}catch(e){console.warn("Failed to set token provider",e)}return()=>{try{ec.clearTokenProvider()}catch(e){}}},[z]),(0,n.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"r"===e.key&&(e.preventDefault(),ed(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,n.useEffect)(()=>{X||(Z.Ay.saveProjects(P).catch(e=>console.error("Error saving projects:",e)),Z.Ay.saveDocuments(T).catch(e=>console.error("Error saving documents:",e)))},[P,T,X]),(0,n.useEffect)(()=>{!X&&A.length>0&&Z.Ay.saveChats(A).catch(e=>{console.error("Error saving chats:",e)})},[A,X]);let eu=k?A.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())):A;(0,n.useEffect)(()=>{r(t.current)},[]),(0,n.useEffect)(()=>{let e=e=>{try{var t;let a=e.detail;if(!a)return;a.projectId===(null!=(t=null==I?void 0:I.id)?t:"default")&&R(a.documents||[])}catch(e){console.warn("documents-updated handler error",e)}};return window.addEventListener("documents-updated",e),()=>window.removeEventListener("documents-updated",e)},[I]),(0,n.useEffect)(()=>{let e=async e=>{try{if(!e.detail)return;console.log("Chat deleted event received, refreshing data..."),await ed(!1)}catch(e){console.warn("chat-deleted handler error",e)}};return window.addEventListener("chat-deleted",e),()=>window.removeEventListener("chat-deleted",e)},[ed]),(0,n.useEffect)(()=>{let e=async()=>{document.hidden||(console.log("Page became visible, refreshing data..."),await ed(!1))};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[ed]),(0,n.useEffect)(()=>{let e=async()=>{console.log("Window focused, refreshing data..."),await ed(!1)};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[ed]),(0,n.useEffect)(()=>{if(0===J.length)return;let e=[...J],t=setTimeout(()=>{K(t=>t.filter(t=>!e.includes(t))),null==Y||Y.show("".concat(e.length," file(s) uploaded"),"success")},2e3);return()=>clearTimeout(t)},[J]);let em=async()=>{if(f){v(!0);try{var e,t,a,s;if("chats"===f.type){let t=f.id?[f.id]:Array.from(en);try{for(let a of t)await ec.deleteChat(String(null!=(e=I.name)?e:I.id),a)}catch(e){console.error("Error deleting chats on server:",e),null==Y||Y.show("Could not delete chats. Please try again.","error");return}try{await Z.Ay.clear(),await eo(),er(new Set),es(!1),null==Y||Y.show("Chats deleted and storage cleared","success")}catch(e){console.error("Error clearing storage:",e);try{let e=new Set(t),a=A.filter(t=>!e.has(t.id));E(a),er(new Set),es(!1);let s=t.map(e=>Z.Ay.deleteChatMessages(e));await Promise.all(s),await Z.Ay.saveChats(a),null==Y||Y.show("Chats deleted","success")}catch(e){console.error("Error cleaning up local chat storage:",e),null==Y||Y.show("Chats deleted on server but local cleanup failed","info")}}}else if("project"===f.type){if(!f.id)return;try{let e=P.find(e=>e.id===f.id),a=String(null!=(t=null==e?void 0:e.name)?t:f.id);await ec.deleteProjectApi(a)}catch(e){console.error("Error deleting project on server:",e),null==Y||Y.show("Could not delete project. Please try again.","error");return}try{await Z.Ay.clear(),await eo(),null==Y||Y.show("Project deleted and storage cleared","success")}catch(e){console.error("Error clearing storage:",e),eb(f.id),null==Y||Y.show("Project deleted","success")}}else if("document"===f.type){let e;if(f.extra&&"object"==typeof f.extra&&(e=f.extra),!e)return;if(!I){null==Y||Y.show("No project selected","error");return}try{await ec.deleteDocument(String(null!=(a=I.name)?a:I.id),e.id);try{await Z.Ay.clear(),await eo(),null==Y||Y.show("Document deleted and storage cleared","success")}catch(t){console.error("Error clearing storage:",t),R(t=>t.filter(t=>t.id!==e.id)),null==Y||Y.show("Document deleted","success");try{let e=(await ec.listDocuments(String(null!=(s=null==I?void 0:I.name)?s:null==I?void 0:I.id))||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:I.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));R(e.concat(T.filter(e=>e.projectId!==I.id)))}catch(e){}}try{h()}catch(e){}N(null)}catch(e){console.error("Delete document failed",e),null==Y||Y.show("Could not delete document. Please try again.","error")}}}finally{v(!1),w(null),g()}}},ef=async()=>{d();let e="1";if(A.length>0){let t=Math.max(...A.map(e=>{let t=parseInt(e.id);return isNaN(t)?0:t}));e=(isFinite(t)?t+1:1).toString()}let t={id:e,name:"New Chat ".concat(e),message:"Hey there!",time:"Just now",isRead:!0,lastMessage:"Hey there!",lastMessageTime:"Just now"},a={id:t.id,name:t.name,message:t.message,time:t.time,isRead:t.isRead,lastMessage:t.lastMessage,lastMessageTime:t.lastMessageTime,projectId:(null==I?void 0:I.id)||"default"};E([t,...A]);try{let c=await Z.Ay.loadChats()||[];await Z.Ay.saveChats([a,...c]);let d={id:"1",text:"Hey there! This is a new conversation, but I know everything about the documents you uploaded in this project space, so shoot me some questions :)!",sender:"other",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"delivered"};await Z.Ay.saveChatMessages(e,[d]);try{var s,n,r,l,i,o;let a=String(null!=(n=null==I?void 0:I.name)?n:null==I?void 0:I.id),c="".concat(t.name||"new chat"," ").concat(new Date().toISOString()),d=await ec.createChatByName(a,c),u=String(null!=(o=null!=(i=null!=(l=null!=(r=null==d?void 0:d.id)?r:null==d?void 0:d.chat_id)?l:null==d||null==(s=d.chat)?void 0:s.id)?i:null==d?void 0:d.chatId)?o:"");if(u){E(t=>t.map(t=>t.id===e?{...t,id:u}:t));try{let t=await Z.Ay.loadChatMessages(e)||[];t.length>0&&(await Z.Ay.saveChatMessages(u,t),await Z.Ay.deleteChatMessages(e));let a=(await Z.Ay.loadChats()||[]).map(t=>String(t.id)===String(e)?{...t,id:u}:t);await Z.Ay.saveChats(a)}catch(e){console.warn("Failed to migrate local chat messages to server id",e)}try{S.push("/app/chats/".concat(u),"forward")}catch(e){console.warn("Navigation to new chat failed",e)}}else S.push("/app/chats/".concat(e),"forward")}catch(t){console.warn("createChat API failed, falling back to local chat:",t);try{S.push("/app/chats/".concat(e),"forward")}catch(e){console.warn("Navigation to new chat failed",e)}}}catch(e){console.error("Error creating new chat:",e)}},ew=async e=>{try{let t=await ec.createProject(e),a=String((null==t?void 0:t.id)||(null==t?void 0:t.name)||Date.now()),s=(null==t?void 0:t.created_at)||(null==t?void 0:t.createdAt)||new Date().toISOString(),n={id:a,name:(null==t?void 0:t.name)||e,createdAt:s};return D(e=>[n,...e]),L(n),null==Y||Y.show("Project created successfully","success"),n}catch(a){console.warn("createProject backend failed, falling back to local",a);let t={id:Date.now().toString(),name:e,createdAt:new Date().toISOString()};return D(e=>[t,...e]),L(t),null==Y||Y.show("Project created locally (offline)","info"),t}},eb=async e=>{"default"!==e&&D(t=>{let a=t.filter(t=>t.id!==e);return L(a[0]||{id:"default",name:"default",createdAt:new Date().toISOString()}),a})},ey=async e=>{if(!e||0===e.length||!I)return;let t=Array.from(e);for(let e of(V(e=>{let a={...e};for(let e of t)a[e.name]=e;return a}),t))ej(e).catch(e=>console.error("startUpload failed",e))},ej=async e=>{if(!I)return;let t=e.name;try{var a,s;let n=await (0,H.p9)();if(!n){null==Y||Y.show("Session expired. Please sign in again.","error");return}U(e=>({...e,[t]:0})),q(e=>({...e,[t]:!1})),await ec.uploadDocuments(String(null!=(a=null==I?void 0:I.name)?a:null==I?void 0:I.id),[e],!1,n);let r=(await ec.listDocuments(String(null!=(s=null==I?void 0:I.name)?s:null==I?void 0:I.id))||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:I.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));R(r.concat(T.filter(e=>e.projectId!==I.id))),K(e=>[...e,t]),V(e=>{let a={...e};return delete a[t],a})}catch(a){console.error("Upload error:",a),q(e=>({...e,[t]:!0}));let e=String((null==a?void 0:a.message)||a);e.includes("413")||e.toLowerCase().includes("content too large")?null==Y||Y.show("Upload failed: file too large (server rejected with 413)","error"):e.includes("Failed to fetch")||e.toLowerCase().includes("network")?null==Y||Y.show("Upload failed: network or CORS error. Check server CORS settings and try again.","error"):null==Y||Y.show("Upload failed: ".concat(e),"error")}finally{U(e=>{let a={...e};return delete a[t],a}),W(e=>{let a={...e};return delete a[t],a})}};return(0,s.jsxs)(Q,{pageRef:t,toolbarClassName:"bg-base-100",header:(0,s.jsxs)("div",{className:"w-full flex justify-between items-center px-4",children:[(0,s.jsx)(M.BC,{size:"large",className:"flex-1",children:(0,s.jsx)("div",{className:"w-full flex justify-center items-center",children:(0,s.jsx)("img",{src:"/logo.png",alt:"Logo",className:"h-12 sm:h-14 md:h-16 w-auto",style:{display:"block"}})})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(M.Jm,{fill:"clear",size:"small",onClick:()=>ed(!1),disabled:ee,className:"btn btn-ghost btn-sm",children:(0,s.jsx)(ez.A,{className:"h-4 w-4 ".concat(ee?"animate-spin":"")})}),(0,s.jsx)(M.Jm,{fill:"clear",size:"small",onClick:()=>ed(!0),disabled:ee,className:"btn btn-ghost btn-sm text-warning",title:"Clear storage and refresh",children:(0,s.jsx)(ez.A,{className:"h-4 w-4 ".concat(ee?"animate-spin":"")})})]})]}),children:[(0,s.jsx)(M.To,{slot:"fixed",onIonRefresh:async e=>{await ed(!1),e.detail.complete()},children:(0,s.jsx)(M.Ki,{pullingText:"Pull to refresh...",refreshingText:"Refreshing..."})}),(0,s.jsxs)("div",{className:"flex flex-col pb-36 gap-6 pt-4 px-4 max-w-6xl mx-auto w-full",children:[(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/5 to-secondary/5 border border-primary/10",children:(0,s.jsxs)("div",{className:"card-body p-4",children:[(0,s.jsx)("div",{className:"flex items-start gap-3 mb-3",children:(0,s.jsxs)("div",{className:"badge badge-primary gap-1",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Quicksearch"]})}),(0,s.jsx)("p",{className:"text-sm text-base-content/80 mb-3",children:"Search all documents in this project instantly. Perfect for finding keywords or specific snippets."}),(0,s.jsx)("form",{onSubmit:async e=>{e.preventDefault(),k.trim()&&I&&S.push("/app/quicksearch?projectName=".concat(encodeURIComponent(I.name),"&query=").concat(encodeURIComponent(k)),"forward")},children:(0,s.jsx)(ev,{value:k,onChange:C,placeholder:"Search documents..."})})]})}),X?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"card bg-base-200 shadow-lg",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsx)("div",{className:"skeleton h-6 w-40 mb-4"}),(0,s.jsx)("div",{className:"skeleton h-12 w-full mb-3"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("div",{className:"skeleton h-10 w-full"}),(0,s.jsx)("div",{className:"skeleton h-10 w-full"})]})]})}),(0,s.jsx)("div",{className:"card bg-base-200 shadow-lg",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsx)("div",{className:"skeleton h-6 w-32 mb-4"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)("div",{className:"skeleton h-10 w-36"}),(0,s.jsx)("div",{className:"skeleton h-8 w-20"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:6}).map((e,t)=>(0,s.jsxs)("div",{className:"card bg-base-300 shadow",children:[(0,s.jsx)("div",{className:"skeleton h-40 w-full"}),(0,s.jsxs)("div",{className:"card-body p-3",children:[(0,s.jsx)("div",{className:"skeleton h-4 w-full mb-2"}),(0,s.jsx)("div",{className:"skeleton h-3 w-3/4"})]})]},t))})]})}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-base-content/60",children:"Loading chats..."})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"card bg-base-100 shadow-lg border border-base-300",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsxs)("h2",{className:"card-title text-base text-base-content mb-4 flex items-center gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Current Project"]}),(0,s.jsx)("select",{value:null!=(e=null==I?void 0:I.id)?e:"",onChange:e=>{let t=P.find(t=>t.id===e.target.value);L(t||null),Z.Ay.loadChats().then(e=>{E((e||[]).filter(e=>(e.projectId||"default")===((null==t?void 0:t.id)||"default")).map(e=>({...e,message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now"})))})},className:"select select-bordered select-lg w-full mb-4 font-medium",children:0===P.length?(0,s.jsx)("option",{value:"",children:"No projects available"}):P.map(e=>(0,s.jsxs)("option",{value:e.id,children:["\uD83D\uDCC1 ",e.name]},e.id))}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>{c()},children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Project"]}),(0,s.jsxs)("button",{className:"btn btn-outline btn-error gap-2",onClick:()=>{I&&(w({type:"project",id:I.id,name:I.name}),x())},disabled:!I||"default"===I.id,children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]})}),(0,s.jsx)("div",{className:"card bg-base-100 shadow-lg border border-base-300",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"card-title text-base text-base-content flex items-center gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Documents"]}),(0,s.jsxs)("div",{className:"badge badge-primary badge-lg gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),T.filter(e=>e.projectId===(null==I?void 0:I.id)).length," ","files"]})]}),(0,s.jsxs)("label",{className:"btn btn-primary btn-lg w-full gap-2 mb-4",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload Files",(0,s.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>ey(e.target.files)})]}),Object.keys({..._,...F}).filter(e=>void 0!==_[e]||F[e]).length>0&&(0,s.jsx)("div",{className:"divider text-xs opacity-60",children:"Active Uploads"}),(0,s.jsx)("div",{className:"flex flex-col gap-2 mb-4",children:Object.keys({..._,...F}).filter(e=>void 0!==_[e]||F[e]).map(e=>{var t;let a=G[e],n=a?a.size:void 0,r=n?n<1024?"".concat(n," B"):n<1048576?"".concat((n/1024).toFixed(1)," KB"):"".concat((n/1048576).toFixed(1)," MB"):void 0;return(0,s.jsx)(eN,{name:e,subtitle:r,progress:null!=(t=_[e])?t:(F[e],0),failed:!!F[e],onCancel:()=>{let t=O[e];t&&t.abort&&t.abort(),q(t=>({...t,[e]:!0}))},onRetry:()=>{let t=G[e];t&&ej(t)}},e)})}),0===T.filter(e=>e.projectId===(null==I?void 0:I.id)).length?(0,s.jsxs)("div",{className:"alert alert-info",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("span",{children:"No documents yet. Upload files to get started!"})]}):(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:(0,s.jsx)(i.N,{children:T.filter(e=>e.projectId===(null==I?void 0:I.id)).map(e=>(0,s.jsx)(l.P.div,{layout:!0,initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96,transition:{duration:.18}},whileHover:{scale:1.02},whileTap:{scale:.99},transition:{type:"spring",stiffness:300,damping:24},className:"",children:(0,s.jsxs)("div",{className:"card card-compact bg-base-100 shadow-md hover:shadow-xl border border-base-300 transition-all cursor-pointer group overflow-hidden",onClick:()=>{N(e),m()},children:[(0,s.jsxs)("figure",{className:"relative h-36 bg-base-300 overflow-hidden",children:[e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl?(0,s.jsx)("img",{src:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-base-200 to-base-300",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,s.jsxs)("div",{className:"absolute top-2 right-2 badge badge-primary badge-sm gap-1",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]}),(0,s.jsxs)("div",{className:"card-body p-3",children:[(0,s.jsx)("h3",{className:"card-title text-sm truncate",title:e.filename||e.name,children:e.filename||e.name}),(0,s.jsx)("div",{className:"text-xs text-base-content/70 line-clamp-2",children:(0,s.jsx)(eh.oz,{children:String(e.content||e.summary||e.excerpt||"No preview available")})})]})]})},e.id))})})]})}),(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 to-secondary/10 border-2 border-dashed border-primary/30 hover:border-primary/50 transition-colors",children:(0,s.jsxs)("div",{className:"card-body p-6 items-center text-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-primary mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,s.jsx)("h3",{className:"card-title text-lg mb-2",children:"Start a New Conversation"}),(0,s.jsx)("p",{className:"text-sm text-base-content/60 mb-4",children:"Chat with AI about your documents"}),(0,s.jsxs)("button",{className:"btn btn-primary btn-lg gap-2",onClick:()=>ef(),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Chat"]})]})}),(0,s.jsx)(eU,{chats:eu,onChatClick:e=>{if(ea)return void er(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a});E(t=>t.map(t=>t.id===e?{...t,isRead:!0,unreadCount:0}:t)),S.push("/app/chats/".concat(e),"forward")},isEditing:ea,selectedChats:en,onDelete:(e,t)=>{w({type:"chats",id:e,name:t||""}),x()}})]}),a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ep,{title:"Create New Project",modalRef:o,presentingElement:a,left:(0,s.jsx)(M.Jm,{fill:"clear",onClick:()=>{ei(""),d()},children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"label",children:[(0,s.jsx)("span",{className:"label-text font-medium",children:"Project Name"}),(0,s.jsx)("span",{className:"label-text-alt text-base-content/50",children:"Required"})]}),(0,s.jsx)("input",{value:el,onChange:e=>ei(e.target.value),placeholder:"My Awesome Project",className:"input input-bordered input-lg w-full",onKeyDown:e=>{"Enter"===e.key&&el.trim()&&(ew(el.trim()),ei(""),d())},autoFocus:!0}),(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text-alt text-base-content/60",children:"Choose a descriptive name for your project"})})]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{ei(""),d()},children:"Cancel"}),(0,s.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>{ew(el.trim()||"New Project"),ei(""),d()},disabled:!el.trim(),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Create Project"]})]})]})}),(0,s.jsx)(eg,{doc:y,presentingElement:a,onClose:()=>{try{h()}catch(e){}N(null)},onDelete:e=>{w({type:"document",extra:e}),x()}}),(0,s.jsx)(ep,{title:"Confirm Delete",modalRef:p,presentingElement:a,left:(0,s.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{w(null),g()},children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"alert alert-warning mb-6",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold",children:"Warning!"}),(0,s.jsx)("div",{className:"text-sm",children:"This action cannot be undone."})]})]}),(0,s.jsxs)("p",{className:"text-base mb-6",children:["Are you sure you want to delete"," ",(0,s.jsx)("strong",{className:"text-error",children:(null==f?void 0:f.name)||"this item"}),"?"]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{w(null),g()},disabled:b,children:"Cancel"}),(0,s.jsx)("button",{className:"btn btn-error gap-2",onClick:()=>em(),disabled:b,children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-sm"}),"Deleting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Confirm Delete"]})})]})]})})]})]})]})}function eU(e){let{chats:t,onChatClick:a,isEditing:n,selectedChats:r,onDelete:l}=e;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"divider text-sm font-semibold text-base-content/90",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Your Conversations"]}),0===t.length?(0,s.jsx)("div",{className:"card bg-base-100 border-2 border-dashed border-base-300",children:(0,s.jsxs)("div",{className:"card-body items-center text-center py-12",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/30 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No conversations yet"}),(0,s.jsx)("p",{className:"text-sm text-base-content/60",children:"Start a new conversation to chat with AI about your documents"})]})}):(0,s.jsx)("div",{className:"flex flex-col gap-3",children:t.map((e,t)=>(0,s.jsx)(em,{chat:e,onClick:()=>a(e.id),isEditing:n,isSelected:r.has(e.id),onDelete:l},e.id))})]})}function eB(){let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!0),o=(0,M.jq)(),c=(0,R.zy)(),{token:d}=j(),[u,m]=(0,n.useState)(null),h=new URLSearchParams(c.search),p=h.get("projectName")||"",x=h.get("query")||"";return(0,n.useEffect)(()=>{async function e(){r(!0);try{let e=await ec.quicksearchDocuments(p,x);t(e||[])}catch(e){t([])}finally{r(!1)}}p&&x&&e()},[p,x]),(0,s.jsx)(Q,{children:(0,s.jsxs)("div",{className:"py-6 px-4 max-w-6xl mx-auto w-full",children:[(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 to-secondary/10 border border-primary/20 mb-6",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-base-content",children:"Search Results"}),(0,s.jsxs)("p",{className:"text-sm text-base-content/60",children:["Searching for:"," ",(0,s.jsxs)("span",{className:"font-semibold text-primary",children:['"',x,'"']})]})]})]}),!a&&e.length>0&&(0,s.jsxs)("div",{className:"badge badge-primary badge-lg gap-2 mt-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.length," ",1===e.length?"result":"results"," ","found"]})]})}),a?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-base-content/60",children:"Searching documents..."}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 w-full mt-8",children:Array.from({length:6}).map((e,t)=>(0,s.jsxs)("div",{className:"card bg-base-200 shadow",children:[(0,s.jsx)("div",{className:"skeleton h-48 w-full"}),(0,s.jsxs)("div",{className:"card-body p-3",children:[(0,s.jsx)("div",{className:"skeleton h-4 w-full mb-2"}),(0,s.jsx)("div",{className:"skeleton h-3 w-3/4"})]})]},t))})]}):0===e.length?(0,s.jsx)("div",{className:"card bg-base-200 border-2 border-dashed border-base-300",children:(0,s.jsxs)("div",{className:"card-body items-center text-center py-20",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-20 w-20 text-base-content/30 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No Results Found"}),(0,s.jsxs)("p",{className:"text-base-content/60 mb-6 max-w-md",children:["We couldn't find any documents matching \"",x,'". Try different keywords or upload more documents.']}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>o.push("/app/chats","back"),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Chats"]}),(0,s.jsx)("button",{className:"btn btn-outline gap-2",onClick:()=>o.push("/app/chats","back"),children:"Upload Documents"})]})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8",children:(0,s.jsx)(i.N,{children:e.map((e,t)=>(0,s.jsx)(l.P.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.96},whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},transition:{type:"spring",stiffness:300,damping:24},children:(0,s.jsxs)("div",{className:"card card-compact bg-base-100 shadow-md hover:shadow-xl border border-base-300 transition-all cursor-pointer group h-full",onClick:()=>m(function(e,t){let a=ek(e,p||"default");if(!a||"object"!=typeof a)return{id:"result-".concat(t),projectId:p||"default",name:"Result ".concat(t+1),mimeType:void 0,url:void 0,previewUrl:void 0,size:void 0,uploadedAt:"",content:"",fullcontent:"",score:void 0};let s=String(e.content||e.fullcontent||a.content||""),n=String(e.fullcontent||e.content||a.fullcontent||""),r="number"==typeof e.score?e.score:a.score;return{...a,content:s,fullcontent:n,score:r}}(e,t)),children:[(0,s.jsxs)("figure",{className:"relative h-40 bg-gradient-to-br from-base-200 to-base-300 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/20 group-hover:scale-110 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,s.jsxs)("div",{className:"absolute top-2 left-2 right-2 flex justify-between items-start gap-2",children:[void 0!==e.score&&(0,s.jsxs)("div",{className:"badge badge-success gap-1",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(100*e.score).toFixed(0),"%"]}),(0,s.jsxs)("div",{className:"badge badge-primary badge-sm gap-1 ml-auto",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]})]}),(0,s.jsxs)("div",{className:"card-body p-4",children:[(0,s.jsx)("h3",{className:"card-title text-sm font-semibold truncate",title:e.filename||e.name||"Result ".concat(t+1),children:e.filename||e.name||"Result ".concat(t+1)}),(0,s.jsx)("div",{className:"text-xs text-base-content/70 line-clamp-3 min-h-[3rem]",children:(0,s.jsx)(eh.oz,{children:String(e.content||e.fullcontent||"No preview available")})}),e.timestamp&&(0,s.jsxs)("div",{className:"flex items-center gap-1 mt-2 text-xs text-base-content/50",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.timestamp]})]})]})},e&&(e.id||"".concat(e.filename,"-").concat(t))||t))})}),(0,s.jsxs)("div",{className:"divider text-sm text-base-content/50",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"End of Results"]})]}),(0,s.jsx)("div",{className:"flex justify-center mt-8",children:(0,s.jsxs)("button",{className:"btn btn-lg btn-primary gap-2",onClick:()=>o.goBack(),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Chats"]})}),(0,s.jsx)(eg,{doc:u,onClose:()=>m(null),presentingElement:null})]})})}var eO=a(9211),eW=a(8974),eF=a(576),eH=a(5225),eq=a(9201),eG=a(8155),eV=a(912),eJ=a(8428),eK=a(7314);function eY(){let e=(0,n.useRef)(null),t=(0,M.jq)(),{user:l,signOut:i}=j(),[o,c]=(0,n.useState)({theme:"dark",notifications:!1}),[d,u]=(0,n.useState)(""),[m,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{!async function(){try{h(!0);let e=await Z.Ay.loadSettings();if(e){let t={...o,...e,theme:"dark"};c(t);try{"undefined"!=typeof document&&document.documentElement.setAttribute("data-theme","dark")}catch(e){console.warn("Unable to apply saved theme",e)}}else{await Z.Ay.saveSettings(o);try{"undefined"!=typeof document&&document.documentElement.setAttribute("data-theme","dark")}catch(e){console.warn("Unable to apply default theme",e)}}}catch(e){console.error("Error loading user data:",e)}finally{h(!1)}}()},[]),(0,n.useEffect)(()=>{m||Z.Ay.saveSettings(o).catch(e=>{console.error("Error saving settings:",e)})},[o,m]),(0,n.useEffect)(()=>{var e;u(null!=(e=null==l?void 0:l.email)?e:"")},[l]);let p=[{icon:(0,s.jsx)(eF.A,{size:22,className:"text-accent"}),label:"Notifications",withArrow:!1,onClick:()=>{c(e=>({...e,notifications:!e.notifications}))},suffix:(0,s.jsx)(eX,{enabled:o.notifications})},{icon:(0,s.jsx)(eH.A,{size:22,className:"text-info"}),label:"Terms of Use",onClick:()=>{(async()=>{let e="https://document-chat.com/terms-conditions/";if(r.Capacitor.isNativePlatform())try{let{Browser:t}=await a.e(63).then(a.bind(a,7063));await t.open({url:e})}catch(t){window.open(e,"_blank")}else window.open(e,"_blank")})()}},{icon:(0,s.jsx)(eq.A,{size:22,className:"text-success"}),label:"Privacy Policy",onClick:()=>{(async()=>{let e="https://document-chat.com/privacy-policy/";if(r.Capacitor.isNativePlatform())try{let{Browser:t}=await a.e(63).then(a.bind(a,7063));await t.open({url:e})}catch(t){window.open(e,"_blank")}else window.open(e,"_blank")})()}},{icon:(0,s.jsx)(eG.A,{size:22,className:"text-warning"}),label:"Help & Support",onClick:()=>{(async()=>{let e="mailto:info@document-chat.com";if(r.Capacitor.isNativePlatform())try{await eO.a.openUrl({url:e})}catch(t){window.location.href=e}else window.location.href=e})()}},{icon:(0,s.jsx)(eV.A,{size:22,className:"text-secondary"}),label:"Share App",onClick:async()=>{await eW.S.share({title:"Document Chat",text:"I'm using Document Chat to chat with my PDFs and documents. Give it a try!",url:"https://document-chat.com/",dialogTitle:"Share Document Chat"})}},{icon:(0,s.jsx)(eJ.A,{size:22,className:"text-error"}),label:"Logout",onClick:async()=>{try{await (null==i?void 0:i())}catch(e){console.error("Error signing out",e)}try{t.push("/app","root","replace")}catch(e){try{window.location.href="/app"}catch(e){console.error("Failed to navigate after sign-out",e)}}}}];return(0,s.jsxs)(Q,{pageRef:e,toolbarClassName:"bg-base-100",header:(0,s.jsx)(M.BC,{children:"Settings"}),children:[(0,s.jsx)(M.eU,{collapse:"condense",children:(0,s.jsx)(M.ai,{children:(0,s.jsx)(M.BC,{size:"large",children:"Settings"})})}),(0,s.jsx)("div",{className:"min-h-screen w-full flex flex-col items-center bg-gradient-to-b from-base-200 to-base-100 pb-8",children:(0,s.jsxs)("div",{className:"w-full max-w-md flex flex-col gap-6 p-6",children:[(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 via-base-100 to-secondary/10 shadow-lg border border-base-300",children:(0,s.jsxs)("div",{className:"card-body items-center py-8",children:[(0,s.jsx)("div",{className:"avatar mb-3",children:(0,s.jsx)("div",{className:"w-20 rounded-full bg-gradient-to-br from-primary to-secondary p-1 shadow-lg ring-4 ring-base-100",children:(0,s.jsx)("div",{className:"w-full h-full rounded-full bg-base-100 flex items-center justify-center",children:(0,s.jsx)(eK.A,{size:36,className:"text-primary"})})})}),(0,s.jsx)("h2",{className:"card-title text-xl font-bold mb-1",children:"Your Account"}),(0,s.jsxs)("div",{className:"badge badge-lg badge-primary badge-outline gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),d||"Not logged in"]})]})}),(0,s.jsx)("div",{className:"card bg-base-100 shadow-xl border border-base-300",children:(0,s.jsx)("div",{className:"card-body p-0",children:m?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4 py-12",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-sm text-base-content/70",children:"Loading settings..."})]}):(0,s.jsx)("ul",{className:"menu menu-lg w-full",children:p.map((e,t)=>(0,s.jsx)("li",{className:"border-b last:border-b-0 border-base-200/50",children:(0,s.jsx)(ew,{item:e,className:"flex items-center gap-4 px-4 py-4 hover:bg-base-200/50 active:bg-base-300/50 transition-colors"})},t))})})}),(0,s.jsxs)("div",{className:"text-center mt-4",children:[(0,s.jsx)("p",{className:"text-xs text-base-content/50",children:"Document Chat v1.0.0"}),(0,s.jsx)("p",{className:"text-xs text-base-content/40 mt-1",children:"Made with ❤️ for productivity"})]})]})})]})}function eX(e){let{enabled:t}=e;return(0,s.jsx)("input",{type:"checkbox",className:"toggle toggle-primary",checked:t,readOnly:!0})}function eQ(){let e=(0,R.zy)(),[t,a]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{a(!e.pathname.includes("/app/chats/"))},[e]),(0,s.jsxs)(M.p4,{children:[(0,s.jsxs)(M.Rg,{children:[(0,s.jsx)(R.qh,{exact:!0,path:"/app/chats",component:e_}),(0,s.jsx)(R.qh,{exact:!0,path:"/app/quicksearch",render:e=>{let{location:t}=e;return(0,s.jsx)(eB,{})}}),(0,s.jsx)(R.qh,{path:"/app/chats/:chatId",render:e=>{let{match:t}=e;return(0,s.jsx)(eM,{chatId:t.params.chatId})}}),(0,s.jsx)(R.qh,{exact:!0,path:"/app/settings",render:()=>(0,s.jsx)(eY,{})}),(0,s.jsx)(R.qh,{exact:!0,path:"/app",children:(0,s.jsx)(R.rd,{to:"/app/chats"})})]}),t&&(0,s.jsxs)(M.Jq,{slot:"bottom",className:"bg-base-100 text-base-content",children:[(0,s.jsx)(M.qW,{tab:"/app/chats",href:"/app/chats",className:"bg-base-100 text-base-content",children:(0,s.jsx)(Y.A,{size:22})}),(0,s.jsx)(M.qW,{tab:"/app/settings",href:"/app/settings",className:"bg-base-100 text-base-content",children:(0,s.jsx)(X.A,{size:22})})]})]})}(0,M.Z3)({mode:"ios"});let eZ=()=>{(0,n.useEffect)(()=>{var e,t;(null==(t=window.Capacitor)||null==(e=t.isNativePlatform)?void 0:e.call(t))&&Promise.resolve().then(a.bind(a,3589)).then(e=>{let{SplashScreen:t}=e;t.hide().catch(()=>{})})},[]);let{showSplash:e}=(()=>{let[e,t]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=!0;return(async()=>{try{await v.SplashScreen.hide()}catch(e){}let a=setTimeout(()=>{e&&t(!1)},2e3);return()=>clearTimeout(a)})(),()=>{e=!1}},[]),{showSplash:e}})(),{user:t,isLoading:r}=j(),[l,i]=(0,n.useState)("");return(0,n.useEffect)(()=>{(async()=>{try{let e=await L.p.getId();i(e.identifier),console.debug("[DeviceId] Got device ID:",e.identifier)}catch(e){console.error("[DeviceId] Error getting device ID:",e)}})()},[]),(0,s.jsxs)(M.U1,{children:[e&&(0,s.jsx)(U,{}),(0,s.jsx)(I,{userId:l,children:(0,s.jsx)(b,{children:(0,s.jsx)(T.l8,{children:(0,s.jsxs)(M.Rg,{id:"main",children:[(0,s.jsx)(R.qh,{path:"/app",render:()=>t?(0,s.jsx)(B.default,{children:(0,s.jsx)(eQ,{})}):r&&1?null:(0,s.jsx)(J,{})}),(0,s.jsx)(R.qh,{exact:!0,path:"/",children:(0,s.jsx)(R.rd,{to:"/app"})})]})})})})]})}},8078:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=8078,e.exports=t}}]);