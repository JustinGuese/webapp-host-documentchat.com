(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[633],{838:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>o});var s=a(4077);let n={CHATS:"messenger_chats",CONTACTS:"messenger_contacts",USER_PROFILE:"messenger_user_profile",SETTINGS:"messenger_settings",PROJECTS:"messenger_projects",DOCUMENTS:"messenger_documents"};class r{async save(e,t){try{await s.p.set({key:e,value:JSON.stringify(t)})}catch(t){throw console.error("Error saving data for key ".concat(e,":"),t),t}}async load(e){try{let{value:t}=await s.p.get({key:e});if(!t)return null;return JSON.parse(t)}catch(t){return console.error("Error loading data for key ".concat(e,":"),t),null}}async remove(e){try{await s.p.remove({key:e})}catch(t){throw console.error("Error removing data for key ".concat(e,":"),t),t}}async clear(){try{await s.p.clear()}catch(e){throw console.error("Error clearing all data:",e),e}}async saveChats(e){return this.save(n.CHATS,e)}async loadChats(){return await this.load(n.CHATS)||[]}async saveContacts(e){return this.save(n.CONTACTS,e)}async loadContacts(){return await this.load(n.CONTACTS)||[]}async saveUserProfile(e){return this.save(n.USER_PROFILE,e)}async loadUserProfile(){return this.load(n.USER_PROFILE)}async saveSettings(e){return this.save(n.SETTINGS,e)}async loadSettings(){return await this.load(n.SETTINGS)||{theme:"dark",notifications:!0}}async saveChatMessages(e,t){return this.save("".concat(n.CHATS,"_").concat(e,"_messages"),t)}async loadChatMessages(e){return await this.load("".concat(n.CHATS,"_").concat(e,"_messages"))||[]}async loadChatMessagesPaginated(e,t,a){let s=await this.loadChatMessages(e),n=Math.max(0,s.length-t*a),r=Math.min(s.length,n+a);return s.slice(n,r)}async getMessageCount(e){return(await this.loadChatMessages(e)).length}async deleteChatMessages(e){return this.remove("".concat(n.CHATS,"_").concat(e,"_messages"))}async saveProjects(e){return this.save(n.PROJECTS,e)}async loadProjects(){return await this.load(n.PROJECTS)||[]}async saveDocuments(e){return this.save(n.DOCUMENTS,e)}async loadDocuments(){return await this.load(n.DOCUMENTS)||[]}}class i{static async createStorage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"preferences";switch(e){case"preferences":default:return new r;case"sqlite":case"mongodb":return console.log("MongoDB adapter requested but not implemented - using Preferences instead"),new r}}static createStorageSync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"preferences";return"preferences"===e||console.log("".concat(e," adapter requested but sync creation only supports preferences - using Preferences instead")),new r}}let l=null;(async()=>{if(!l){l=new r;try{l=await i.createStorage("preferences"),console.log("Using preferences storage")}catch(e){console.error("Storage initialization error:",e)}}})();let o=new Proxy({},{get:(e,t)=>{let a=l;if(a)return a[t]}})},3422:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>e5});var s=a(5155),n=a(2115),r=a(2587),i=a(1733),l=a(6497),o=a(2390),c=a(6711),d=a(2593),u=a(2649),m=a(639),h=a(3169),p=a(4206),g=a(6204),x=a(3173);let f=[{id:1,title:"Chat Directly with Your Documents",description:"No more endless scrolling or searching — just ask. document-chat.com understands your uploaded files, emails, and notes, and answers instantly with verified sources.",icon:(0,s.jsx)(o.A,{className:"w-16 h-16 text-white"}),gradient:"from-blue-500 to-cyan-600",features:["Upload PDFs, Word files, or emails","Ask AI questions about your content","Get exact answers — with source links"]},{id:2,title:"Your Living Company Knowledge Base",description:"Turn all company knowledge — from Confluence, SharePoint, or inboxes — into an intelligent chat assistant that your whole team can use anywhere.",icon:(0,s.jsx)(c.A,{className:"w-16 h-16 text-white"}),gradient:"from-green-500 to-emerald-600",features:["Search and chat across all company data","Collaborate with your team securely","Private, GDPR-compliant hosting in Germany"]},{id:3,title:"Work Smarter. Decide Faster.",description:"document-chat.com cuts search time, reduces misinformation, and keeps everyone aligned. Your team stays focused — your decisions stay informed.",icon:(0,s.jsx)(d.A,{className:"w-16 h-16 text-white"}),gradient:"from-orange-500 to-red-600",features:["Save up to 18h per week per employee","5-second summaries for any document","34% less misinformation across teams"]},{id:4,title:"Enterprise-Ready. German Data Security.",description:"Built for industries with the highest data protection needs — finance, healthcare, and automotive. Hosted on German servers and compliant with BaFin & Klinik-InfoSec laws.",icon:(0,s.jsx)(u.A,{className:"w-16 h-16 text-white"}),gradient:"from-purple-500 to-indigo-600",features:["24/7 AI assistant for your company knowledge","Complies with GDPR, BaFin, and hospital IT law","No access by non-EU cloud providers"]},{id:5,title:"Trusted by Industry Leaders",description:"Created by DataFortress.cloud, the data experts behind solutions for VW, BMW, Porsche, HPE, and Atruvia. Now available as a simple, powerful SaaS for your company.",icon:(0,s.jsx)(m.A,{className:"w-16 h-16 text-white"}),gradient:"from-pink-500 to-rose-600",features:["Proven enterprise-grade infrastructure","Custom integrations for Teams, Slack & more","Start boosting your team’s efficiency today"]}],w=e=>{let{onComplete:t}=e,[a,o]=(0,n.useState)(0),[w,v]=(0,n.useState)(0),[b,y]=(0,n.useState)(!1),j=f[a],N="web"!==r.Capacitor.getPlatform(),C=50,k=e=>{v(e>a?1:-1),o(e)},S=()=>{y(!0)},E=()=>{b&&t()},A=()=>{a<f.length-1?k(a+1):S()},P=()=>{a>0&&k(a-1)},_=()=>{S()},I=(e,t)=>{if(b)return;let s=t.offset.x,n=t.velocity.x;s<-C||n<-500?a<f.length-1&&k(a+1):(s>C||n>500)&&a>0&&k(a-1)},D={enter:e=>({x:e>0?300:-300,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?300:-300,opacity:0})},T=()=>{switch(a){case 0:return(0,s.jsxs)(i.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:N?.8:1,duration:N?.4:.6},className:"flex items-center space-x-4 mb-6",children:[(0,s.jsx)("div",{className:"flex -space-x-2",children:["\uD83D\uDCDD","⏱️","✅"].map((e,t)=>(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r ".concat(0===t?"from-blue-400 to-blue-600":1===t?"from-indigo-400 to-indigo-600":"from-green-400 to-green-600"," border-2 border-white flex items-center justify-center shadow-lg"),children:(0,s.jsx)("span",{className:"text-xl",children:e})},t))}),(0,s.jsx)("span",{className:"text-sm text-white/80",children:"1000+ users"})]});case 1:return(0,s.jsxs)(i.P.div,{initial:{scale:0,rotate:-10},animate:{scale:1,rotate:0},transition:{delay:N?.8:1.05,duration:N?.5:.7},className:"relative mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center",children:(0,s.jsx)(d.A,{className:"w-8 h-8 text-white"})}),(0,s.jsx)(i.P.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},className:"absolute -inset-2 border-2 border-white/30 rounded-full"}),(0,s.jsx)(i.P.div,{animate:{rotate:[0,360]},transition:{duration:4,repeat:1/0,ease:"linear"},className:"absolute top-1 right-1 w-3 h-3 bg-white rounded-full"})]});case 2:return(0,s.jsxs)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.8:1,duration:N?.4:.6},className:"flex items-center space-x-2 mb-6",children:[(0,s.jsx)(h.A,{className:"w-6 h-6 text-white"}),(0,s.jsx)("div",{className:"flex space-x-1",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(i.P.div,{className:"w-3 h-2 bg-white/80 rounded-sm",animate:{scaleY:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,delay:.2*t}},t))}),(0,s.jsx)("span",{className:"text-xs text-white/70",children:"Secure Payment"})]});case 3:return(0,s.jsx)(i.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:N?.8:1,duration:N?.4:.6},className:"grid grid-cols-2 gap-3 mb-6",children:[u.A,m.A,c.A,p.A].map((e,t)=>(0,s.jsx)(i.P.div,{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",whileHover:{scale:1.1},animate:{y:[0,-5,0]},transition:{y:{duration:2,repeat:1/0,delay:.2*t}},children:(0,s.jsx)(e,{className:"w-6 h-6 text-white"})},t))});default:return null}};return(0,s.jsxs)(i.P.div,{className:"fixed inset-0 bg-gradient-to-br from-orange-500 via-red-500 to-pink-600 flex flex-col z-30 overflow-hidden",style:{paddingTop:"calc(env(safe-area-inset-top, 1.5rem))"},initial:{opacity:1},animate:{opacity:+!b},transition:{duration:.5},onAnimationComplete:E,children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-6",children:[(0,s.jsx)("div",{className:"flex space-x-2",children:f.map((e,t)=>(0,s.jsx)("button",{onClick:()=>!b&&k(t),disabled:b,className:"w-8 h-2 rounded-full transition-all duration-300 ".concat(t===a?"bg-white scale-110":t<a?"bg-white/60":"bg-white/30"," disabled:opacity-50"),"aria-label":"Go to slide ".concat(t+1)},t))}),a<f.length-1&&(0,s.jsx)("button",{onClick:_,disabled:b,className:"text-white/80 hover:text-white transition-colors text-sm font-medium disabled:opacity-50",children:"Skip"})]}),(0,s.jsx)("div",{className:"flex-1 relative overflow-hidden",children:(0,s.jsx)(l.N,{initial:!1,custom:w,mode:"wait",children:(0,s.jsxs)(i.P.div,{custom:w,variants:D,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:"x",dragConstraints:{left:0,right:0},dragElastic:.3,onDragEnd:I,className:"absolute inset-0 flex flex-col items-center justify-center text-center px-8",children:[(0,s.jsx)(i.P.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:N?.2:.35,duration:N?.6:.8,ease:"easeOut"},className:"w-32 h-32 rounded-full bg-gradient-to-r ".concat(j.gradient," flex items-center justify-center mb-8 shadow-2xl"),children:j.icon}),(0,s.jsx)(i.P.h2,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.3:.45,duration:N?.6:.8},className:"text-3xl font-bold text-white mb-4",children:j.title}),(0,s.jsx)(i.P.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.4:.55,duration:N?.6:.8},className:"text-lg text-white/90 mb-8 max-w-sm leading-relaxed",children:j.description}),(0,s.jsx)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.5:.65,duration:N?.6:.8},className:"space-y-3 mb-8",children:j.features.map((e,t)=>(0,s.jsxs)(i.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:(N?.6:.8)+.12*t,duration:N?.4:.55},className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r ".concat(j.gradient," flex items-center justify-center shadow-md"),children:(0,s.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})}),(0,s.jsx)("span",{className:"text-white/90 font-medium",children:e})]},e))}),T()]},a)})}),(0,s.jsxs)("div",{className:"p-6 flex justify-between items-center",children:[(0,s.jsxs)("button",{onClick:P,disabled:0===a||b,className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all ".concat(0===a||b?"text-white/40 cursor-not-allowed":"text-white/80 hover:text-white hover:bg-white/10"),children:[(0,s.jsx)(g.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Back"})]}),(0,s.jsxs)(i.P.button,{onClick:A,disabled:b,className:"flex items-center space-x-2 px-6 py-3 rounded-lg font-medium transition-all shadow-lg ".concat(a===f.length-1?"bg-orange-600 hover:bg-orange-700 text-white":"bg-white text-orange-600 hover:bg-orange-50"," disabled:opacity-50"),whileTap:{scale:.95},children:[(0,s.jsx)("span",{children:a===f.length-1?"Start increasing my productivity by 64%":"Next"}),(0,s.jsx)(x.A,{className:"w-5 h-5"})]})]})]})},v=e=>{let{children:t}=e,[a,r]=(0,n.useState)(!1),[i,l]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("onboardingCompleted"),t="true"===e;r(t)}catch(e){console.error("Error during app initialization:",e),r(!1)}finally{l(!0)}})()},[]);let o=async()=>{try{localStorage.setItem("onboardingCompleted","true"),r(!0)}catch(e){console.error("Failed to save onboarding status:",e)}};return i?a?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)(w,{onComplete:o}):null};var b=a(3589);let y=()=>{let[e,t]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=!0;return(async()=>{try{await b.S.hide()}catch(e){}let a=setTimeout(()=>{e&&t(!1)},2e3);return()=>clearTimeout(a)})(),()=>{e=!1}},[]),{showSplash:e}};var j=a(3941),N=a(5704);let C={api:{url:(r.Capacitor.isNativePlatform(),N.env.NEXT_PUBLIC_PRODUCTION_URL),timeout:1e4,secret:N.env.NEXT_PUBLIC_API_KEY||""},firebase:{apiKey:N.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:N.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:N.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:N.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:N.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:N.env.NEXT_PUBLIC_FIREBASE_APP_ID,measurementId:N.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID},notifications:{telegram:{apiKey:N.env.NEXT_PUBLIC_TELEGRAM_API_KEY,chatId:N.env.NEXT_PUBLIC_TELEGRAM_CHAT_ID,apiUrl:N.env.NEXT_PUBLIC_TELEGRAM_API_URL}},revenuecat:{apiKey:N.env.NEXT_PUBLIC_REVENUECAT_API_KEY,apiKeyGoogle:N.env.NEXT_PUBLIC_REVENUECAT_API_KEY_GOOGLE,lifetimeProductId:N.env.NEXT_PUBLIC_REVENUECAT_LIFETIME_PRODUCT_ID,monthlyProductId:N.env.NEXT_PUBLIC_REVENUECAT_MONTHLY_PRODUCT_ID,annuallyProductId:N.env.NEXT_PUBLIC_REVENUECAT_ANNUALLY_PRODUCT_ID,weeklyProductId:N.env.NEXT_PUBLIC_REVENUECAT_WEEKLY_PRODUCT_ID,googleGroupId:N.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_GROUP_ID,googleWeeklyProductId:N.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_WEEKLY_PRODUCT_ID,googleMonthlyProductId:N.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_MONTHLY_PRODUCT_ID,googleLifetimeProductId:N.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_LIFETIME_PRODUCT_ID,googleAnnuallyProductId:N.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_ANNUALLY_PRODUCT_ID},openai:{apiKey:N.env.OPENAI_API_KEY},app:{name:"DocumentChatApp",version:N.env.npm_package_version||"2.0.0",environment:"production"}};var k=a(1004);let S=(0,n.createContext)(null),E=async e=>{if(!e)throw Error("User ID is required");if(await k.P.setLogLevel({level:k.E$.DEBUG}),"ios"===r.Capacitor.getPlatform()){if(!C.revenuecat.apiKey)return;await k.P.configure({apiKey:C.revenuecat.apiKey||"",appUserID:e})}else if("android"===r.Capacitor.getPlatform()){if(!C.revenuecat.apiKeyGoogle)return;await k.P.configure({apiKey:C.revenuecat.apiKeyGoogle||"",appUserID:e})}},A=async()=>await k.P.restorePurchases(),P=e=>{switch(e){case"weekly":return C.revenuecat.weeklyProductId||"";case"monthly":return C.revenuecat.monthlyProductId||"";case"annually":return C.revenuecat.annuallyProductId||"";case"lifetime":return C.revenuecat.lifetimeProductId||"";default:throw Error("Unsupported product type: ".concat(e))}},_=async e=>{let t="";if("ios"===r.Capacitor.getPlatform()?t=P(e):"android"===r.Capacitor.getPlatform()&&(t=C.revenuecat.googleGroupId||""),!t)throw Error("Product identifier is not configured");let{products:a}=await k.P.getProducts({productIdentifiers:[t]});if(!a.length)throw Error("No product found for ".concat(e));if("android"===r.Capacitor.getPlatform()){let t="";switch(e){case"weekly":t=C.revenuecat.googleWeeklyProductId||"";break;case"annually":t=C.revenuecat.googleAnnuallyProductId||"";break;case"monthly":t=C.revenuecat.googleMonthlyProductId||"";break;case"lifetime":t=C.revenuecat.googleLifetimeProductId||"";break;default:throw Error("Unsupported product type: ".concat(e))}if(!t)throw Error("Product ID for ".concat(e," is not configured for Android"));let s=a.find(e=>e.identifier===t);if(!s)throw Error("No product found for ".concat(e," in Android"));return s}return a[0]},I=async e=>{let t=await _(e),a=await k.P.purchaseStoreProduct({product:t});return{success:a.customerInfo.allPurchasedProductIdentifiers.length>0,customerInfo:a.customerInfo}},D=e=>{let{userId:t,children:a}=e,[i,l]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(null),[p,g]=(0,n.useState)(!1),[x,f]=(0,n.useState)([]),[w,v]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=async()=>{try{c(!0),await E(t);let e=await k.P.getCustomerInfo();u(e),g(e.customerInfo.activeSubscriptions.length>0);let a=C.revenuecat.weeklyProductId,s=C.revenuecat.annuallyProductId,n=C.revenuecat.googleGroupId,i=[""];if("ios"===r.Capacitor.getPlatform()){if(!a||!s)throw Error("RevenueCat product IDs are not configured for iOS");i=[a,s]}else if("android"===r.Capacitor.getPlatform()){if(!n)throw Error("RevenueCat Google group ID is not configured for Android");i=[n]}let{products:o}=await k.P.getProducts({productIdentifiers:i});f(o);let d=o.find(e=>e.identifier===a),m=o.find(e=>e.identifier===s);d&&m&&v({weekly:{price:d.price.toString(),priceString:d.priceString},annually:{price:m.price.toString(),priceString:m.priceString}}),l(!0)}catch(e){h(e instanceof Error?e:Error("Unknown init error"))}finally{c(!1)}};t&&!i&&e()},[t]);let b=async e=>{try{c(!0);let t=await I(e);return u(t.customerInfo),g(t.success),t}catch(e){throw h(e instanceof Error?e:Error("Unknown purchase error")),e}finally{c(!1)}},y=async()=>{try{c(!0);let e=await A();return u(e),g(e.customerInfo.activeSubscriptions.length>0),e}catch(e){throw h(e instanceof Error?e:Error("Unknown restore error")),e}finally{c(!1)}};return(0,s.jsx)(S.Provider,{value:{isInitialized:i,isLoading:o,customerInfo:d,error:m,isPro:p,purchase:b,restore:y,products:x,pricing:w},children:a})};var T=a(4544);let L={user:null,session:null,loading:!0},U=()=>{let[e,t]=(0,n.useState)(L);return(0,n.useEffect)(()=>{let e=!0;(async()=>{try{var a,s,n;let{data:r,error:i}=await j.N.auth.getSession();if(!e)return;if(i){console.warn("Failed to load Supabase session",i),t({user:null,session:null,loading:!1});return}t({user:null!=(s=null==(a=r.session)?void 0:a.user)?s:null,session:null!=(n=r.session)?n:null,loading:!1}),r.session||(0,T.clearCachedToken)()}catch(a){if(!e)return;console.warn("Unexpected Supabase session error",a),t({user:null,session:null,loading:!1})}})();let{data:{subscription:a}}=j.N.auth.onAuthStateChange((a,s)=>{var n;e&&(t({user:null!=(n=null==s?void 0:s.user)?n:null,session:null!=s?s:null,loading:!1}),s||(0,T.clearCachedToken)())});return()=>{e=!1,a.unsubscribe()}},[]),e};var M=a(4375),R=a(1333),B=a(2338),O=a(6888),z=a(5239);let W={src:"/_next/static/media/logo.edf7a71c.png",height:512,width:512,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAVFBMVEVMaXEcYYlifYxaS0sjhbFeb3IyX3i8ubV4lJl1lJ5KepOfsLMwao0mYohwk6CwsLelp5hHgJNvj56luL9oipd4pLCWsLgrpsavv8dptsBxmqlMjajS1i7tAAAAF3RSTlMA90Mi/vz6DDN8hWXj2WRL+PyMtP2SiaS1QfEAAAAJcEhZcwAACxMAAAsTAQCanBgAAABASURBVHicHYtJDoAgEMCKAgOKC7ig8v9/mqGHHpoUFOna4vHMwP3m81uBq+7OBKA0530AidXapEUmswz9ZdT7B0pRAdc6vmhwAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8};function F(){let[e,t]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=setInterval(()=>{t(t=>t>=100?(clearInterval(e),100):t+15*Math.random()+5)},200);return()=>clearInterval(e)},[]);let a="web"!==r.Capacitor.getPlatform();return(0,s.jsxs)(i.P.div,{initial:{opacity:1},animate:{opacity:0},transition:{duration:a?.5:.8,delay:a?1.5:1.8},className:"fixed inset-0 pointer-events-none overflow-hidden bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 flex flex-col items-center justify-center z-50",children:[(0,s.jsxs)("div",{className:"absolute inset-0 opacity-10",children:[(0,s.jsx)("div",{className:"absolute top-1/4 left-1/4 w-32 h-32 bg-white rounded-full blur-3xl"}),(0,s.jsx)("div",{className:"absolute bottom-1/4 right-1/4 w-24 h-24 bg-white rounded-full blur-2xl"}),(0,s.jsx)("div",{className:"absolute top-3/4 left-1/3 w-16 h-16 bg-white rounded-full blur-xl"})]}),(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center",children:[(0,s.jsx)(i.P.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"mb-8",children:(0,s.jsx)("div",{className:"bg-white p-6 rounded-3xl shadow-2xl flex items-center justify-center",children:(0,s.jsx)(z.default,{src:W,alt:"DocumentChat logo",width:56,height:56})})}),(0,s.jsxs)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.6},className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"DocumentChatApp"}),(0,s.jsx)("p",{className:"text-blue-100 text-lg",children:"Chat with your documents"})]}),(0,s.jsxs)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6,duration:.6},className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-64 h-1 bg-blue-400/30 rounded-full mb-4 overflow-hidden",children:(0,s.jsx)(i.P.div,{className:"h-full bg-white rounded-full",initial:{width:0},animate:{width:"".concat(e,"%")},transition:{duration:.3}})}),(0,s.jsx)(i.P.p,{className:"text-blue-100 text-sm",animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},children:"Loading amazing features..."})]}),(0,s.jsx)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:1,duration:.6},className:"flex flex-wrap justify-center gap-2 mt-8 max-w-xs",children:["Cross-Platform","Fast","Native","Modern"].map((e,t)=>(0,s.jsx)(i.P.span,{initial:{scale:0},animate:{scale:1},transition:{delay:1.2+.1*t},className:"px-3 py-1 bg-white/20 rounded-full text-white text-xs font-medium",children:e},e))})]}),(0,s.jsx)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((e,t)=>(0,s.jsx)(i.P.div,{className:"absolute w-2 h-2 bg-white/20 rounded-full",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")},animate:{y:[-20,20,-20],opacity:[.2,.8,.2]},transition:{duration:3+2*Math.random(),repeat:1/0,delay:2*Math.random()}},t))})]})}let G=(0,n.createContext)(null),H=()=>{let e=(0,n.useContext)(G);if(!e)throw Error("useToast must be used within ToastProvider");return e},V=e=>{let{children:t}=e,[a,r]=(0,n.useState)([]),i=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=String(Date.now())+Math.random().toString(36).slice(2,6),s={id:a,message:e,type:t};r(e=>[s,...e]),setTimeout(()=>{r(e=>e.filter(e=>e.id!==a))},4500)},[]);return(0,s.jsxs)(G.Provider,{value:{show:i},children:[t,(0,s.jsx)("div",{className:"fixed bottom-6 right-4 z-50 flex flex-col gap-2",children:a.map(e=>(0,s.jsx)("div",{className:"px-4 py-2 rounded-lg shadow-md text-sm text-white ".concat("success"===e.type?"bg-green-500":"error"===e.type?"bg-red-500":"bg-blue-500"),children:e.message},e.id))})]})};var q=a(2090),K=a.n(q),X=a(2663);let J=function(){return(0,s.jsx)(R.AO,{children:(0,s.jsx)(R.W9,{className:"bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 ".concat(K().className),children:(0,s.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-full grid place-items-center p-6",children:(0,s.jsx)("div",{className:"w-full max-w-md",children:(0,s.jsxs)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},className:"flex flex-col items-center justify-center bg-white/10 backdrop-blur-md rounded-3xl p-6 sm:p-10 shadow-2xl space-y-6",children:[(0,s.jsx)(i.P.img,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},src:"/logo.png",className:"h-20 w-20 sm:h-24 sm:w-24 drop-shadow-lg",alt:"App Logo"}),(0,s.jsxs)("div",{className:"space-y-2 text-center",children:[(0,s.jsx)(i.P.h1,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.5},className:"text-white text-3xl font-bold",children:"Welcome Back"}),(0,s.jsx)(i.P.p,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.5},className:"text-white/90 font-medium",children:"Sign in to continue your journey"})]}),(0,s.jsxs)(i.P.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5},className:"w-full space-y-3",children:[(0,s.jsx)(Q,{}),(0,s.jsx)($,{})]}),(0,s.jsxs)(i.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.5},className:"text-white/80 text-center text-xs",children:["By signing in, you agree to our"," ",(0,s.jsx)("a",{href:"https://document-chat.com/terms-conditions/",className:"link link-hover text-blue-200 underline",target:"_blank",rel:"noopener noreferrer",children:"Terms"})," ","and"," ",(0,s.jsx)("a",{href:"https://document-chat.com/privacy-policy/",className:"link link-hover text-blue-200 underline",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]})})})})})};function Y(e){let{setLoading:t,provider:a}=e,n=(0,R.jq)(),i=async()=>{t(!0);try{(0,T.clearCachedToken)();let{data:e,error:t}=await j.N.auth.signInWithOAuth({provider:a,options:{redirectTo:"".concat(window.location.origin,"/app"),skipBrowserRedirect:r.Capacitor.isNativePlatform()}});if(t)throw t;if(r.Capacitor.isNativePlatform())if(null==e?void 0:e.url){if((0,X.Ay)("Continue the sign-in flow in the browser window that just opened.",{position:"bottom-center",duration:6e3}),"function"==typeof window.open)try{window.open(e.url,"_blank")}catch(e){console.warn("Unable to open OAuth URL",e)}}else(0,X.Ay)("OAuth sign-in is configured. Follow the instructions in your browser to finish logging in.",{position:"bottom-center",duration:6e3});else(null==e?void 0:e.url)||n.push("/app","root","replace")}catch(t){let e=t instanceof Error?t.message:"OAuth sign-in failed";X.Ay.error(e)}finally{t(!1)}},l="google"===a?"Continue with Google":"Continue with Apple",o={google:"bg-base-100 text-base-content hover:bg-base-200",apple:"bg-black text-white hover:bg-gray-900"};return(0,s.jsxs)("button",{onClick:i,className:"flex items-center justify-center gap-3 rounded-xl ".concat(o[a]," w-full py-3.5 font-medium shadow-lg transition duration-300 transform hover:translate-y-[-2px]"),children:["google"===a?(0,s.jsx)(z.default,{src:"/google.png",alt:"Google Icon",width:20,height:20}):(0,s.jsx)(Z,{}),l]})}function Q(){let[e,t]=(0,n.useState)(!1);return(r.Capacitor.getPlatform(),e)?(0,s.jsx)("div",{className:"flex justify-center py-4",children:(0,s.jsx)(i.P.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full"})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(Y,{setLoading:t,provider:"google"})})}function $(){let[e,t]=(0,n.useState)("signin"),[a,r]=(0,n.useState)(""),[i,l]=(0,n.useState)(""),[o,c]=(0,n.useState)(!1),d=(0,R.jq)(),u=async s=>{if(null==s||s.preventDefault(),!a.trim()||!i.trim())return void X.Ay.error("Please provide both email and password");c(!0);try{if((0,T.clearCachedToken)(),"signin"===e){let{error:e}=await j.N.auth.signInWithPassword({email:a.trim(),password:i});if(e)throw e;X.Ay.success("Signed in")}else{let{data:e,error:s}=await j.N.auth.signUp({email:a.trim(),password:i});if(s)throw s;if(!e.session){X.Ay.success("Check your email to confirm your account"),t("signin");return}X.Ay.success("Account created")}d.push("/app","root","replace")}catch(e){console.error("Email auth error",e),X.Ay.error((null==e?void 0:e.message)||String(e))}finally{c(!1)}},m=async()=>{if(!a.trim())return void(0,X.Ay)("Please enter your email to reset password");c(!0);try{let{error:e}=await j.N.auth.resetPasswordForEmail(a.trim(),{redirectTo:"".concat(window.location.origin,"/app")});if(e)throw e;X.Ay.success("Password reset email sent")}catch(e){console.error("Reset password error",e),X.Ay.error((null==e?void 0:e.message)||String(e))}finally{c(!1)}};return(0,s.jsxs)("form",{onSubmit:u,className:"bg-base-200/50 p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("div",{className:"text-sm text-white",children:"signin"===e?"Sign in with email":"Register with email"}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["signin"===e&&(0,s.jsx)("button",{type:"button",onClick:m,className:"text-xs text-blue-200",children:"Forgot password?"}),(0,s.jsx)("button",{type:"button",onClick:()=>t("signin"===e?"register":"signin"),className:"text-xs text-blue-200",children:"signin"===e?"Create account":"Have an account?"})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("input",{value:a,onChange:e=>r(e.target.value),placeholder:"Email",type:"email",className:"input input-bordered w-full bg-base-100 text-base-content placeholder:text-base-content/60"}),(0,s.jsx)("input",{value:i,onChange:e=>l(e.target.value),placeholder:"Password",type:"password",className:"input input-bordered w-full bg-base-100 text-base-content placeholder:text-base-content/60"}),(0,s.jsx)("button",{disabled:o,type:"submit",className:"btn btn-primary btn-block",children:o?"Working...":"signin"===e?"Sign in":"Register"})]})]})}function Z(){return(0,s.jsxs)("svg",{fill:"currentColor",height:"20px",width:"20px",version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22.773 22.773",children:[(0,s.jsx)("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),(0,s.jsx)("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("g",{id:"SVGRepo_iconCarrier",children:(0,s.jsx)("g",{children:(0,s.jsxs)("g",{children:[(0,s.jsx)("path",{d:"M15.769,0c0.053,0,0.106,0,0.162,0c0.13,1.606-0.483,2.806-1.228,3.675c-0.731,0.863-1.732,1.7-3.351,1.573 c-0.108-1.583,0.506-2.694,1.25-3.561C13.292,0.879,14.557,0.16,15.769,0z"}),(0,s.jsx)("path",{d:"M20.67,16.716c0,0.016,0,0.03,0,0.045c-0.455,1.378-1.104,2.559-1.896,3.655c-0.723,0.995-1.609,2.334-3.191,2.334 c-1.367,0-2.275-0.879-3.676-0.903c-1.482-0.024-2.297,0.735-3.652,0.926c-0.155,0-0.31,0-0.462,0 c-0.995-0.144-1.798-0.932-2.383-1.642c-1.725-2.098-3.058-4.808-3.306-8.276c0-0.34,0-0.679,0-1.019 c0.105-2.482,1.311-4.5,2.914-5.478c0.846-0.52,2.009-0.963,3.304-0.765c0.555,0.086,1.122,0.276,1.619,0.464 c0.471,0.181,1.06,0.502,1.618,0.485c0.378-0.011,0.754-0.208,1.135-0.347c1.116-0.403,2.21-0.865,3.652-0.648 c1.733,0.262,2.963,1.032,3.723,2.22c-1.466,0.933-2.625,2.339-2.427,4.74C17.818,14.688,19.086,15.964,20.67,16.716z"})]})})})]})}var ee=a(8623),et=a(3063);function ea(){let e=(0,n.useRef)(null),[t,a]=(0,n.useState)(!1);function s(){var t;null==(t=e.current)||t.present(),a(!0)}function r(){var t;null==(t=e.current)||t.dismiss(),a(!1)}return{modalRef:e,isOpen:t,open:s,close:r}}let es=function(e){let{title:t,modalRef:a,presentingElement:n,children:r,left:i,right:l}=e;return(0,s.jsx)(R.Sb,{ref:a,presentingElement:n||void 0,children:(0,s.jsxs)("div",{className:"h-full",children:[(i||l||t)&&(0,s.jsxs)(R.eU,{children:[(i||l)&&(0,s.jsxs)(R.ai,{children:[i&&(0,s.jsx)(R.QW,{slot:"start",children:i}),l&&(0,s.jsx)(R.QW,{slot:"end",children:l})]}),t&&(0,s.jsx)(R.ai,{children:(0,s.jsx)(R.BC,{className:"w-full text-center",children:t})})]}),(0,s.jsx)(R.W9,{children:(0,s.jsx)("div",{className:"mt-4",children:r})})]})})};function en(e){let{children:t,pageRef:a,header:n,collapse:l,toolbarClassName:o=""}=e,c="web"!==r.Capacitor.getPlatform();return(0,s.jsxs)(R.AO,{ref:a,className:"bg-base-100 text-base-content",children:[n&&(0,s.jsx)(R.eU,{collapse:"ios"===r.Capacitor.getPlatform()?l:void 0,children:(0,s.jsx)(R.ai,{className:o,children:n})}),(0,s.jsx)(R.W9,{className:"ion-padding bg-base-100 text-base-content",children:(0,s.jsx)(i.P.div,{initial:{opacity:.995,scale:.98},animate:{opacity:1,scale:1},transition:{duration:c?.25:.45},children:t})})]})}var er=a(7041);function ei(e){let{doc:t,presentingElement:a,onClose:r,onDelete:l}=e,{modalRef:o,open:c,close:d}=ea();n.useEffect(()=>{t?c():d()},[t]);let u=t?t.filename||t.name||String(t.id||""):"",m=t?t.zoomed_in_url||t.cover_url||t.previewUrl||t.url:null,h=t&&(t.url||t.download_url||m)||"",p=t?String(t.content||t.summary||t.excerpt||u):"";return(0,s.jsx)(es,{title:u?u.length>32?u.slice(0,32)+"…":u:"Preview",modalRef:o,presentingElement:a,left:(0,s.jsx)("button",{onClick:r,children:"Close"}),right:(0,s.jsxs)("div",{className:"flex gap-2",children:[t&&(t.url||t.download_url)?(0,s.jsx)("a",{href:t.url||t.download_url,download:!0,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-sm",title:"Download document",children:"Download"}):null,t?(0,s.jsx)("button",{className:"btn btn-ghost text-error btn-sm",onClick:()=>l&&t&&l(t),title:"Delete document",children:"Delete"}):null]}),children:t?(0,s.jsxs)("div",{className:"p-4",children:[m?(0,s.jsx)("a",{href:h,download:!0,target:"_blank",rel:"noopener noreferrer",title:"Download document","aria-label":"Open ".concat(u," in new tab"),className:"block",children:(0,s.jsxs)("div",{className:"relative w-full h-96",children:[(0,s.jsx)(i.P.img,{src:m,alt:u,className:"w-full h-full object-contain cursor-pointer",initial:{scale:.98,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.98,opacity:0},transition:{duration:.22}}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-end",children:(0,s.jsx)("div",{className:"w-full p-3",children:(0,s.jsxs)("div",{className:"bg-black bg-opacity-60 text-white rounded-md p-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold truncate",children:u}),(0,s.jsx)("div",{className:"mt-1 text-xs leading-tight",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:p})]})})})]})}):(0,s.jsx)("div",{className:"w-full h-96 bg-base-300 flex items-center justify-center text-base-content",children:(0,s.jsx)("div",{className:"p-3 w-full",children:(0,s.jsxs)("div",{className:"bg-black bg-opacity-60 text-white rounded-md p-2 mx-auto max-w-full",children:[(0,s.jsx)("div",{className:"text-sm font-semibold truncate",children:u}),(0,s.jsx)("div",{className:"mt-1 text-xs leading-tight",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:p})]})})}),(0,s.jsx)("div",{className:"mt-3 text-sm text-gray-300",children:(0,s.jsx)(er.o,{children:p})})]}):null})}var el=a(838);let eo="https://dokuchat.api.datafortress.cloud",ec=eo?/^https?:\/\//i.test(eo)?eo:"https://".concat(eo):"";function ed(){if(!ec)throw Error("DocumentChat API base is not configured. Set NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE to your backend URL (for example http://localhost:8000)")}async function eu(e){if((e.headers.get("content-type")||"").includes("text/html")){let t=await e.text();throw Error("Server returned HTML instead of JSON. This usually means NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE is missing or incorrect. Response snippet: ".concat(t.slice(0,200)))}return e.json()}let em=null;function eh(e){return e?{Authorization:"Bearer ".concat(e)}:{}}async function ep(e){if(e)return e;if(em)try{return await em()}catch(e){return console.warn("tokenProvider failed",e),null}try{let{default:e}=a(4544);return await e()}catch(e){return null}}let eg={createProject:async function(e,t){ed();let a=await ep(t),s="".concat(ec,"/fullapi/").concat(encodeURIComponent(e)),n=await fetch(s,{method:"POST",headers:{...eh(a),"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!n.ok)throw Error("createProject failed: ".concat(n.status));return eu(n)},uploadDocuments:async function(e,t,a,s){ed();let n=await ep(s),r="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/upload"),i=new FormData;t.forEach(e=>i.append("files",e)),void 0!==a&&i.append("highresmode",a.toString());let l=await fetch(r,{method:"POST",headers:{...eh(n)},body:i});if(!l.ok)throw Error("uploadDocuments failed: ".concat(l.status));return eu(l)},listDocuments:async function(e,t){ed();let a=await ep(t),s="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/documents"),n=await fetch(s,{headers:{...eh(a)}});if(!n.ok)throw Error("listDocuments failed: ".concat(n.status));return eu(n)},deleteDocument:async function(e,t,a){ed();let s=await ep(a),n="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/documents/").concat(encodeURIComponent(String(t)));try{console.debug("[documentChatApi] DELETE",n,{projectName:e,documentId:t})}catch(e){}let r=await fetch(n,{method:"DELETE",headers:{...eh(s)}});if(!r.ok)throw Error("deleteDocument failed: ".concat(r.status));return eu(r)},deleteChat:async function(e,t,a){ed();let s=await ep(a),n="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)));try{console.debug("[documentChatApi] DELETE CHAT",n,{projectName:e,chatId:t})}catch(e){}let r=await fetch(n,{method:"DELETE",headers:{...eh(s)}});if(!r.ok)throw Error("deleteChat failed: ".concat(r.status));return eu(r)},deleteProjectApi:async function(e,t){ed();let a=await ep(t),s="".concat(ec,"/fullapi/").concat(encodeURIComponent(e));try{console.debug("[documentChatApi] DELETE PROJECT",s,{projectName:e})}catch(e){}let n=await fetch(s,{method:"DELETE",headers:{...eh(a)}});if(!n.ok)throw Error("deleteProject failed: ".concat(n.status));return eu(n)},createChatByName:async function(e,t,a){ed();let s=await ep(a),n="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(t));try{console.debug("[documentChatApi] CREATE CHAT BY NAME",n,{projectName:e,chatName:t})}catch(e){}let r=await fetch(n,{method:"POST",headers:{...eh(s),"Content-Type":"application/json"},body:""});if(!r.ok)throw Error("createChatByName failed: ".concat(r.status));return eu(r)},getChatByProject:async function(e,t,a){ed();let s=await ep(a),n="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t))),r=await fetch(n,{headers:{...eh(s)}});if(!r.ok)throw Error("getChatByProject failed: ".concat(r.status));return eu(r)},addMessage:async function(e,t,a,s){ed();let n=await ep(s),r="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)),"/message"),i=await fetch(r,{method:"PUT",headers:{...eh(n),"Content-Type":"application/json"},body:JSON.stringify({message:a,persona:"user"})});if(!i.ok)throw Error("addMessage failed: ".concat(i.status));return eu(i)},listProjects:async function(e){ed();let t=await ep(e),a="".concat(ec,"/fullapi"),s=await fetch(a,{headers:{...eh(t)}});if(!s.ok)throw Error("listProjects failed: ".concat(s.status));return eu(s)},listChats:async function(e,t){ed();let a=await ep(t),s="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/chats"),n=await fetch(s,{headers:{...eh(a)}});if(!n.ok)throw Error("listChats failed: ".concat(n.status));return eu(n)},renameChat:async function(e,t,a,s){ed();let n=await ep(s),r="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)),"/rename"),i=new URLSearchParams({new_name:a}).toString(),l=await fetch(r,{method:"PUT",headers:{...eh(n),Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:i});if(!l.ok)throw Error("renameChat failed: ".concat(l.status));return eu(l)},setTokenProvider:function(e){em=e},clearTokenProvider:function(){em=null},quicksearchDocuments:async function(e,t,a){ed();let s=await ep(a),n="".concat(ec,"/fullapi/").concat(encodeURIComponent(e),"/quicksearch/").concat(encodeURIComponent(t)),r=await fetch(n,{headers:{...eh(s)}});if(!r.ok)throw Error("quicksearchDocuments failed: ".concat(r.status));return eu(r)}};var ex=a(3630),ef=a(2614),ew=a(1165),ev=a(6615),eb=a(4979),ey=a(8527),ej=a(2036);let eN=20,eC=e=>{if(/^\d{1,2}:\d{2}$/.test(e))return e;try{let t=new Date(e);if(!isNaN(t.getTime()))return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){}return e||"00:00"},ek=e=>[{id:"welcome",text:"Hey, I know everything about the documents you uploaded in this project - feel free to ask me any questions about them :).",sender:"other",time:new Date().toISOString(),status:"read"}],eS="Hey, I know everything about the documents you uploaded in this project - feel free to ask me any questions about them :).";function eE(e){let{chatId:t}=e,[a,r]=(0,n.useState)(""),[i,l]=(0,n.useState)([]),[o,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[m,h]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!1),{session:w}=U(),v=(0,n.useRef)(null),b=(0,n.useRef)(null),y=(0,n.useRef)(null),j=(0,n.useRef)(null);(0,n.useRef)(null),(0,n.useEffect)(()=>{if(!w)return void eg.clearTokenProvider();try{eg.setTokenProvider(async()=>await (0,T.default)(w))}catch(e){console.warn("Failed to register token provider",e)}return()=>{try{eg.clearTokenProvider()}catch(e){console.warn("Failed to clear token provider",e)}}},[w]);let[N,C]=(0,n.useState)("IDLE"),[k,S]=(0,n.useState)(void 0);(0,n.useEffect)(()=>{f("PENDING"===N)},[N]);let E=H(),[A,P]=(0,n.useState)(null),[_,I]=(0,n.useState)(null),{modalRef:D,open:L,close:M}=ea(),[B,O]=(0,n.useState)(""),[z,W]=(0,n.useState)(null),[F,G]=(0,n.useState)(""),[V,q]=(0,n.useState)(1),[K,X]=(0,n.useState)(!0),[J,Y]=(0,n.useState)(!0),[Q,$]=(0,n.useState)(!1),[Z,ee]=(0,n.useState)(0),{modalRef:et,open:eo,close:ec}=ea(),[ed,eu]=(0,n.useState)(null),{modalRef:em,open:eh,close:ep}=ea(),[ey,ej]=(0,n.useState)(null),[eC,eE]=(0,n.useState)(!1),e_=!0,eI=/here is (the )?answer( (from|based on) )? ?your documents/i,eD=(0,n.useRef)([]),[eT,eL]=(0,n.useState)(0),[eU,eM]=(0,n.useState)(!1),eR=(0,n.useCallback)((e,t)=>{if(e_)try{let a=(()=>{if(void 0===t)return"";if("string"==typeof t)return t;try{return JSON.stringify(t,(e,t)=>"function"==typeof t?"[function]":t,2)}catch(e){try{return String(t)}catch(e){return"[unserializable]"}}})(),s="".concat(new Date().toISOString()," [").concat(e,"] ").concat(a);eD.current.push(s),eD.current.length>200&&eD.current.shift(),eL(e=>e+1),console.log("[DBG]",e,t)}catch(t){console.log("[DBG] failed to record",e,t)}},[]),eB=(0,n.useCallback)((e,t)=>{if(e_)try{console.debug("[mergeMessages] local:",e,"incoming:",t)}catch(e){}let a=new Map;for(let t of e)a.set(t.id,{...t,time:t.time||new Date().toISOString()});for(let e of t){let t={...e,time:e.time||new Date().toISOString(),status:e.status||"read"},s=(t.text||"").trim(),n=eI.test(s);if(n){let e=new Set((t.sourceDocuments||[]).map(e=>String(e.id)));if(Array.from(a.values()).some(t=>{let a=(t.text||"").trim();if(a.length>Math.max(32,s.length+20))return!0;let n=new Set((t.sourceDocuments||[]).map(e=>String(e.id)));if(n.size>0&&e.size>0){let t=0;for(let a of e)n.has(a)&&t++;if(t>0&&a.length>=s.length)return!0;let r=!0;for(let t of e)if(!n.has(t)){r=!1;break}if(r&&a.length>=s.length)return!0}return!1})){eR("mergeMessages.skipPlaceholder",{incomingId:t.id,reason:"found richer/overlapping existing message"});continue}}if(n){eR("mergeMessages.skipPermanentPlaceholder",{incomingId:t.id,text:s});continue}if("me"===t.sender){for(let[e,n]of a.entries())if("me"===n.sender&&["sending","sent","delivered"].includes(n.status||"")&&(n.text||"").trim()===s){eR("mergeMessages.replaceOptimistic",{tempId:e,serverId:t.id}),a.delete(e);break}}a.set(t.id,t)}let s=Array.from(a.values()).map((e,t)=>{let a=e.time,s=t;if(a){let e=Date.parse(a);if(Number.isNaN(e)){let e=a.match(/^(\d{1,2}):(\d{2})$/);if(e){let a=new Date;a.setHours(Number(e[1])),a.setMinutes(Number(e[2])),a.setSeconds(0),a.setMilliseconds(t),s=a.getTime()}}else s=e}return{message:e,sortKey:s}});return s.sort((e,t)=>e.sortKey-t.sortKey),s.map(e=>e.message)},[]),eO=(0,n.useCallback)(()=>{setTimeout(()=>{y.current&&y.current.scrollIntoView({behavior:"smooth"})},350)},[y]),ez=async()=>{if(!ey)return;eE(!0);let e=ey;try{if("chats"===e.type){let a=e.id?[e.id]:[t];try{for(let e of a)await eg.deleteChat(String(k||"default"),e)}catch(e){console.error("Error deleting chats on server:",e),null==E||E.show("Could not delete chat(s). Please try again.","error");return}try{let e=(await el.Ay.loadChats()||[]).filter(e=>!a.includes(e.id));await el.Ay.saveChats(e);let t=a.map(e=>el.Ay.deleteChatMessages(e));await Promise.all(t),null==E||E.show("Chat deleted","success")}catch(e){console.error("Error cleaning up local chat storage:",e),null==E||E.show("Chat deleted on server but local cleanup failed","info")}try{window&&window.history&&window.history.length>1?window.history.back():window.location.href="/app/chats"}catch(e){}return}if("document"===e.type){let t=e.extra;if(!t)return;try{let e=String(k||"default");await eg.deleteDocument(e,t.id)}catch(e){console.warn("deleteDocument API failed",e)}try{let e=(await el.Ay.loadDocuments()||[]).filter(e=>e.id!==t.id);await el.Ay.saveDocuments(e);try{window.dispatchEvent(new CustomEvent("documents-updated",{detail:{projectId:k||"default",documents:e}}))}catch(e){}}catch(e){console.error("Error removing document from storage",e)}l(e=>e.map(e=>e.sourceDocuments&&Array.isArray(e.sourceDocuments)?{...e,sourceDocuments:e.sourceDocuments.filter(e=>e.id!==t.id)}:e)),c(e=>e.map(e=>e.sourceDocuments&&Array.isArray(e.sourceDocuments)?{...e,sourceDocuments:e.sourceDocuments.filter(e=>e.id!==t.id)}:e));try{ec()}catch(e){}eu(null),null==E||E.show("Document deleted","success");try{let e=String(k||"default"),t=await eg.listDocuments(e);if(Array.isArray(t)){let e=(t||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:k||"default",name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));try{await el.Ay.saveDocuments(e);try{window.dispatchEvent(new CustomEvent("documents-updated",{detail:{projectId:k||"default",documents:e}}))}catch(e){}}catch(e){console.warn("Could not save refreshed documents locally",e)}}}catch(e){}}}finally{eE(!1),ej(null);try{ep()}catch(e){}}},eW=()=>{eO()};(0,n.useEffect)(()=>{let e=()=>{let e=b.current;e&&$(e.scrollHeight-e.scrollTop-e.clientHeight>500)},t=b.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[]),(0,n.useEffect)(()=>{P(v.current)},[]),(0,n.useEffect)(()=>{!async function(){try{u(!0);let e=(await el.Ay.loadChats()).find(e=>e.id===t);e&&(I({name:e.name}),e.projectId&&S(e.projectId));let a=await el.Ay.getMessageCount(t);if(ee(a),0===a){let e=ek(t);await el.Ay.saveChatMessages(t,e),l(e),c(e),X(!1)}else{let s=(await el.Ay.loadChatMessagesPaginated(t,1,eN)).map(e=>({...e,time:e.time||new Date().toISOString()}));c(s),X(a>eN);let n=(await el.Ay.loadChatMessages(t)).map(e=>({...e,time:e.time||new Date().toISOString()}));l(n);try{let a=null,s=(null==e?void 0:e.projectId)||"default";try{a=await eg.getChatByProject(s,t),e_&&(console.debug("[loadChatData] chatFromApi:",a),eR("loadChatData.chatFromApi",a))}catch(e){throw console.warn("getChatByProject failed for",s,e),e}if(a&&(a.processing_state||a.messages)){let e=N,t=a.processing_state||"IDLE";if(C(t),"PENDING"===e&&"DONE"===t?null==E||E.show("Processing finished","success"):"PENDING"===e&&"ERROR"===t&&(null==E||E.show("Processing failed","error")),Array.isArray(a.messages)&&a.messages.length>0){let e=a.messages.map(e=>({id:e.id||String(Date.now()),text:e.message||e.text||"",sender:"assistant"===e.persona||"bot"===e.persona?"other":"me",time:e.created_at||new Date().toISOString(),status:"read",...Array.isArray(e.documents)&&e.documents.length>0?{sourceDocuments:e.documents}:{}}));e_&&(console.debug("[loadChatData] mapped messages from API:",e),eR("loadChatData.mapped",e)),l(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(a,e)}),c(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(a,e).slice(-eN)})}}}catch(e){console.warn("Could not fetch chat from API",e)}}}catch(a){console.error("Error loading chat data:",a);let e=ek(t);l(e),c(e),X(!1)}finally{u(!1),Y(!1)}}()},[t]),(0,n.useEffect)(()=>{if(!J&&!m&&o.length>0){var e;let t=o[o.length-1];t&&("me"===t.sender||(null==(e=i[i.length-1])?void 0:e.id)===t.id)&&eO()}},[o,J,m,i,eO]),(0,n.useEffect)(()=>{!d&&i.length>0&&el.Ay.saveChatMessages(t,i).catch(e=>{console.error("Error saving messages:",e)})},[i,d,t]);let eF=(0,n.useCallback)(async()=>{if(m||!K)return Promise.resolve(!1);try{h(!0);let e=V+1,a=b.current,s=(null==a?void 0:a.scrollHeight)||0,n=(null==a?void 0:a.scrollTop)||0,r=await el.Ay.loadChatMessagesPaginated(t,e,eN);if(!(r.length>0))return X(!1),Promise.resolve(!1);{c(e=>[...r,...e]),q(e);let t=e*eN;return X(Z>t),new Promise(e=>{setTimeout(()=>{if(a){let e=a.scrollHeight-s;a.scrollTop=n+e}e(!0)},10)})}}catch(e){return console.error("Error loading more messages:",e),Promise.resolve(!1)}finally{h(!1)}},[t,V,K,m,Z]);(0,n.useEffect)(()=>{let e=null,t=()=>{let t=b.current;t&&t.scrollTop<50&&K&&!m&&(e&&clearTimeout(e),e=setTimeout(()=>{eF().catch(e=>{console.error("Error in auto-load more:",e)})},200))},a=b.current;if(a)return a.addEventListener("scroll",t),()=>{a.removeEventListener("scroll",t),e&&clearTimeout(e)}},[K,m,eF]);let eG=()=>{eF().catch(e=>{console.error("Error loading more messages:",e)})};(0,n.useEffect)(()=>{let e=null,a=async()=>{w&&(e=setInterval(async()=>{try{let e=await (0,T.default)(w);if(!e)return;let a=null,s=k||"default";try{a=await eg.getChatByProject(s,t,e),e_&&(console.debug("[poll] chatFromApi:",a),eR("poll.chatFromApi",a))}catch(e){console.warn("Polling getChatByProject failed for",s,e);return}if(!a)return;let n=a.processing_state||"IDLE";if(C(n),Array.isArray(a.messages)&&a.messages.length>0){let e=a.messages.map(e=>({id:e.id||String(Date.now()),text:e.message||e.text||"",sender:"assistant"===e.persona||"bot"===e.persona?"other":"me",time:e.created_at||new Date().toISOString(),status:"read",...Array.isArray(e.documents)&&e.documents.length>0?{sourceDocuments:e.documents}:{}}));e_&&(console.debug("[poll] mapped messages:",e),eR("poll.mapped",e)),l(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(a,e)}),c(t=>{let a=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(a,e).slice(-eN)}),ee(t=>Math.max(t,e.length))}}catch(e){console.warn("Polling error",e)}},2e3))};return"PENDING"===N&&a().catch(e=>console.warn(e)),()=>{e&&clearInterval(e)}},[t,N,w]),(0,n.useCallback)(e=>{console.log("Creating automatic response message");let a={id:Date.now().toString(),text:e,sender:"other",time:new Date().toISOString(),status:"read"};console.log("Adding automatic response to messages:",a),l(e=>{let s=[...e,a];return c(e=>[...e,a]),ee(e=>e+1),el.Ay.saveChatMessages(t,s).then(()=>console.log("Automatic response saved to storage")).catch(e=>console.error("Error saving automatic response:",e)),s}),eX(e).then(()=>console.log("Chat list updated with automatic response")).catch(e=>console.error("Error updating chat list:",e))},[t]);let eH=async()=>{let e=(B||"").trim();if(e)try{let a=String(k||"default");try{await eg.renameChat(a,t,e)}catch(s){try{let s="https://dokuchat.api.datafortress.cloud",n="".concat(s,"/fullapi/").concat(encodeURIComponent(a),"/chats/").concat(encodeURIComponent(String(t)),"/rename"),r=await (0,T.default)(w);await fetch(n,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded",...r?{Authorization:"Bearer ".concat(r)}:{}},body:new URLSearchParams({new_name:e}).toString()})}catch(e){console.warn("Rename fallback failed",e)}}try{let a=(await el.Ay.loadChats()||[]).map(a=>a.id===t?{...a,name:e}:a);await el.Ay.saveChats(a)}catch(e){console.warn("Could not persist renamed chat locally",e)}I(t=>t?{...t,name:e}:{name:e});try{M()}catch(e){}null==E||E.show("Chat renamed","success")}catch(e){console.error("Rename chat failed",e),null==E||E.show("Could not rename chat","error")}},eV=e=>!!(e.sourceDocuments&&Array.isArray(e.sourceDocuments)&&e.sourceDocuments.length>0),eq=async()=>{if(a.trim()&&!p){g(!0);let n={id:Date.now().toString(),text:a.trim(),sender:"me",time:new Date().toISOString(),status:"sending"};r(""),e_&&(console.debug("[sendMessage] optimistic newMessage:",n),eR("sendMessage.optimistic",n)),l(e=>eB(e,[n])),c(e=>eB(e,[n]).slice(-eN));try{var e,s;let n=(null==(s=await el.Ay.loadChats())||null==(e=s.find(e=>e.id===t))?void 0:e.projectId)||"default";try{await eg.addMessage(n,t,a.trim())}catch(e){console.warn("api.addMessage failed, falling back to manual PUT",e);try{let e="https://dokuchat.api.datafortress.cloud",s="".concat(e,"/fullapi/").concat(encodeURIComponent(n),"/chats/").concat(encodeURIComponent(String(t)),"/message"),r=await (0,T.default)(w);await fetch(s,{method:"PUT",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{}},body:JSON.stringify({message:a.trim(),persona:"user"})})}catch(e){console.warn("Fallback add message failed",e)}}C("PENDING");try{let e=(await el.Ay.loadChats()||[]).map(e=>e.id===t?{...e,processingState:"PENDING"}:e);await el.Ay.saveChats(e)}catch(e){console.warn("Could not persist processing state",e)}await eX(a.trim())}catch(e){console.error("Send message failed",e),l(e=>e.map(e=>e.id===n.id?{...e,status:"failed"}:e)),c(e=>e.map(e=>e.id===n.id?{...e,status:"failed"}:e))}finally{g(!1)}}},eK=e=>{l(t=>t.map(t=>t.id===e?{...t,status:"sending"}:t)),c(t=>t.map(t=>t.id===e?{...t,status:"sending"}:t)),setTimeout(()=>{l(t=>t.map(t=>t.id===e?{...t,status:"sent"}:t)),c(t=>t.map(t=>t.id===e?{...t,status:"sent"}:t)),setTimeout(()=>{l(t=>t.map(t=>t.id===e?{...t,status:"delivered"}:t)),c(t=>t.map(t=>t.id===e?{...t,status:"delivered"}:t))},1e3)},1500)},eX=async e=>{try{let a=(await el.Ay.loadChats()||[]).map(a=>a.id===t?{...a,message:e,time:"Just now",isRead:!0}:a);await el.Ay.saveChats(a)}catch(e){console.error("Error updating chat last message:",e)}},eJ=(e,t)=>{W(e),G(t),setTimeout(()=>{j.current&&j.current.focus()},50)},eY=()=>{W(null),G("")},eQ=async()=>{if(!z||!F.trim())return;l(e=>e.map(e=>e.id===z?{...e,text:F.trim(),isEdited:!0}:e)),c(e=>e.map(e=>e.id===z?{...e,text:F.trim(),isEdited:!0}:e));let e=i[i.length-1];e&&e.id===z&&await eX(F.trim()+" (edited)"),W(null),G("")},e$=async e=>{l(t=>{let a=t.map(t=>t.id===e?{...t,isDeleted:!0,text:"This message was deleted"}:t),s=t[t.length-1];if(s&&s.id===e){let e=a.filter(e=>!e.isDeleted).pop();e?eX(e.text):eX("No messages")}return a}),c(t=>t.map(t=>t.id===e?{...t,isDeleted:!0,text:"This message was deleted"}:t))},eZ="PENDING"===N;return(0,s.jsx)(en,{pageRef:v,header:(0,s.jsx)("div",{className:"navbar bg-base-200 shadow-lg",children:(0,s.jsxs)("div",{className:"w-full grid grid-cols-[min-content_1fr_min-content] items-center gap-2 px-2",children:[(0,s.jsx)("div",{className:"col-start-1 col-end-2",children:(0,s.jsx)(R.QW,{children:(0,s.jsx)(R.el,{defaultHref:"/app/chats",text:"",className:"btn btn-ghost btn-circle btn-sm"})})}),(0,s.jsxs)("div",{className:"col-start-2 col-end-3 overflow-hidden text-center",children:[(0,s.jsx)("h1",{className:"text-lg font-semibold truncate w-full whitespace-nowrap",children:(0,s.jsx)("button",{onClick:()=>{O((null==_?void 0:_.name)||""),L()},className:"text-inherit text-left w-full truncate","aria-label":"Rename chat",children:(null==_?void 0:_.name)||"Loading..."})}),x&&(0,s.jsxs)("div",{className:"text-xs text-primary flex items-center gap-1 justify-center mt-0",children:[(0,s.jsx)("span",{className:"loading loading-dots loading-xs"}),"typing..."]})]}),(0,s.jsx)("div",{className:"col-start-3 col-end-4 justify-self-end",children:(0,s.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm hover:text-error",onClick:()=>{ej({type:"chats",id:t,name:null==_?void 0:_.name}),eh()},title:"Delete chat",children:(0,s.jsx)(ex.A,{size:18})})})]})}),children:(0,s.jsxs)("div",{className:"w-full flex flex-col flex-1 min-h-0 bg-base-100",children:[(0,s.jsx)("div",{ref:b,className:"flex-1 overflow-y-auto px-4 py-6 mb-auto relative min-h-0 pb-32",children:d?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-base-content/60 text-sm",children:"Loading messages..."})]}):0===o.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[(0,s.jsx)("div",{className:"text-5xl opacity-20",children:"\uD83D\uDCAC"}),(0,s.jsxs)("p",{className:"text-base-content/60 text-center",children:["No messages yet.",(0,s.jsx)("br",{}),"Start a conversation!"]})]}):(0,s.jsxs)(s.Fragment,{children:[K&&(0,s.jsx)("div",{className:"flex justify-center mb-6",children:m?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-primary",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-sm"}),(0,s.jsx)("span",{className:"text-sm",children:"Loading older messages..."})]}):(0,s.jsxs)("button",{onClick:eG,className:"btn btn-sm btn-ghost gap-2","aria-label":"Load earlier messages",children:[(0,s.jsx)(ef.A,{size:16}),"Load earlier messages"]})}),o.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)(eA,{message:e,chatId:t,onRetry:"failed"===e.status?()=>eK(e.id):void 0,onEdit:"me"===e.sender&&!e.isDeleted&&["sent","delivered","read"].includes(e.status||"")?()=>eJ(e.id,e.text):void 0,onDelete:"me"!==e.sender||e.isDeleted?void 0:()=>e$(e.id)},e.id),"other"===e.sender&&eV(e)&&(0,s.jsxs)("div",{className:"mb-4 ml-12",children:[(0,s.jsx)("div",{className:"divider divider-start text-xs opacity-60",children:"Source documents"}),(0,s.jsx)("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin",children:e.sourceDocuments.map(e=>(0,s.jsx)("div",{className:"w-36 flex-shrink-0 group",role:"button",tabIndex:0,"aria-label":"Open document ".concat(e.name),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),eu(e),eo())},onClick:()=>{eu(e),eo()},children:(0,s.jsxs)("div",{className:"card card-compact bg-base-200 shadow-md hover:shadow-lg transition-shadow overflow-hidden cursor-pointer border border-base-300",children:[(0,s.jsxs)("figure",{className:"relative h-24 bg-base-300",children:[e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl?(0,s.jsx)("img",{src:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,alt:e.filename||e.name,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-base-content/50 text-xs p-2 text-center",children:"\uD83D\uDCC4"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,s.jsx)("div",{className:"flex items-center justify-center rounded-full w-8 h-8 bg-primary text-white shadow-lg",children:(0,s.jsx)("span",{className:"text-sm",children:"\uD83D\uDD0D"})})})]}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("h3",{className:"card-title text-xs truncate",children:e.filename||e.name}),(0,s.jsx)("div",{className:"line-clamp-2 text-[11px] text-base-content/70",children:(0,s.jsx)(er.o,{children:String(e.content||e.summary||e.excerpt||e.previewText||"No preview available")})})]})]})},e.id))})]})]},e.id)),eZ&&(0,s.jsx)(eP,{}),Q&&(0,s.jsx)("button",{onClick:eW,className:"btn btn-circle btn-primary shadow-xl fixed bottom-28 right-4 z-10","aria-label":"Scroll to bottom",children:(0,s.jsx)(ew.A,{size:20})}),(0,s.jsx)("div",{ref:y})]})}),eU&&(0,s.jsxs)("div",{className:"mockup-code fixed bottom-32 right-4 z-50 max-w-xs max-h-80 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2 px-4 pt-2",children:[(0,s.jsx)("div",{className:"font-medium",children:"Debug Events"}),(0,s.jsxs)("div",{className:"text-xs opacity-60",children:[eD.current.length," items"]})]}),(0,s.jsx)("div",{className:"space-y-1 px-4 pb-2",children:eD.current.slice().reverse().map((e,t)=>(0,s.jsx)("div",{className:"whitespace-pre-wrap break-words",children:e},t))})]}),(0,s.jsx)(ei,{doc:ed,presentingElement:A,onClose:()=>{try{ec()}catch(e){}eu(null)},onDelete:e=>{ej({type:"document",extra:e}),eh()}}),(0,s.jsx)(es,{title:"Rename Chat",modalRef:D,presentingElement:A,left:(0,s.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{O("");try{M()}catch(e){}},children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"label",children:[(0,s.jsx)("span",{className:"label-text font-medium",children:"Chat Name"}),(0,s.jsx)("span",{className:"label-text-alt text-base-content/50",children:"Required"})]}),(0,s.jsx)("input",{value:B,onChange:e=>O(e.target.value),placeholder:"Chat name",className:"input input-bordered input-lg w-full",onKeyDown:e=>{"Enter"===e.key&&eH()},autoFocus:!0})]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{O("");try{M()}catch(e){}},children:"Cancel"}),(0,s.jsx)("button",{className:"btn btn-primary gap-2",onClick:()=>eH(),disabled:!B.trim(),children:"Rename"})]})]})}),(0,s.jsx)(es,{title:"Confirm Delete",modalRef:em,presentingElement:A,left:(0,s.jsx)("button",{onClick:()=>{ej(null),ep()},className:"btn btn-ghost btn-sm",children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"alert alert-warning mb-6",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold",children:"Warning!"}),(0,s.jsx)("div",{className:"text-sm",children:"This action cannot be undone."})]})]}),(0,s.jsxs)("p",{className:"text-base mb-6",children:["Are you sure you want to delete"," ",(0,s.jsx)("strong",{className:"text-error",children:(null==ey?void 0:ey.name)||"this item"}),"?"]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{ej(null),ep()},disabled:eC,children:"Cancel"}),(0,s.jsx)("button",{className:"btn btn-error gap-2",onClick:()=>ez(),disabled:eC,children:eC?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-sm"}),"Deleting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ex.A,{size:16}),"Confirm Delete"]})})]})]})}),(0,s.jsx)("div",{className:"fixed left-0 right-0 bottom-0 bg-base-200 border-t border-base-300 shadow-2xl z-40",children:(0,s.jsx)("div",{className:"p-3 max-w-4xl mx-auto",children:(0,s.jsxs)("div",{className:"join w-full items-center bg-base-100 rounded-box shadow-md border border-base-300",children:[z&&(0,s.jsx)("button",{onClick:eY,className:"btn btn-ghost btn-circle btn-sm join-item ml-2","aria-label":"Cancel edit",children:(0,s.jsx)(ev.A,{size:18})}),(0,s.jsx)("label",{className:"input input-ghost flex-1 join-item border-0",children:(0,s.jsx)("input",{ref:j,type:"text",value:z?F:a,onChange:e=>z?G(e.target.value):r(e.target.value),placeholder:z?"Edit message...":"Type a question...",className:"grow",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&z&&eY():(e.preventDefault(),z?eQ():!p&&a.trim()&&eq())},disabled:p&&!z})}),(0,s.jsx)("div",{className:"join-item pr-2",children:z?F.trim()?(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:eQ,className:"btn btn-primary btn-circle btn-sm","aria-label":"Save edit",children:(0,s.jsx)(eb.A,{size:18})})}):(0,s.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm",disabled:!0,children:(0,s.jsx)(eb.A,{size:18})}):!p&&a.trim()?(0,s.jsx)("div",{children:(0,s.jsx)("button",{onClick:eq,className:"btn btn-primary btn-circle btn-sm","aria-label":"Send message",children:(0,s.jsx)(eb.A,{size:18})})}):(0,s.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm",disabled:!0,children:(0,s.jsx)(eb.A,{size:18})})})]})})})]})})}function eA(e){let{message:t,chatId:a,onRetry:r,onEdit:i,onDelete:l}=e,o="me"===t.sender,[c,d]=(0,n.useState)(!1);return(0,s.jsx)("div",{className:"flex ".concat(o?"justify-end":"justify-start"," mb-4 relative group px-2"),children:(0,s.jsx)("div",{className:"chat ".concat(o?"chat-end":"chat-start"," w-[80vw] max-w-[80vw]"),children:(0,s.jsxs)("div",{className:"chat-bubble ".concat(o?"chat-bubble-primary shadow-md":"bg-base-200 text-base-content shadow-md"," ").concat(t.isDeleted?"opacity-60 italic":""),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onTouchStart:()=>d(!0),onTouchEnd:()=>setTimeout(()=>d(!1),3e3),children:[t.isDeleted?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("span",{className:"opacity-50",children:"\uD83D\uDDD1️"}),t.text]}):(0,s.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,s.jsx)(er.o,{children:t.text||""})}),(0,s.jsxs)("div",{className:"text-xs opacity-60 mt-2 flex items-center gap-1.5 ".concat(o?"justify-end":"justify-start"),children:[(0,s.jsx)("span",{children:eC(t.time)}),o&&!t.isDeleted&&(0,s.jsxs)(s.Fragment,{children:["sending"===t.status&&(0,s.jsx)("span",{className:"loading loading-spinner loading-xs"}),"sent"===t.status&&(0,s.jsx)(ey.A,{size:12,className:"opacity-50"}),"delivered"===t.status&&(0,s.jsxs)("div",{className:"flex -space-x-1",children:[(0,s.jsx)(ey.A,{size:12,className:"text-info"}),(0,s.jsx)(ey.A,{size:12,className:"text-info"})]}),"read"===t.status&&(0,s.jsxs)("div",{className:"flex -space-x-1",children:[(0,s.jsx)(ey.A,{size:12,className:"text-success"}),(0,s.jsx)(ey.A,{size:12,className:"text-success"})]}),"failed"===t.status&&(0,s.jsx)("button",{onClick:r,className:"badge badge-error badge-xs gap-1",children:"Failed • Retry"})]}),t.isEdited&&!t.isDeleted&&(0,s.jsx)("span",{className:"badge badge-ghost badge-xs",children:"edited"})]}),o&&c&&!t.isDeleted&&(0,s.jsxs)("div",{className:"absolute -top-2 right-0 join join-horizontal shadow-lg",children:[i&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"btn btn-xs join-item tooltip tooltip-top","data-tip":"Edit",children:(0,s.jsx)(ej.A,{size:12})}),l&&(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),l()},className:"btn btn-xs join-item btn-error tooltip tooltip-top","data-tip":"Delete",children:(0,s.jsx)(ex.A,{size:12})})]}),!o&&!t.isDeleted&&(0,s.jsx)("div",{className:"mt-2 text-left",children:(0,s.jsx)("a",{className:"link link-primary link-hover text-xs opacity-70",href:"mailto:info@document-chat.com?subject=".concat(encodeURIComponent("Report AI generated content"),"&body=").concat(encodeURIComponent("I want to report an AI-generated message in chat ".concat(a||"",".\n\nMessage ID: ").concat(t.id,"\n\nMessage text:\n").concat(t.text,"\n\nPlease investigate."))),onClick:e=>{},children:"Report AI generated content"})})]})})})}function eP(){return(0,s.jsx)("div",{className:"flex justify-start mb-4 px-2",children:(0,s.jsx)("div",{className:"chat chat-start w-[80vw] max-w-[80vw]",children:(0,s.jsx)("div",{className:"chat-bubble bg-base-200 text-base-content shadow-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"loading loading-dots loading-sm"}),(0,s.jsx)("span",{className:"text-xs opacity-60",children:"Assistant is typing"})]})})})})}var e_=a(109);function eI(){let{value:e,onChange:t,placeholder:a="Search"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[r,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(e||"");(0,n.useEffect)(()=>{void 0!==e&&o(e)},[e]);let c=e=>{let a=e.target.value;o(a),t&&t(a)};return(0,n.useEffect)(()=>{let e=e=>{r&&e.target&&"closest"in e.target&&!e.target.closest("#search-input")&&i(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[r]),(0,s.jsxs)("label",{id:"search-input",className:"flex rounded-lg bg-base-200 dark:bg-base-300 py-2 px-4 items-center gap-2",children:[(0,s.jsx)("div",{children:(0,s.jsx)(e_.A,{size:18,className:"text-base-content/60"})}),(0,s.jsx)("input",{value:l,onChange:c,onClick:()=>i(!0),className:"appearance-none placeholder:text-gray-400 text-lg bg-transparent outline-none",placeholder:a})]})}var eD=a(6140);function eT(e){let{name:t,progress:a,subtitle:n,onCancel:r,onRetry:i,failed:l}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-3 bg-base-200 p-3 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:t}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[a,"%"]})]}),n?(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:n}):null,(0,s.jsx)("div",{className:"w-full bg-base-300 rounded-full h-2 mt-2 overflow-hidden",children:(0,s.jsx)("div",{className:"h-2 bg-blue-500",style:{width:"".concat(a,"%")}})})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:l?(0,s.jsx)("button",{onClick:i,className:"btn btn-ghost btn-xs",children:(0,s.jsx)(eD.A,{size:16})}):(0,s.jsx)("button",{onClick:r,className:"btn btn-ghost btn-xs",children:(0,s.jsx)(ev.A,{size:16})})})]})}var eL=a(9045);function eU(){var e;let t=(0,n.useRef)(null),[a,r]=(0,n.useState)(null),{modalRef:o,open:c,close:d}=ea(),{modalRef:u,open:m,close:h}=ea(),{modalRef:p,open:g,close:x}=ea();(0,n.useRef)(void 0);let[f,w]=(0,n.useState)(null),[v,b]=(0,n.useState)(!1),[y,j]=(0,n.useState)(null),[N,C]=(0,n.useState)(""),k=(0,R.jq)(),[S,E]=(0,n.useState)([]),[A,P]=(0,n.useState)([]),[_,I]=(0,n.useState)(null),[D,L]=(0,n.useState)([]),{session:M}=U(),[B,O]=(0,n.useState)({}),[z,W]=(0,n.useState)({}),[F,G]=(0,n.useState)({}),[V,q]=(0,n.useState)({}),[K,X]=(0,n.useState)([]),J=H(),[Y,Q]=(0,n.useState)(!0),[$,Z]=(0,n.useState)(!1),[ee,et]=(0,n.useState)(new Set),[eo,ec]=(0,n.useState)("");(0,n.useEffect)(()=>{!async function(){Q(!0);try{var e,t;let a=await el.Ay.loadChats(),s=await el.Ay.loadProjects(),n=await el.Ay.loadDocuments(),r=null;try{let e=await eg.listProjects();if(Array.isArray(e)&&e.length>0){let t=e.map(e=>"string"==typeof e?{id:e,name:e,createdAt:new Date().toISOString()}:{id:e.id||e.name||String(e.name),name:e.name||e.id||String(e.name),createdAt:e.created_at||new Date().toISOString()});r=t,P(t)}}catch(e){console.warn("Could not load projects from backend",e)}let i=r||(s&&s.length>0?s:[{id:"default",name:"default",createdAt:new Date().toISOString()}]);r||P(i);let l=i&&i.find(e=>"default"===e.id)||i&&i[0]||{id:"default",name:"default",createdAt:new Date().toISOString()};I(l);try{let t=String(null!=(e=l.name)?e:l.id),a=await eg.listDocuments(t);if(a&&a.length>0){let e=(a||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:l.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(e)}else L(n||[])}catch(e){console.warn("listDocuments failed",e),null==J||J.show("Could not load documents from backend. Using cached documents. (".concat(String((null==e?void 0:e.message)||e),")"),"error"),L(n||[])}try{let e=String(null!=(t=l.name)?t:l.id),s=await eg.listChats(e);if(Array.isArray(s)){let e=(s||[]).map(e=>{var t,a;return{id:String(e.id||e.chat_id||Date.now()),name:e.name||"Chat ".concat(e.id||""),message:(null==(t=e.last_message)?void 0:t.message)||e.lastMessage||"No messages yet",time:(null==(a=e.last_message)?void 0:a.created_at)||e.time||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime}});E(e)}else E((a||[]).map(e=>({id:e.id,name:e.name||"Chat",message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime})))}catch(e){console.warn("Could not load chats from backend",e),E((a||[]).map(e=>({id:e.id,name:e.name||"Chat",message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime})))}}catch(e){console.error("Error loading chats:",e),E([])}finally{Q(!1)}}()},[]),(0,n.useEffect)(()=>{if(!_)return;let e=!0;return(async()=>{try{var t,a;let s=await eg.listDocuments(String(null!=(t=null==_?void 0:_.name)?t:null==_?void 0:_.id));if(e&&Array.isArray(s)&&s.length>0){let e=(s||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:_.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(e.concat(D.filter(e=>e.projectId!==_.id)))}let n=await eg.listChats(String(null!=(a=null==_?void 0:_.name)?a:null==_?void 0:_.id));if(e&&Array.isArray(n)){let e=(n||[]).map(e=>{var t,a;return{id:String(e.id||e.chat_id||Date.now()),name:e.name||"Chat ".concat(e.id||""),message:(null==(t=e.last_message)?void 0:t.message)||e.lastMessage||"No messages yet",time:(null==(a=e.last_message)?void 0:a.created_at)||e.time||"Just now"}});E(e)}}catch(e){console.warn("Error refreshing project data",e)}})(),()=>{e=!1}},[_]),(0,n.useEffect)(()=>{if(!M)return void eg.clearTokenProvider();try{eg.setTokenProvider(async()=>await (0,T.default)(M))}catch(e){console.warn("Failed to set token provider",e)}return()=>{try{eg.clearTokenProvider()}catch(e){}}},[M]),(0,n.useEffect)(()=>{Y||(el.Ay.saveProjects(A).catch(e=>console.error("Error saving projects:",e)),el.Ay.saveDocuments(D).catch(e=>console.error("Error saving documents:",e)))},[A,D,Y]),(0,n.useEffect)(()=>{!Y&&S.length>0&&el.Ay.saveChats(S).catch(e=>{console.error("Error saving chats:",e)})},[S,Y]);let ed=N?S.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())):S;(0,n.useEffect)(()=>{r(t.current)},[]),(0,n.useEffect)(()=>{let e=e=>{try{var t;let a=e.detail;if(!a)return;a.projectId===(null!=(t=null==_?void 0:_.id)?t:"default")&&L(a.documents||[])}catch(e){console.warn("documents-updated handler error",e)}};return window.addEventListener("documents-updated",e),()=>window.removeEventListener("documents-updated",e)},[_]);let eu=e=>{et(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})};(0,n.useEffect)(()=>{if(0===K.length)return;let e=[...K],t=setTimeout(()=>{X(t=>t.filter(t=>!e.includes(t))),null==J||J.show("".concat(e.length," file(s) uploaded"),"success")},2e3);return()=>clearTimeout(t)},[K]);let em=async()=>{if(!f)return;b(!0);let e=f;try{var t,a,s,n;if("chats"===e.type){let a=e.id?[e.id]:Array.from(ee);try{for(let e of a)await eg.deleteChat(String(null!=(t=_.name)?t:_.id),e)}catch(e){console.error("Error deleting chats on server:",e),null==J||J.show("Could not delete chats. Please try again.","error");return}let s=new Set(a),n=S.filter(e=>!s.has(e.id));E(n),et(new Set),Z(!1);try{let e=a.map(e=>el.Ay.deleteChatMessages(e));await Promise.all(e),await el.Ay.saveChats(n),null==J||J.show("Chats deleted","success")}catch(e){console.error("Error cleaning up local chat storage:",e),null==J||J.show("Chats deleted on server but local cleanup failed","info")}}else if("project"===e.type){if(!e.id)return;try{let t=A.find(t=>t.id===e.id),s=String(null!=(a=null==t?void 0:t.name)?a:e.id);await eg.deleteProjectApi(s)}catch(e){console.error("Error deleting project on server:",e),null==J||J.show("Could not delete project. Please try again.","error");return}ef(e.id),null==J||J.show("Project deleted","success")}else if("document"===e.type){let t=e.extra;if(!t)return;if(!_){null==J||J.show("No project selected","error");return}try{await eg.deleteDocument(String(null!=(s=_.name)?s:_.id),t.id),L(e=>e.filter(e=>e.id!==t.id)),null==J||J.show("Document deleted","success");try{h()}catch(e){}j(null);try{let e=(await eg.listDocuments(String(null!=(n=null==_?void 0:_.name)?n:null==_?void 0:_.id))||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:_.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(e.concat(D.filter(e=>e.projectId!==_.id)))}catch(e){}}catch(e){console.error("Delete document failed",e),null==J||J.show("Could not delete document. Please try again.","error")}}}finally{b(!1),w(null),x()}},eh=e=>{if($)return void eu(e);E(t=>t.map(t=>t.id===e?{...t,isRead:!0,unreadCount:0}:t)),k.push("/app/chats/".concat(e),"forward")},ep=async()=>{d();let e="1";if(S.length>0){let t=Math.max(...S.map(e=>{let t=parseInt(e.id);return isNaN(t)?0:t}));e=(isFinite(t)?t+1:1).toString()}let t={id:e,name:"New Chat ".concat(e),message:"Hey there!",time:"Just now",isRead:!0,lastMessage:"Hey there!",lastMessageTime:"Just now"},a={id:t.id,name:t.name,message:t.message,time:t.time,isRead:t.isRead,lastMessage:t.lastMessage,lastMessageTime:t.lastMessageTime,projectId:(null==_?void 0:_.id)||"default"};E([t,...S]);try{let c=await el.Ay.loadChats()||[];await el.Ay.saveChats([a,...c]);let d={id:"1",text:"Hey there! This is a new conversation, but I know everything about the documents you uploaded in this project space, so shoot me some questions :)!",sender:"other",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"delivered"};await el.Ay.saveChatMessages(e,[d]);try{var s,n,r,i,l,o;let a=String(null!=(n=null==_?void 0:_.name)?n:null==_?void 0:_.id),c="".concat(t.name||"new chat"," ").concat(new Date().toISOString()),d=await eg.createChatByName(a,c),u=String(null!=(o=null!=(l=null!=(i=null!=(r=null==d?void 0:d.id)?r:null==d?void 0:d.chat_id)?i:null==d||null==(s=d.chat)?void 0:s.id)?l:null==d?void 0:d.chatId)?o:"");if(u){E(t=>t.map(t=>t.id===e?{...t,id:u}:t));try{let t=await el.Ay.loadChatMessages(e)||[];t.length>0&&(await el.Ay.saveChatMessages(u,t),await el.Ay.deleteChatMessages(e));let a=(await el.Ay.loadChats()||[]).map(t=>String(t.id)===String(e)?{...t,id:u}:t);await el.Ay.saveChats(a)}catch(e){console.warn("Failed to migrate local chat messages to server id",e)}try{k.push("/app/chats/".concat(u),"forward")}catch(e){console.warn("Navigation to new chat failed",e)}}else k.push("/app/chats/".concat(e),"forward")}catch(t){console.warn("createChat API failed, falling back to local chat:",t);try{k.push("/app/chats/".concat(e),"forward")}catch(e){console.warn("Navigation to new chat failed",e)}}}catch(e){console.error("Error creating new chat:",e)}},ex=async e=>{try{let t=await eg.createProject(e),a=String((null==t?void 0:t.id)||(null==t?void 0:t.name)||Date.now()),s=(null==t?void 0:t.created_at)||(null==t?void 0:t.createdAt)||new Date().toISOString(),n={id:a,name:(null==t?void 0:t.name)||e,createdAt:s};return P(e=>[n,...e]),I(n),null==J||J.show("Project created successfully","success"),n}catch(a){console.warn("createProject backend failed, falling back to local",a);let t={id:Date.now().toString(),name:e,createdAt:new Date().toISOString()};return P(e=>[t,...e]),I(t),null==J||J.show("Project created locally (offline)","info"),t}},ef=async e=>{"default"!==e&&P(t=>{let a=t.filter(t=>t.id!==e);return I(a[0]||{id:"default",name:"default",createdAt:new Date().toISOString()}),a})},ew=async e=>{if(!e||0===e.length||!_)return;let t=Array.from(e);for(let e of(q(e=>{let a={...e};for(let e of t)a[e.name]=e;return a}),t))ev(e).catch(e=>console.error("startUpload failed",e))},ev=async e=>{if(!_)return;if(!M){null==J||J.show("Please sign in again to upload documents.","error");return}let t=e.name;try{var a,s;let n=await (0,T.default)(M);if(!n){null==J||J.show("Session expired. Please sign in again.","error");return}O(e=>({...e,[t]:0})),G(e=>({...e,[t]:!1})),await eg.uploadDocuments(String(null!=(a=null==_?void 0:_.name)?a:null==_?void 0:_.id),[e],!1,n);let r=(await eg.listDocuments(String(null!=(s=null==_?void 0:_.name)?s:null==_?void 0:_.id))||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:_.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(r.concat(D.filter(e=>e.projectId!==_.id))),X(e=>[...e,t]),q(e=>{let a={...e};return delete a[t],a})}catch(a){console.error("Upload error:",a),G(e=>({...e,[t]:!0}));let e=String((null==a?void 0:a.message)||a);e.includes("413")||e.toLowerCase().includes("content too large")?null==J||J.show("Upload failed: file too large (server rejected with 413)","error"):e.includes("Failed to fetch")||e.toLowerCase().includes("network")?null==J||J.show("Upload failed: network or CORS error. Check server CORS settings and try again.","error"):null==J||J.show("Upload failed: ".concat(e),"error")}finally{O(e=>{let a={...e};return delete a[t],a}),W(e=>{let a={...e};return delete a[t],a})}};return(0,s.jsx)(en,{pageRef:t,toolbarClassName:"bg-base-100",header:(0,s.jsx)(R.BC,{size:"large",children:(0,s.jsx)("div",{className:"w-full flex justify-center items-center",children:(0,s.jsx)("img",{src:"/logo.png",alt:"Logo",className:"h-12 sm:h-14 md:h-16 w-auto",style:{display:"block"}})})}),children:(0,s.jsxs)("div",{className:"flex flex-col pb-36 gap-6 pt-4 px-4 max-w-6xl mx-auto w-full",children:[(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/5 to-secondary/5 border border-primary/10",children:(0,s.jsxs)("div",{className:"card-body p-4",children:[(0,s.jsx)("div",{className:"flex items-start gap-3 mb-3",children:(0,s.jsxs)("div",{className:"badge badge-primary gap-1",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Quicksearch"]})}),(0,s.jsx)("p",{className:"text-sm text-base-content/70 mb-3",children:"Search all documents in this project instantly. Perfect for finding keywords or specific snippets."}),(0,s.jsx)("form",{onSubmit:async e=>{e.preventDefault(),N.trim()&&_&&k.push("/app/quicksearch?projectName=".concat(encodeURIComponent(_.name),"&query=").concat(encodeURIComponent(N)),"forward")},children:(0,s.jsx)(eI,{value:N,onChange:C,placeholder:"Search documents..."})})]})}),Y?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"card bg-base-200 shadow-lg",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsx)("div",{className:"skeleton h-6 w-40 mb-4"}),(0,s.jsx)("div",{className:"skeleton h-12 w-full mb-3"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("div",{className:"skeleton h-10 w-full"}),(0,s.jsx)("div",{className:"skeleton h-10 w-full"})]})]})}),(0,s.jsx)("div",{className:"card bg-base-200 shadow-lg",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsx)("div",{className:"skeleton h-6 w-32 mb-4"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,s.jsx)("div",{className:"skeleton h-10 w-36"}),(0,s.jsx)("div",{className:"skeleton h-8 w-20"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:6}).map((e,t)=>(0,s.jsxs)("div",{className:"card bg-base-300 shadow",children:[(0,s.jsx)("div",{className:"skeleton h-40 w-full"}),(0,s.jsxs)("div",{className:"card-body p-3",children:[(0,s.jsx)("div",{className:"skeleton h-4 w-full mb-2"}),(0,s.jsx)("div",{className:"skeleton h-3 w-3/4"})]})]},t))})]})}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-base-content/60",children:"Loading chats..."})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"card bg-base-200 shadow-lg border border-base-300",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsxs)("h2",{className:"card-title text-base mb-4 flex items-center gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Current Project"]}),(0,s.jsx)("select",{value:null!=(e=null==_?void 0:_.id)?e:"",onChange:e=>{let t=A.find(t=>t.id===e.target.value);I(t||null),el.Ay.loadChats().then(e=>{E((e||[]).filter(e=>(e.projectId||"default")===((null==t?void 0:t.id)||"default")).map(e=>({...e,message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now"})))})},className:"select select-bordered select-lg w-full mb-4 font-medium",children:0===A.length?(0,s.jsx)("option",{value:"",children:"No projects available"}):A.map(e=>(0,s.jsxs)("option",{value:e.id,children:["\uD83D\uDCC1 ",e.name]},e.id))}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>{c()},children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Project"]}),(0,s.jsxs)("button",{className:"btn btn-outline btn-error gap-2",onClick:()=>{_&&(w({type:"project",id:_.id,name:_.name}),g())},disabled:!_||"default"===_.id,children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]})}),(0,s.jsx)("div",{className:"card bg-base-200 shadow-lg border border-base-300",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h2",{className:"card-title text-base flex items-center gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Documents"]}),(0,s.jsxs)("div",{className:"badge badge-primary badge-lg gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),D.filter(e=>e.projectId===(null==_?void 0:_.id)).length," ","files"]})]}),(0,s.jsxs)("label",{className:"btn btn-primary btn-lg w-full gap-2 mb-4",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload Files",(0,s.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>ew(e.target.files)})]}),Object.keys({...B,...F}).filter(e=>void 0!==B[e]||F[e]).length>0&&(0,s.jsx)("div",{className:"divider text-xs opacity-60",children:"Active Uploads"}),(0,s.jsx)("div",{className:"flex flex-col gap-2 mb-4",children:Object.keys({...B,...F}).filter(e=>void 0!==B[e]||F[e]).map(e=>{var t;let a=V[e],n=a?a.size:void 0,r=n?n<1024?"".concat(n," B"):n<1048576?"".concat((n/1024).toFixed(1)," KB"):"".concat((n/1048576).toFixed(1)," MB"):void 0;return(0,s.jsx)(eT,{name:e,subtitle:r,progress:null!=(t=B[e])?t:(F[e],0),failed:!!F[e],onCancel:()=>{let t=z[e];t&&t.abort&&t.abort(),G(t=>({...t,[e]:!0}))},onRetry:()=>{let t=V[e];t&&ev(t)}},e)})}),0===D.filter(e=>e.projectId===(null==_?void 0:_.id)).length?(0,s.jsxs)("div",{className:"alert alert-info",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("span",{children:"No documents yet. Upload files to get started!"})]}):(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:(0,s.jsx)(l.N,{children:D.filter(e=>e.projectId===(null==_?void 0:_.id)).map(e=>(0,s.jsx)(i.P.div,{layout:!0,initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96,transition:{duration:.18}},whileHover:{scale:1.02},whileTap:{scale:.99},transition:{type:"spring",stiffness:300,damping:24},className:"",children:(0,s.jsxs)("div",{className:"card card-compact bg-base-100 shadow-md hover:shadow-xl border border-base-300 transition-all cursor-pointer group overflow-hidden",onClick:()=>{j(e),m()},children:[(0,s.jsxs)("figure",{className:"relative h-36 bg-base-300 overflow-hidden",children:[e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl?(0,s.jsx)("img",{src:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-base-200 to-base-300",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,s.jsxs)("div",{className:"absolute top-2 right-2 badge badge-primary badge-sm gap-1",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]}),(0,s.jsxs)("div",{className:"card-body p-3",children:[(0,s.jsx)("h3",{className:"card-title text-sm truncate",title:e.filename||e.name,children:e.filename||e.name}),(0,s.jsx)("p",{className:"text-xs text-base-content/70 line-clamp-2",children:(0,s.jsx)(er.o,{children:String(e.content||e.summary||e.excerpt||"No preview available")})})]})]})},e.id))})})]})}),(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 to-secondary/10 border-2 border-dashed border-primary/30 hover:border-primary/50 transition-colors",children:(0,s.jsxs)("div",{className:"card-body p-6 items-center text-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-primary mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,s.jsx)("h3",{className:"card-title text-lg mb-2",children:"Start a New Conversation"}),(0,s.jsx)("p",{className:"text-sm text-base-content/60 mb-4",children:"Chat with AI about your documents"}),(0,s.jsxs)("button",{className:"btn btn-primary btn-lg gap-2",onClick:()=>ep(),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Chat"]})]})}),(0,s.jsx)(eM,{chats:ed,onChatClick:eh,isEditing:$,selectedChats:ee,onDelete:(e,t)=>{w({type:"chats",id:e,name:t||""}),g()}})]}),(0,s.jsx)(es,{title:"Create New Project",modalRef:o,presentingElement:a,left:(0,s.jsx)(R.Jm,{fill:"clear",onClick:()=>{ec(""),d()},children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("label",{className:"label",children:[(0,s.jsx)("span",{className:"label-text font-medium",children:"Project Name"}),(0,s.jsx)("span",{className:"label-text-alt text-base-content/50",children:"Required"})]}),(0,s.jsx)("input",{value:eo,onChange:e=>ec(e.target.value),placeholder:"My Awesome Project",className:"input input-bordered input-lg w-full",onKeyDown:e=>{"Enter"===e.key&&eo.trim()&&(ex(eo.trim()),ec(""),d())},autoFocus:!0}),(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text-alt text-base-content/60",children:"Choose a descriptive name for your project"})})]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{ec(""),d()},children:"Cancel"}),(0,s.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>{ex(eo.trim()||"New Project"),ec(""),d()},disabled:!eo.trim(),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Create Project"]})]})]})}),(0,s.jsx)(ei,{doc:y,presentingElement:a,onClose:()=>{try{h()}catch(e){}j(null)},onDelete:e=>{w({type:"document",extra:e}),g()}}),(0,s.jsx)(es,{title:"Confirm Delete",modalRef:p,presentingElement:a,left:(0,s.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{w(null),x()},children:"Cancel"}),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"alert alert-warning mb-6",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold",children:"Warning!"}),(0,s.jsx)("div",{className:"text-sm",children:"This action cannot be undone."})]})]}),(0,s.jsxs)("p",{className:"text-base mb-6",children:["Are you sure you want to delete"," ",(0,s.jsx)("strong",{className:"text-error",children:(null==f?void 0:f.name)||"this item"}),"?"]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>{w(null),x()},disabled:v,children:"Cancel"}),(0,s.jsx)("button",{className:"btn btn-error gap-2",onClick:()=>em(),disabled:v,children:v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-sm"}),"Deleting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Confirm Delete"]})})]})]})})]})})}function eM(e){let{chats:t,onChatClick:a,isEditing:n,selectedChats:r,onDelete:i}=e;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"divider text-sm font-semibold",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Your Conversations"]}),0===t.length?(0,s.jsx)("div",{className:"card bg-base-200 border-2 border-dashed border-base-300",children:(0,s.jsxs)("div",{className:"card-body items-center text-center py-12",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/30 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No conversations yet"}),(0,s.jsx)("p",{className:"text-sm text-base-content/60",children:"Start a new conversation to chat with AI about your documents"})]})}):(0,s.jsx)("div",{className:"flex flex-col gap-3",children:t.map((e,t)=>(0,s.jsx)(eR,{chat:e,onClick:()=>a(e.id),isEditing:n,selectedChats:r,onDelete:i},e.id))})]})}function eR(e){var t,a;let{chat:n,onClick:r,isEditing:l,selectedChats:o,onDelete:c}=e,d=o.has(n.id);return(0,s.jsx)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.01},whileTap:{scale:.99},className:"card bg-base-100 shadow-md hover:shadow-xl border transition-all cursor-pointer ".concat(d?"border-primary ring-2 ring-primary/20":"border-base-300 hover:border-primary/50"),onClick:()=>r(),children:(0,s.jsx)("div",{className:"card-body p-4",children:(0,s.jsxs)("div",{className:"grid items-center gap-4 w-full grid-cols-[min-content_1fr_min-content]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 col-start-1",children:[l&&(0,s.jsx)("input",{type:"checkbox",className:"checkbox checkbox-primary checkbox-lg",checked:d,onChange:()=>{},onClick:e=>e.stopPropagation()}),(0,s.jsx)("div",{className:"avatar",children:(0,s.jsx)("div",{className:"w-12 h-12 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 flex items-center justify-center overflow-hidden",children:n.image?(0,s.jsx)("img",{src:n.image,alt:n.name,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-primary-content font-bold text-lg",children:(null==(a=n.name)||null==(t=a[0])?void 0:t.toUpperCase())||"C"})})})})]}),(0,s.jsxs)("div",{className:"col-start-2 col-end-3 flex-1 min-w-0 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-base truncate whitespace-nowrap",children:n.name}),"PENDING"===n.processingState&&(0,s.jsx)("div",{className:"tooltip tooltip-right","data-tip":"AI is processing",children:(0,s.jsx)("span",{className:"loading loading-ring loading-sm text-warning"})})]}),(0,s.jsx)("p",{className:"text-sm text-base-content/60 line-clamp-2 break-words",children:(0,s.jsx)(er.o,{children:n.message||"No messages yet"})})]}),!l&&(0,s.jsxs)("div",{className:"flex-shrink-0 flex flex-col items-end gap-2 min-w-[84px] justify-self-end z-10",children:[(0,s.jsx)("span",{className:"text-xs text-base-content/50 whitespace-nowrap",children:n.time}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[n.unreadCount?(0,s.jsxs)("div",{className:"badge badge-primary badge-sm gap-1",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),n.unreadCount]}):n.isRead?(0,s.jsx)("div",{className:"tooltip tooltip-left","data-tip":"Read",children:(0,s.jsx)(eB,{})}):null,(0,s.jsxs)("div",{className:"dropdown dropdown-end",children:[(0,s.jsx)("button",{tabIndex:0,className:"btn btn-ghost btn-circle btn-sm",onClick:e=>e.stopPropagation(),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),(0,s.jsx)("ul",{tabIndex:0,className:"dropdown-content z-[1] menu p-2 shadow-lg bg-base-200 rounded-box w-52",children:(0,s.jsx)("li",{children:(0,s.jsxs)("button",{onClick:e=>{e.stopPropagation(),c&&c(n.id,n.name)},className:"text-error gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Chat"]})})})]})]})]})]})})})}function eB(){return(0,s.jsx)(eL.A,{size:18,className:"text-blue-500"})}function eO(){let[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!0),o=(0,R.jq)(),c=(0,O.zy)(),[d,u]=(0,n.useState)(null),m=new URLSearchParams(c.search),h=m.get("projectName")||"",p=m.get("query")||"";function g(e,t){return{id:e.id||"".concat(e.filename||"result","-").concat(t),projectId:h||"default",name:e.filename||e.name||"Result ".concat(t+1),mimeType:void 0,url:void 0,previewUrl:void 0,size:void 0,uploadedAt:e.timestamp||"",content:e.content||e.fullcontent||"",fullcontent:e.fullcontent||e.content||"",score:e.score}}return(0,n.useEffect)(()=>{async function e(){r(!0);try{let e=await eg.quicksearchDocuments(h,p);t(e||[])}catch(e){t([])}finally{r(!1)}}h&&p&&e()},[h,p]),(0,s.jsx)(en,{children:(0,s.jsxs)("div",{className:"py-6 px-4 max-w-6xl mx-auto w-full",children:[(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 to-secondary/10 border border-primary/20 mb-6",children:(0,s.jsxs)("div",{className:"card-body p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-base-content",children:"Search Results"}),(0,s.jsxs)("p",{className:"text-sm text-base-content/60",children:["Searching for:"," ",(0,s.jsxs)("span",{className:"font-semibold text-primary",children:['"',p,'"']})]})]})]}),!a&&e.length>0&&(0,s.jsxs)("div",{className:"badge badge-primary badge-lg gap-2 mt-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.length," ",1===e.length?"result":"results"," ","found"]})]})}),a?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-base-content/60",children:"Searching documents..."}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 w-full mt-8",children:Array.from({length:6}).map((e,t)=>(0,s.jsxs)("div",{className:"card bg-base-200 shadow",children:[(0,s.jsx)("div",{className:"skeleton h-48 w-full"}),(0,s.jsxs)("div",{className:"card-body p-3",children:[(0,s.jsx)("div",{className:"skeleton h-4 w-full mb-2"}),(0,s.jsx)("div",{className:"skeleton h-3 w-3/4"})]})]},t))})]}):0===e.length?(0,s.jsx)("div",{className:"card bg-base-200 border-2 border-dashed border-base-300",children:(0,s.jsxs)("div",{className:"card-body items-center text-center py-20",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-20 w-20 text-base-content/30 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No Results Found"}),(0,s.jsxs)("p",{className:"text-base-content/60 mb-6 max-w-md",children:["We couldn't find any documents matching \"",p,'". Try different keywords or upload more documents.']}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>o.push("/app/chats","back"),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Chats"]}),(0,s.jsx)("button",{className:"btn btn-outline gap-2",onClick:()=>o.push("/app/chats","back"),children:"Upload Documents"})]})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8",children:(0,s.jsx)(l.N,{children:e.map((e,t)=>(0,s.jsx)(i.P.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.96},whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},transition:{type:"spring",stiffness:300,damping:24},children:(0,s.jsxs)("div",{className:"card card-compact bg-base-100 shadow-md hover:shadow-xl border border-base-300 transition-all cursor-pointer group h-full",onClick:()=>u(g(e,t)),children:[(0,s.jsxs)("figure",{className:"relative h-40 bg-gradient-to-br from-base-200 to-base-300 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/20 group-hover:scale-110 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,s.jsxs)("div",{className:"absolute top-2 left-2 right-2 flex justify-between items-start gap-2",children:[void 0!==e.score&&(0,s.jsxs)("div",{className:"badge badge-success gap-1",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(100*e.score).toFixed(0),"%"]}),(0,s.jsxs)("div",{className:"badge badge-primary badge-sm gap-1 ml-auto",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]})]}),(0,s.jsxs)("div",{className:"card-body p-4",children:[(0,s.jsx)("h3",{className:"card-title text-sm font-semibold truncate",title:e.filename||e.name||"Result ".concat(t+1),children:e.filename||e.name||"Result ".concat(t+1)}),(0,s.jsx)("div",{className:"text-xs text-base-content/70 line-clamp-3 min-h-[3rem]",children:(0,s.jsx)(er.o,{children:String(e.content||e.fullcontent||"No preview available")})}),e.timestamp&&(0,s.jsxs)("div",{className:"flex items-center gap-1 mt-2 text-xs text-base-content/50",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.timestamp]})]})]})},e&&(e.id||"".concat(e.filename,"-").concat(t))||t))})}),(0,s.jsxs)("div",{className:"divider text-sm text-base-content/50",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"End of Results"]})]}),(0,s.jsx)("div",{className:"flex justify-center mt-8",children:(0,s.jsxs)("button",{className:"btn btn-lg btn-primary gap-2",onClick:()=>o.goBack(),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Chats"]})}),(0,s.jsx)(ei,{doc:d,onClose:()=>u(null),presentingElement:null})]})})}var ez=a(2821);a(9785);var eW=a(5889),eF=a(7842),eG=a(398),eH=a.n(eG);function eV(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,eW.QP)((0,ez.$)(t))}var eq=a(3263);function eK(e){let{item:t,className:a}=e;return(0,s.jsxs)("div",{className:eV("flex text-primary text-lg font-medium justify-between active:brightness-90 transition-all duration-300 items-center gap-2 px-4 py-3.5",a),onClick:t.onClick,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[t.icon," ",t.label]}),t.suffix?t.suffix:t.withArrow?(0,s.jsx)(eq.A,{className:"text-gray-500",size:22}):null]})}var eX=a(8974),eJ=a(576),eY=a(5225),eQ=a(9201),e$=a(8155),eZ=a(912),e0=a(8428),e1=a(7314);function e2(){let e=(0,n.useRef)(null),t=(0,R.jq)(),[a,r]=(0,n.useState)({theme:"dark",notifications:!1}),[i,l]=(0,n.useState)(""),[o,c]=(0,n.useState)(!0);(0,n.useEffect)(()=>{!async function(){try{c(!0);let t=await el.Ay.loadSettings();if(t){let e={...a,...t,theme:"dark"};r(e);try{"undefined"!=typeof document&&document.documentElement.setAttribute("data-theme","dark")}catch(e){console.warn("Unable to apply saved theme",e)}}else{await el.Ay.saveSettings(a);try{"undefined"!=typeof document&&document.documentElement.setAttribute("data-theme","dark")}catch(e){console.warn("Unable to apply default theme",e)}}try{var e;let{data:t,error:a}=await j.N.auth.getUser();!a&&(null==t||null==(e=t.user)?void 0:e.email)&&l(t.user.email)}catch(e){console.warn("Unable to load supabase user",e)}}catch(e){console.error("Error loading user data:",e)}finally{c(!1)}}()},[]),(0,n.useEffect)(()=>{o||el.Ay.saveSettings(a).catch(e=>{console.error("Error saving settings:",e)})},[a,o]);let d=()=>{r(e=>({...e,notifications:!e.notifications}))},u=[{icon:(0,s.jsx)(eJ.A,{size:22,className:"text-accent"}),label:"Notifications",withArrow:!1,onClick:d,suffix:(0,s.jsx)(e3,{enabled:a.notifications})},{icon:(0,s.jsx)(eY.A,{size:22,className:"text-info"}),label:"Terms of Use",onClick:()=>{window.open("https://document-chat.com/terms-conditions/","_blank")}},{icon:(0,s.jsx)(eQ.A,{size:22,className:"text-success"}),label:"Privacy Policy",onClick:()=>{window.open("https://document-chat.com/privacy-policy/","_blank")}},{icon:(0,s.jsx)(e$.A,{size:22,className:"text-warning"}),label:"Help & Support",onClick:()=>{window.location.href="mailto:info@document-chat.com"}},{icon:(0,s.jsx)(eZ.A,{size:22,className:"text-secondary"}),label:"Share App",onClick:async()=>{await eX.S.share({title:"Messenger App",text:"Check out this awesome messenger app!",url:"http://example.com/",dialogTitle:"Share with friends"})}},{icon:(0,s.jsx)(e0.A,{size:22,className:"text-error"}),label:"Logout",onClick:async()=>{try{await j.N.auth.signOut(),(0,T.clearCachedToken)()}catch(e){console.error("Error signing out",e)}finally{t.push("/app","root","replace")}}}];return(0,s.jsxs)(en,{pageRef:e,toolbarClassName:"bg-base-100",header:(0,s.jsx)(R.BC,{children:"Settings"}),children:[(0,s.jsx)(R.eU,{collapse:"condense",children:(0,s.jsx)(R.ai,{children:(0,s.jsx)(R.BC,{size:"large",children:"Settings"})})}),(0,s.jsx)("div",{className:"min-h-screen w-full flex flex-col items-center bg-gradient-to-b from-base-200 to-base-100 pb-8",children:(0,s.jsxs)("div",{className:"w-full max-w-md flex flex-col gap-6 p-6",children:[(0,s.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 via-base-100 to-secondary/10 shadow-lg border border-base-300",children:(0,s.jsxs)("div",{className:"card-body items-center py-8",children:[(0,s.jsx)("div",{className:"avatar mb-3",children:(0,s.jsx)("div",{className:"w-20 rounded-full bg-gradient-to-br from-primary to-secondary p-1 shadow-lg ring-4 ring-base-100",children:(0,s.jsx)("div",{className:"w-full h-full rounded-full bg-base-100 flex items-center justify-center",children:(0,s.jsx)(e1.A,{size:36,className:"text-primary"})})})}),(0,s.jsx)("h2",{className:"card-title text-xl font-bold mb-1",children:"Your Account"}),(0,s.jsxs)("div",{className:"badge badge-lg badge-primary badge-outline gap-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),i||"Not logged in"]})]})}),(0,s.jsx)("div",{className:"card bg-base-100 shadow-xl border border-base-300",children:(0,s.jsx)("div",{className:"card-body p-0",children:o?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4 py-12",children:[(0,s.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,s.jsx)("p",{className:"text-sm text-base-content/70",children:"Loading settings..."})]}):(0,s.jsx)("ul",{className:"menu menu-lg w-full",children:u.map((e,t)=>(0,s.jsx)("li",{className:"border-b last:border-b-0 border-base-200/50",children:(0,s.jsx)(eK,{item:e,className:"flex items-center gap-4 px-4 py-4 hover:bg-base-200/50 active:bg-base-300/50 transition-colors"})},t))})})}),(0,s.jsxs)("div",{className:"text-center mt-4",children:[(0,s.jsx)("p",{className:"text-xs text-base-content/50",children:"Document Chat v1.0.0"}),(0,s.jsx)("p",{className:"text-xs text-base-content/40 mt-1",children:"Made with ❤️ for productivity"})]})]})})]})}function e3(e){let{enabled:t}=e;return(0,s.jsx)("input",{type:"checkbox",className:"toggle toggle-primary",checked:t,readOnly:!0})}function e4(){let e=(0,O.zy)(),[t,a]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{a(!e.pathname.includes("/app/chats/"))},[e]),(0,s.jsxs)(R.p4,{children:[(0,s.jsxs)(R.Rg,{children:[(0,s.jsx)(O.qh,{exact:!0,path:"/app/chats",component:eU}),(0,s.jsx)(O.qh,{exact:!0,path:"/app/quicksearch",render:e=>{let{location:t}=e;return(0,s.jsx)(eO,{})}}),(0,s.jsx)(O.qh,{path:"/app/chats/:chatId",render:e=>{let{match:t}=e;return(0,s.jsx)(eE,{chatId:t.params.chatId})}}),(0,s.jsx)(O.qh,{exact:!0,path:"/app/settings",render:()=>(0,s.jsx)(e2,{})}),(0,s.jsx)(O.qh,{exact:!0,path:"/app",children:(0,s.jsx)(O.rd,{to:"/app/chats"})})]}),t&&(0,s.jsxs)(R.Jq,{slot:"bottom",className:"bg-base-100 text-base-content",children:[(0,s.jsx)(R.qW,{tab:"/app/chats",href:"/app/chats",className:"bg-base-100 text-base-content",children:(0,s.jsx)(ee.A,{size:22})}),(0,s.jsx)(R.qW,{tab:"/app/settings",href:"/app/settings",className:"bg-base-100 text-base-content",children:(0,s.jsx)(et.A,{size:22})})]})]})}let e6=!1;(0,R.Z3)({mode:"ios"});let e5=()=>{let{showSplash:e}=y(),{user:t,loading:a}=U(),r=!!e6||t,[i,l]=(0,n.useState)("");return(0,n.useEffect)(()=>{(async()=>{try{let e=await M.p.getId();l(e.identifier)}catch(e){console.error("Error getting device ID:",e)}})()},[]),(0,n.useEffect)(()=>{let e=window.location.hash;e&&e.includes("access_token")&&(async()=>{try{let t=new URLSearchParams(e.substring(1)),a=t.get("access_token"),s=t.get("refresh_token");if(!a)return;await j.N.auth.setSession({access_token:a,refresh_token:s});try{history.replaceState(null,"",window.location.pathname+window.location.search)}catch(e){}}catch(e){console.warn("Failed to restore Supabase session from URL fragment",e)}})()},[]),(0,s.jsxs)(R.U1,{children:[e&&(0,s.jsx)(F,{}),(0,s.jsx)(D,{userId:i,children:(0,s.jsx)(v,{children:(0,s.jsx)(B.l8,{children:(0,s.jsxs)(R.Rg,{id:"main",children:[(0,s.jsx)(O.qh,{path:"/app",render:()=>r?(0,s.jsx)(V,{children:(0,s.jsx)(e4,{})}):a&&!e6?null:(0,s.jsx)(J,{})}),(0,s.jsx)(O.qh,{exact:!0,path:"/",children:(0,s.jsx)(O.rd,{to:"/app"})})]})})})})]})}},3941:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";let AsyncStorage;__webpack_require__.d(__webpack_exports__,{N:()=>supabase});var _asyncMod_default,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4703),_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(699);let isNativeBuild=!0;if(isNativeBuild){try{let req=eval("require"),asyncMod=req("@react-native-async-storage/async-storage");AsyncStorage=null!=(_asyncMod_default=null==asyncMod?void 0:asyncMod.default)?_asyncMod_default:asyncMod}catch(err){}try{let req=eval("require");req("react-native-url-polyfill/auto")}catch(err){}}let supabaseUrl="https://fpmlhuvwgaaywtxinnvi.supabase.co",supabaseAnonKey="sb_publishable_2UGAAJQwNfT9hP70TfXceg_PbMLGcUU";if(!supabaseUrl||!supabaseAnonKey)throw Error("Supabase configuration missing. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY (or EXPO_PUBLIC_SUPABASE_URL / EXPO_PUBLIC_SUPABASE_KEY) in your environment.");let authOptions={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!isNativeBuild,lock:_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.h0,storage:isNativeBuild?AsyncStorage:void 0},supabase=(0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.UU)(supabaseUrl,supabaseAnonKey,{auth:authOptions})},4544:(e,t,a)=>{"use strict";a.r(t),a.d(t,{clearCachedToken:()=>d,default:()=>u,getCachedIdToken:()=>c});var s=a(3941);let n=null,r=0,i=15e3,l=async e=>{var t;if(e)return e;let{data:a,error:n}=await s.N.auth.getSession();return n?(console.warn("Unable to resolve Supabase session",n),null):null!=(t=a.session)?t:null},o=(e,t)=>e.expires_at?1e3*e.expires_at:e.expires_in?Date.now()+1e3*e.expires_in:Date.now()+t;async function c(e){try{let t=Date.now();if(n&&r>t)return n;let a=await l(e);if(!a||!a.access_token)return n=null,r=0,null;let c=a.access_token,d=o(a,36e5);if(d<=t+i){let{data:e,error:t}=await s.N.auth.refreshSession();if(t)return console.warn("Supabase session refresh failed",t),n=null,r=0,null;let a=e.session;if(!a||!a.access_token)return n=null,r=0,null;c=a.access_token,d=o(a,36e5)}return n=c,r=d-i,n}catch(e){return console.warn("getCachedIdToken failed",e),n=null,r=0,null}}function d(){n=null,r=0}let u=c},8078:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=8078,e.exports=t}}]);